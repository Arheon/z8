Number.isNumber=function(a){return"number"==typeof a};Number.compare=function(a,b){return a-b};Number.prototype.round=function(a){if(null==a)return Math.round(this);a=Math.pow(10,a);return Math.round(this*a)/a};String.ZeroWidthChar=String.fromCharCode(8203);String.SpacerChar="&#160;";String.isString=function(a){return"string"==typeof a};String.htmlText=function(a){return null==a||0==a.length?String.ZeroWidthChar:a};String.padLeft=function(a,b,c){a=String(a);for(c=c||" ";a.length<b;)a=c+a;return a};
String.padRight=function(a,b,c){a=String(a);for(c=c||" ";a.length<b;)a+=c;return a};String.repeat=function(a,b,c){c="";for(var d=0;d<b;d++)c+=a;return c};String.prototype.startsWith=function(a){var b=this.length;return null==a||b<a.length?!1:this.substr(0,a.length)==a};String.prototype.endsWith=function(a){var b=this.length;return null==a||b<a.length?!1:this.substr(b-a.length,a.length)==a};
Array.prototype.pushIf=function(){for(var a=0,b=arguments.length;a<b;a++){var c=arguments[a];-1==this.indexOf(c)&&this.push(c)}return this};Array.prototype.insert=function(a,b){a=Array.isArray(a)?a:[a];var c=[null!=b?b:this.length,0].concat(a);this.splice.apply(this,c);return this};Array.prototype.add=function(a){return this.insert(a,null)};
Array.prototype.remove=function(){for(var a=[],b=0,c=arguments.length;b<c;b++){var d=arguments[b],e=this.indexOf(d);-1!=this.indexOf(d)&&(a.push(d),this.splice(e,1))}return a};Array.prototype.removeAll=function(a){if(null==a)return[];a=Array.isArray(a)?a:[a];return this.remove.apply(this,a)};Array.prototype.removeAt=function(a){return this.splice(a,1)};Array.prototype.first=function(){return 0<this.length?this[0]:null};Array.prototype.last=function(){var a=this.length;return 0<a?this[a-1]:null};
Date.Milli="ms";Date.Second="s";Date.Minute="mi";Date.Hour="h";Date.Day="d";Date.Month="mo";Date.Year="y";Date.DaysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31];Date.MillisPerDay=864E5;Date.MillisPerWeek=7*Date.MillisPerDay;Date.MonthNames="\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ");
Date.MonthShortNames="\u042f\u043d\u0432 \u0424\u0435\u0432 \u041c\u0430\u0440 \u0410\u043f\u0440 \u041c\u0430\u0439 \u0418\u044e\u043d \u0418\u044e\u043b \u0410\u0432\u0433 \u0421\u0435\u043d \u041e\u043a\u0442 \u041d\u043e\u044f \u0414\u0435\u043a".split(" ");Date.DayNames="\u041f\u043e\u043d\u0435\u0434\u0435\u043b\u044c\u043d\u0438\u043a \u0412\u0442\u043e\u0440\u043d\u0438\u043a \u0421\u0440\u0435\u0434\u0430 \u0427\u0435\u0442\u0432\u0435\u0440\u0433 \u041f\u044f\u0442\u043d\u0438\u0446\u0430 \u0421\u0443\u0431\u0431\u043e\u0442\u0430 \u0412\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435".split(" ");
Date.DayShortNames="\u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431 \u0412\u0441".split(" ");Date.isDate=function(a){return"[object Date]"===toString.call(a)};Date.isEqual=function(a,b){return a&&b?a.getTime()==b.getTime():!1};Date.isEqualMonth=function(a,b){return a&&b?a.getYear()==b.getYear()&&a.getMonth()==b.getMonth():!1};Date.isEqualDate=function(a,b){return a&&b?a.getYear()==b.getYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate():!1};
Date.prototype.getMonthName=function(){return Date.MonthNames[this.getMonth()]};Date.prototype.getMonthShortName=function(){return Date.MonthShortNames[this.getMonth()]};Date.prototype.getDayName=function(){return Date.dayNames[this.getDayOfWeek()]};Date.prototype.getDayShortName=function(){return Date.dayShortNames[this.getDayOfWeek()]};Date.prototype.getDayOfWeek=function(){var a=this.getDay();return 0!=a?a-1:6};
Date.prototype.getFirstDateOfWeek=function(){var a=this.getDayOfWeek();return(new Date(this)).add(-a,Date.Day)};Date.prototype.getWeekOfYear=function(){var a=Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()+3)/Date.MillisPerDay,a=Math.floor(a/7),b=(new nativeDate(a*Date.MillisPerWeek)).getUTCFullYear();return a-Math.floor(Date.UTC(b,0,7)/Date.MillisPerWeek)+1};Date.prototype.isLeapYear=function(){var a=this.getFullYear();return!(0!==(a&3)||!(a%100||0===a%400&&a))};
Date.prototype.getFirstDayOfMonth=function(){var a=(this.getDay()-(this.getDate()-1))%7,a=0>a?a+7:a;return 0!=a?a-1:6};Date.prototype.getLastDayOfMonth=function(){return this.getLastDateOfMonth().getDay()};Date.prototype.getFirstDateOfMonth=function(){return new Date(this.getFullYear(),this.getMonth(),1)};Date.prototype.getLastDateOfMonth=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDaysInMonth())};
Date.prototype.getFirstDateOfQuarter=function(){var a=this.getMonth();return new Date(this.getFullYear(),3>a?0:6>a?3:9>a?6:9,1)};Date.prototype.getFirstDateOfHalfYear=function(){return new Date(this.getFullYear(),6>this.getMonth()?0:6,1)};Date.prototype.getFirstDateOfYear=function(){return new Date(this.getFullYear(),0,1)};Date.prototype.getDaysInMonth=function(){var a=this.getMonth();return 1===a&&this.isLeapYear()?29:Date.DaysInMonth[a]};
Date.prototype.set=function(a,b){b==Date.Year?this.setFullYear(a):b==Date.Month?this.setMonth(a):b==Date.Day?this.setDate(a):b==Date.Hour?this.setHours(a):b==Date.Minute?this.setMinutes(a):b==Date.Second?this.setSeconds(a):b==Date.Milli&&this.setMilliseconds(a);return this};
Date.prototype.add=function(a,b){if(!b||0===a)return this;switch(b){case Date.Milli:this.setTime(this.getTime()+a);break;case Date.Second:this.setTime(this.getTime()+1E3*a);break;case Date.Minute:this.setTime(this.getTime()+6E4*a);break;case Date.Hour:this.setTime(this.getTime()+36E5*a);break;case Date.Day:this.setDate(this.getDate()+a);break;case Date.Month:var c=this.getDate(),d=this.getMonth();28<c&&(c=Math.min(c,this.getFirstDateOfMonth().add(a,Date.Month).getLastDateOfMonth().getDate()));this.setDate(c);
this.setMonth(d+a);break;case Date.Year:c=this.getDate(),d=this.getFullYear(),28<c&&(c=Math.min(c,this.getFirstDateOfMonth().add(a,Date.Year).getLastDateOfMonth().getDate())),this.setDate(c),this.setFullYear(d+a)}return this};Date.prototype.addMillisecond=function(a){return this.add(a,Date.Milli)};Date.prototype.addSecond=function(a){return this.add(a,Date.Second)};Date.prototype.addMinute=function(a){return this.add(a,Date.Minute)};Date.prototype.addHour=function(a){return this.add(a,Date.Hour)};
Date.prototype.addDay=function(a){return this.add(a,Date.Day)};Date.prototype.addMonth=function(a){return this.add(a,Date.Month)};Date.prototype.addYear=function(a){return this.add(a,Date.Year)};Date.prototype.truncDay=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};Date.prototype.truncMonth=function(){this.setDate(1);this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};
Date.prototype.toISOString=function(){var a=-this.getTimezoneOffset(),b=this.getFullYear(),c=this.getMonth()+1,d=this.getDate(),e=this.getHours(),f=this.getMinutes(),g=this.getSeconds(),h=this.getMilliseconds(),k="";if(0!=a)var k=Math.floor(a/60),m=a%60,k=(0<=a?"+":"-")+(10>k?"0":"")+k+":"+(10>m?"0":"")+m;return b+"-"+(10>c?"0":"")+c+"-"+(10>d?"0":"")+d+"T"+(10>e?"0":"")+e+":"+(10>f?"0":"")+f+":"+(10>g?"0":"")+g+(0!=h?"."+(100>h?10>h?"00":"0":"")+h:"")+k};JSON.encode=JSON.stringify;JSON.decode=JSON.parse;
var Z8={classes:{},apply:function(a,b){for(var c in b)a[c]=b[c];return a},addMembers:function(a,b){for(var c in b)Z8.addMember(a,b[c],c)},addMember:function(a,b,c){if(void 0!=b){if("function"==typeof b&&null==b.$owner){var d=a[c];null!=d&&(b.$previous=d);b.$owner=a}a[c]=b}},addCallParent:function(a){Z8.addMember(a,function(){return this.callParent.caller.$previous.apply(this,arguments)},"callParent")},newConstructor:function(){return function(){return this.constructor.apply(this,arguments)}},define:function(a,
b){var c=Z8.newConstructor(),d=b.single;delete b.single;var e=b.extend;delete b.extend;var f=b.mixins;delete b.mixins;var g=b.statics;delete b.statics;var h=b.shortClassName;delete b.shortClassName;var k=null;if(null!=e){if(k=Z8.classes[e],null==k)throw'Superclass not found: "'+e+'"';}else k=function(a){return Z8.addMembers(this,a)};e=k.prototype;k=c.prototype=Object.create(e);k.self=k;k.$className=a;c.superclass=k.superclass=e;Z8.addMembers(k,b);Z8.addCallParent(k);Z8.mixin(k,f);Z8.apply(c,g);d||
(Z8.namespace(a,c),Z8.namespace(h,c));return c},mixin:function(a,b){if(null!=b){b=Array.isArray(b)?b:[b];for(var c=0,d=b.length;c<d;c++){var e=Z8.classes[b[c]];if(null==e)throw'Mixin not found: "'+b[c]+'"';var e=e.prototype,f=e.mixinId;if(null==f)throw'Mixed in class must have mixinId: "'+e.$className+'"';for(var g in e)"mixinId"!=g&&void 0===a[g]&&(a[g]=e[g]);null==a.mixins&&(a.mixins={});a.mixins[f]=e}}},namespace:function(a,b){if(null!=a){for(var c=window,d=a.split("."),e=d.length-1,f=d[e],g=0;g<
e;g++){var h=d[g],k=c[h];null==k&&(k=c[h]={});c=k}c[f]=b;return Z8.classes[a]=b}},create:function(a,b){if(String.isString(a)){var c=a;a=Z8.classes[c];if(null==a)throw'Class not found: "'+c+'"';}c=Object.create(a.prototype);a.call(c,b);return c},callback:function(a){if(null!=a){var b,c;"object"==typeof a?(c=a.scope,a=a.fn||a.callback,b=Array.prototype.slice.call(arguments,1)):(c=arguments[1],b=Array.prototype.slice.call(arguments,2));null!=a&&a.apply(c,b)}},isEmpty:function(a){return null==a||""===
a?!0:Array.isArray(a)?0==a.length:!1}};Z8.apply(Event.prototype,{stopEvent:function(){this.stopPropagation();this.preventDefault();this.cancelled=!0},getCharCode:function(){return this.charCode||this.keyCode},getKey:function(){return this.keyCode||this.charCode}});
Z8.apply(Event,{BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,RETURN:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,
NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123});
Z8.define("Z8.dom.Dom",{shortClassName:"DOM",statics:{emptyTags:{br:!0,frame:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,col:!0},readyListeners:[],isDom:function(a){return null!=a&&null!=a.addEventListener},get:function(a){return null==a?null:a.isComponent||null!=a.dom?a.dom:DOM.isDom(a)?a:null},isParentOf:function(a,b){if(null==a||null==b)return!1;a=Array.isArray(a)?a.slice(0):[a];for(var c=0,d=0,e=a.length;c<e;c++)null!=(a[c]=DOM.get(a[c]))&&d++;if(0==d)return!1;for(d=document.body;null!=b&&1==b.nodeType&&
b!==d;){c=0;for(e=a.length;c<e;c++)if(b==a[c])return!0;b=b.parentNode}return!1},getCookie:function(a){a=document.cookie.match(a+"=([^;|*]*);*");return null!=a?decodeURIComponent(a[1]||""):""},setCookie:function(a,b,c){document.cookie=a+"="+encodeURIComponent(b)+";expires="+(new Date).addDay(c||2).toUTCString()+";path=/"},selectNode:function(a,b){1==arguments.length&&(b=a,a=document.body);return null==(a=DOM.get(a))?null:a.querySelector(b)},query:function(a,b){1==arguments.length&&(b=a,a=document.body);
return null==(a=DOM.get(a))?null:a.querySelectorAll(b)},markup:function(a){var b="";if(String.isString(a)||Number.isNumber(a))return b+a;if(Array.isArray(a)){for(var c=0,d=a.length;c<d;c++){var e=a[c];null!=e&&(b+=DOM.markup(e))}return b}c=a.tag||"div";b+="<"+c;for(e in a)d=a[e],"tag"!=e&&"children"!=e&&"cn"!=e&&"html"!=e&&"container"!=e&&(b+=" "+("cls"==e?"class":e)+(null!=d?'="'+d+'"':""));null==DOM.emptyTags[c]?(b+=">",null!=(d=a.html)&&(b+=d),null!=(d=a.cn||a.children)&&(b+=DOM.markup(d)),b+=
"</"+c+">"):b+="/>";return b},append:function(a,b){if(null==(a=DOM.get(a||document.body))||null==b)return null;if(DOM.isDom(b))return a.appendChild(b);a.insertAdjacentHTML("beforeend",DOM.markup(b));return a.lastChild},insertBefore:function(a,b){if(null==(a=DOM.get(a))||null==b)return null;if(DOM.isDom(b))return a.insertAdjacentElement("beforebegin",b);a.insertAdjacentHTML("beforebegin",DOM.markup(b));return a.previousSibling},remove:function(a,b){if(null==(a=DOM.get(a)))return null;null!=b?(new Z8.util.DelayedTask).delay(b,
function(a){a.parentElement.removeChild(a)},this,a):a.parentElement.removeChild(a)},getProperty:function(a,b){a=DOM.get(a);return null!=a?a[b]:null},setProperty:function(a,b,c,d){null!=(a=DOM.get(a))&&(null!=d?(new Z8.util.DelayedTask).delay(d,function(a,b,c){a[b]=c},this,a,b,c):a[b]=c)},getStyle:function(a,b){a=DOM.get(a);return null!=a?a.style[b]:null},setStyle:function(a,b,c,d){null!=c&&null!=(a=DOM.get(a))&&(null!=d?(new Z8.util.DelayedTask).delay(d,function(a,b,c){a.style[b]=c},this,a,b,c):a.style[b]=
c)},getParent:function(a){return DOM.getProperty(a,"parentNode")},getComputedStyle:function(a){a=DOM.get(a);return null!=a?window.getComputedStyle(a):null},getClipping:function(a){if(null==(a=DOM.get(a)))return null;var b=document.body;for(a=a.parentNode;null!=a&&1==a.nodeType;){if(a==b)return b;var c=window.getComputedStyle(a).overflowY;if("hidden"==c||"auto"==c)return a;a=a.parentNode}return null},getAttribute:function(a,b){a=DOM.get(a);return null!=a?a.getAttribute(b):null},getIntAttribute:function(a,
b){var c=DOM.getAttribute(a,b);return null!=c?Parser.integer(c):null},setAttribute:function(a,b,c){null!=(a=DOM.get(a))&&a.setAttribute(b,c)},focus:function(a,b){if(null==(a=DOM.get(a))||null==a.focus)return!1;a.focus();b&&null!=a.select&&a.select();return!0},scroll:function(a,b,c){null!=(a=DOM.get(a))&&null!=a.focus&&(a.scrollLeft=b,a.scrollTop=c)},parseCls:function(a){return(String.isString(a)?a.toLowerCase().split(" "):a)||[]},getCls:function(a){DOM.getProperty(a,"className")},setCls:function(a,
b,c){DOM.setProperty(a,"className",Array.isArray(b)?b.join(" "):b,c)},removeCls:function(a,b,c){null!=(a=DOM.get(a))&&(c=DOM.parseCls(a.className),b=c.indexOf(b),-1!=b&&(c.splice(b,1),DOM.setCls(a,c)))},addCls:function(a,b,c){if(null!=(a=DOM.get(a))){var d=DOM.parseCls(a.className);-1==d.indexOf(b)&&(d.push(b),DOM.setCls(a,d,c))}},swapCls:function(a,b,c,d,e){if(null!=(a=DOM.get(a))){var f=DOM.parseCls(a.className),g=b?c:d;c=b?d:c;null!=g&&(-1==f.indexOf(g)?f.push(g):g=null);null!=c&&(b=f.indexOf(c),
-1!=b?f.splice(b,1):c=null);null==g&&null==c||DOM.setCls(a,f,e);return f}},getValue:function(a){if(null==(a=DOM.get(a)))return null;var b=a.tagName;return"INPUT"==b||"TEXTAREA"==b?"checkbox"==a.type?a.checked:a.value:a.textContent},setValue:function(a,b,c){if(null!=(a=DOM.get(a))){var d=a.tagName;DOM.setProperty(a,"INPUT"==d||"TEXTAREA"==d?"checkbox"==a.type?"checked":"value":"textContent",b||"",c)}},setTitle:function(a,b,c){DOM.setProperty(a,"title",b,c)},setInnerHTML:function(a,b,c){DOM.setProperty(a,
"innerHTML",b,c)},setReadOnly:function(a,b,c){DOM.setProperty(a,"readOnly",b,c)},setDisabled:function(a,b,c){DOM.setProperty(a,"disabled",b,c)},setTabIndex:function(a,b,c){DOM.setProperty(a,"tabIndex",b,c)},setDisplay:function(a,b,c){DOM.setStyle(a,"display",b,c)},setHidden:function(a,b,c){DOM.setStyle(a,"visibility",b?"hidden":"visible",c)},getOffsetTop:function(a){return Ems.pixelsToEms(DOM.getProperty(a,"offsetTop"))},getOffsetLeft:function(a){return Ems.pixelsToEms(DOM.getProperty(a,"offsetLeft"))},
getOffsetWidth:function(a){return Ems.pixelsToEms(DOM.getProperty(a,"offsetWidth"))},getOffsetHeight:function(a){return Ems.pixelsToEms(DOM.getProperty(a,"offsetHeight"))},getClientWidth:function(a){return Ems.pixelsToEms(DOM.getProperty(a,"clientWidth"))},getClientHeight:function(a){return Ems.pixelsToEms(DOM.getProperty(a,"clientHeight"))},getPoint:function(a,b){b=DOM.getStyle(a,b);return null!=b?parseFloat(b):null},setPoint:function(a,b,c,d){null!=c&&DOM.setStyle(a,b,String.isString(c)?c:c+"em",
d)},getLeft:function(a){return DOM.getPoint(a,"left")},setLeft:function(a,b,c){DOM.setPoint(a,"left",b,c)},getRight:function(a){return DOM.getPoint(a,"right")},setRight:function(a,b,c){DOM.setPoint(a,"right",b,c)},getTop:function(a){return DOM.getPoint(a,"top")},setTop:function(a,b,c){DOM.setPoint(a,"top",b,c)},getBottom:function(a){return DOM.getPoint(a,"bottom")},setBottom:function(a,b,c){DOM.setPoint(a,"bottom",b,c)},getWidth:function(a){return DOM.getPoint(a,"width")},setWidth:function(a,b,c){DOM.setPoint(a,
"width",b,c)},getHeight:function(a){return DOM.getPoint(a,"height")},setHeight:function(a,b,c){DOM.setPoint(a,"height",b,c)},setCssText:function(a,b,c){DOM.setStyle(a,"cssText",b,c)},rotate:function(a,b){if(null!=a){var c="fa-rotate-"+b;0!=b?(DOM.addCls(a,"fa-transform-transition"),DOM.addCls(a,c),a.rotationCls=c):(DOM.removeCls(a,a.rotationCls),delete a.rotationCls)}},substitutes:{click:"touchend",mousedown:"touchstart"},on:function(a,b,c,d,e){if(null!=(a=DOM.get(a))){b=b.toLowerCase();var f=a.eventsData;
null==f&&(f=a.eventsData=f={});var g=f[b]||[],h=function(a){var b=a.currentTarget.eventsData;if(null!=b&&(b=b[a.type],null!=b))for(var b=[].concat(b),c=0,d=b.length;c<d&&(Z8.callback(b[c],a,a.target),!a.cancelled);c++);};if(null==c)throw"DOM.on: fn is null";g.push({fn:c,scope:d,callback:h,capture:e});f[b]=g;1==g.length&&a.addEventListener(b,h,e)}},un:function(a,b,c,d){if(null!=(a=DOM.get(a))){b=b.toLowerCase();var e=a.eventsData;if(null!=e){var f=e[b];if(null!=f){for(var g=0,h=f.length;g<h;g++){var k=
f[g];if(k.fn==c&&k.scope==d){f.removeAt(g);0==f.length&&(a.removeEventListener(b,k.callback,k.capture),delete e[b]);break}}0==Object.keys(e).length&&delete a.eventsData}}}},download:function(a,b,c){var d=DOM.append(document.body,{tag:"iframe",html:'<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>',src:"",hidden:!0});d.src=encodeURI(a.replace(/\\/g,"/"))+"?&session="+Application.session+(null!=b?"&serverId="+b:"");(new Z8.util.DelayedTask).delay(500,DOM.downloadCallback,
this,a,d,c)},downloadCallback:function(a,b,c){var d=b.contentDocument;if("complete"==d.readyState){var d=d.body.innerHTML,e=Z8.isEmpty(d);e||(d="{"==d.charAt(0)?JSON.decode(d):{info:{messages:[{text:"'"+a+"' - \u0444\u0430\u0439\u043b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d",type:"error"}]}},Application.message(d.info.messages));Z8.callback(c,e);DOM.remove(b,1E4)}else(new Z8.util.DelayedTask).delay(500,DOM.downloadCallback,this,a,b,c)},onReady:function(a,b){DOM.readyListeners.push({fn:a,
scope:b})},onContextMenu:function(a,b){"INPUT"!=b.tagName&&"PRE"!=b.tagName&&a.stopEvent()},onReadyEvent:function(a,b){for(var c=DOM.readyListeners,d=0,e=c.length;d<e;d++)Z8.callback(c[d]);delete DOM.readyListeners;DOM.un(window,"load",DOM.onReadyEvent);if(null!=DOM.onContextMenu)DOM.on(window,"contextmenu",DOM.onContextMenu);-1!=window.navigator.userAgent.toLowerCase().indexOf("gecko/")&&DOM.addCls(document.body,"gecko")}}});DOM.on(window,"load",DOM.onReadyEvent);
Z8.define("Z8.util.Ems",{shortClassName:"Ems",statics:{Base:parseFloat(DOM.getComputedStyle(document.body).fontSize),UnitHeight:4,UnitSpacing:.71428571,unitsToEms:function(a){return a?a*Ems.UnitHeight+(a-1)*Ems.UnitSpacing:0},pixelsToEms:function(a){return a?(a/Ems.Base).round(8):0},emsToPixels:function(a){return Math.ceil(a*Ems.Base)}}});
Z8.define("Z8.Rect",{shortClassName:"Rect",left:0,top:0,right:0,bottom:0,constructor:function(a,b,c,d){Number.isNumber(a)?(this.left=Math.min(a,c),this.top=Math.min(b,d),this.right=Math.max(a,c),this.bottom=Math.max(b,d)):null!=a&&(b=DOM.get(a),null!=b?(a=b.getBoundingClientRect(),this.left=Ems.pixelsToEms(a.left),this.top=Ems.pixelsToEms(a.top),this.right=Ems.pixelsToEms(a.right),this.bottom=Ems.pixelsToEms(a.bottom)):(this.left=a.left,this.top=a.top,this.right=a.right,this.bottom=a.bottom));this.width=
this.right-this.left;this.height=this.bottom-this.top},offset:function(a,b){this.left+=a;this.right+=a;this.top+=b||0;this.bottom+=b||0;return this}});Z8.define("guid",{statics:{Null:"00000000-0000-0000-0000-000000000000"}});Z8.define("Z8.server.type",{shortClassName:"Type",statics:{Guid:"guid",Integer:"int",Float:"float",Boolean:"boolean",Date:"date",Datetime:"datetime",Datespan:"datespan",String:"string",Binary:"binary",Text:"text",File:"file",Files:"attachments",Json:"json"}});
Z8.define("Z8.RecordLock",{shortClassName:"RecordLock",statics:{None:0,Full:1,Edit:2,Destroy:3}});
Z8.define("Z8.Operation",{shortClassName:"Operation",statics:{Eq:"eq",NotEq:"notEq",Contains:"contains",NotContains:"notContains",BeginsWith:"beginsWith",NotBeginsWith:"notBeginsWith",EndsWith:"endsWith",NotEndsWith:"notEndsWith",IsEmpty:"isEmpty",IsNotEmpty:"isNotEmpty",GT:"gt",GE:"ge",LT:"lt",LE:"le",Today:"today",Tomorrow:"tomorrow",Yesterday:"yesterday",LastWeek:"lastWeek",ThisWeek:"thisWeek",NextWeek:"nextWeek",LastMonth:"lastMonth",ThisMonth:"thisMonth",NextMonth:"nextMonth",LastYear:"lastYear",
ThisYear:"thisYear",NextYear:"nextYear",LastDays:"lastDays",NextDays:"nextDays",LastHours:"lastHours",NextHours:"nextHours",isTrue:"isTrue",isFalse:"isFalse"}});
Z8.define("Z8.util.Format",{shortClassName:"Format",statics:{Date:"d.m.Y",ShortDate:"d.m.y",LongDate:"j F Y",Time:"H:i",LongTime:"H:i:s",Datetime:"d.m.Y H:i",LongDatetime:"j F Y H:i",Integer:"0,000",Float:"0,000.00",TrueText:"\u0434\u0430",FalseText:"\u043d\u0435\u0442",ThousandSeparator:" ",DecimalSeparator:",",charWidth:null,measures:{},list:function(){for(var a="",b=0,c=arguments.length;b<c;b++){var d=arguments[b];Z8.isEmpty(d)||(a+=(""==a?"":", ")+d)}return a},placeholder:function(a,b){return Z8.isEmpty(a)?
b:a},nl2br:function(a){var b=null;if(Array.isArray(a)){for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push((d.text||d).replace(/\n/g,"<br>"))}b=b.join("<br>")}else null!=a&&(b=(a.text||a).replace(/\n/g,"<br>"));return b},toHtmlString:function(a){return Format.nl2br(a.text||a).replace(/ /g,string.Empty)},htmlEncode:function(a){return null!=a&&String.isString(a)?a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):null},htmlDecode:function(a){return null==
a?null:a.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},integer:function(a,b){return Format.number(a,null!=b?b:Format.Integer)},"float":function(a,b){return Format.number(a,null!=b?b:Format.Float)},percent:function(a,b){a=Format.number(a,null!=b?b:Format.Integer);return null!=a?a+"%":a},date:function(a,b){return Format.formatDate(a,null!=b?b:Format.Date)},datetime:function(a,b){return Format.formatDate(a,null!=b?b:Format.Datetime)},dateOrTime:function(a,
b,c){if(null==a||""==a)return"";b=b||Format.Datetime;c=c||Format.Time;var d=new Date,e=(new Date).add(-1,Date.Day),d=Date.isEqualDate(a,d),e=Date.isEqualDate(a,e);return d?"\u0441\u0435\u0433\u043e\u0434\u043d\u044f "+Format.date(a,c):e?"\u0432\u0447\u0435\u0440\u0430 "+Format.date(a,c):Format.date(a,b)},fileSize:function(a){if(1024>a)return a=Format.integer(a,"0,0"),""!=a?a+" B":"";if(1048576>a)return a=Format["float"](a/1024,"0,0.##"),""!=a?a+" KB":"";if(1073741824>a)return a=Format["float"](a/
1048576,"0,0.##"),""!=a?a+" MB":"";a=Format["float"](a/1073741824,"0,0.##");return""!=a?a+" GB":""},getCharWidth:function(){if(null==Format.charWidth){var a=DOM.append(document.body,{html:"abcdefghABCDEFGH1234567890",style:"position: fixed; top: -10000;"});Format.charWidth=(new Rect(a)).width/26;DOM.remove(a)}return Format.charWidth},measureDate:function(a){var b=Format.measures[a];if(null!=b)return b;b=Format.date(new Date(2E3,8,20,22,22,22,222),a).length*Format.getCharWidth();return Format.measures[a]=
b},number:function(a,b){if(null==b)return a;if(isNaN(a))return"";var c=Format.formats[b];if(null==c){var c=0,d="",e=-1!==b.indexOf(","),f=b.replace(/[^\d\.#]/g,"").split("."),g=b.replace(/[\d,\.#]+/,"");if(2<f.length)throw"Invalid number format, should have no more than 1 decimal";if(2==f.length){var c=f[1].length,h=f[1].match(/#+$/);h&&(d='trailingZeroes=new RegExp(Format.DecimalSeparator.replace(/([-.*+?\\^${}()|\\[\\]\\/\\\\])/g, "\\\\$1") + "*0{0,'+h[0].length+'}$")')}d=["var neg,absVal,fnum,parts"+
(e?",thousandSeparator,thousands=[],j,n,i":"")+(g?',format="'+b+'"':"")+',trailingZeroes;return function(v){if(typeof v!=="number"&&isNaN(v=parseFloat(v)))return"";neg=v<0;',"absVal=Math.abs(v);","fnum=absVal.toFixed("+c+");",d,";"];e?(c&&(d[d.length]='parts=fnum.split(".");',d[d.length]="fnum=parts[0];"),d[d.length]="if(absVal>=1000) {",d[d.length]="thousandSeparator=Format.ThousandSeparator;thousands.length=0;j=fnum.length;n=fnum.length%3||3;for(i=0;i<j;i+=n){if(i!==0){n=3;}thousands[thousands.length]=fnum.substr(i,n);}fnum=thousands.join(thousandSeparator);}",
c&&(d[d.length]="fnum += Format.DecimalSeparator+parts[1];")):c&&(d[d.length]='if(Format.DecimalSeparator!=="."){parts=fnum.split(".");fnum=parts[0]+Format.DecimalSeparator+parts[1];}');d[d.length]='if(neg&&fnum!=="'+(c?"0."+String.repeat("0",c):"0")+'") { fnum="-"+fnum; }';h&&(d[d.length]='fnum=fnum.replace(trailingZeroes,"");');d[d.length]="return ";d[d.length]=g?"format.replace(/[\\d,\\.#]+/, fnum);":"fnum;";d[d.length]="};";c=Format.formats[b]=Function.prototype.constructor.call(Function.prototype,
d.join(""))()}return c(a)},formatDate:function(a,b){var c=Format.formats;if(!Date.isDate(a))return"";null==c[b]&&Format.createFormat(b);return c[b].call(a)},formats:{},formatCodes:{Y:'String.padLeft(this.getFullYear(), 4, "0")',y:'("" + this.getFullYear()).substring(2, 4)',F:"this.getMonthName()",M:"this.getShortMonthName()",m:'String.padLeft(this.getMonth() + 1, 2, "0")',n:"(this.getMonth() + 1)",t:"this.getDaysInMonth()",W:'String.padLeft(this.getWeekOfYear(), 2, "0")',w:"this.getWeekOfYear()",
z:"this.getDayOfYear()",N:"this.getDayOfWeek() + 1",l:"this.getDayName()",D:"this.getShortDayName()",d:'String.padLeft(this.getDate(), 2, "0")',j:"this.getDate()",g:"((this.getHours() % 12) ? this.getHours() % 12 : 12)",G:"this.getHours()",h:'String.padLeft((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, "0")',H:'String.padLeft(this.getHours(), 2, "0")',L:"(this.isLeapYear() ? 1 : 0)",o:"(this.getFullYear() + (this.getWeekOfYear() == 1 && this.getMonth() > 0 ? 1 : (this.getWeekOfYear() >= 52 && this.getMonth() < 11 ? -1 : 0)))",
a:'(this.getHours() < 12 ? "am" : "pm")',A:'(this.getHours() < 12 ? "AM" : "PM")',i:'String.padLeft(this.getMinutes(), 2, "0")',s:'String.padLeft(this.getSeconds(), 2, "0")',S:'String.padLeft(this.getMilliseconds(), 3, "0")',O:'((this.getTimezoneOffset() > 0 ? "-" : "+") + String.padLeft(Math.floor(Math.abs(this.getTimezoneOffset()) / 60), 2, "0") + String.PadLeft(Math.abs(this.getTimezoneOffset() % 60), 2, "0"))',P:'((this.getTimezoneOffset() > 0 ? "-" : "+") + String.padLeft(Math.floor(Math.abs(this.getTimezoneOffset()) / 60), 2, "0") + ":" + String.PadLeft(Math.abs(this.getTimezoneOffset() % 60), 2, "0"))',
T:'this.toString().replace(/^.* (?:((.*))|([A-Z]{1,5})(?:[-+][0-9]{4})?(?: -?d+)?)$/, "$1$2").replace(/[^A-Z]/g, "")',Z:"(this.getTimezoneOffset() * -60)",c:function(){for(var a=[],b=0;12>b;b++){var c="Y-m-dTH:i:sP".charAt(b);a.push("T"===c?"'T'":Format.getFormatCode(c))}return a.join(" + ")},C:function(){return"this.toISOString()"},U:"Math.round(this.getTime() / 1000)"},createFormat:function(a){for(var b=[],c=!1,d,e=0,f=a.length;e<f;e++)d=a.charAt(e),c||"\\"!==d?c?(c=!1,b.push("'"+Format.escape(d)+
"'")):b.push("\n"==d?"'\\n'":Format.getFormatCode(d)):c=!0;b="return "+b.join("+");Format.formats[a]=Function.prototype.constructor.call(Function.prototype,b)},escape:function(a){return a.replace(/('|\\)/g,"\\$1")},getFormatCode:function(a){var b=Format.formatCodes[a];null!=b&&(b="function"==typeof b?b():b,Format.formatCodes[a]=b);return b||"'"+Format.escape(a)+"'"}}});
Z8.define("Z8.util.Parser",{shortClassName:"Parser",statics:{datetime:function(a,b){if(Z8.isEmpty(a))return null;String.isString(a)&&(a=a.replace(/^(\d\d?)([\.\-//])(\d\d?)([\.\-//])/,"$3$2$1$4"));a=new Date(a);return isNaN(a)?null:a},date:function(a,b){return Z8.util.Parser.datetime(a,b)},integer:function(a,b){if(Number.isNumber(a))return a.round();a=parseInt(a.replace(/\s/g,""),b);return isNaN(a)?null:a},"float":function(a){if(Number.isNumber(a))return a;a=parseFloat(a.replace(/,/g,".").replace(/\s/g,
""));return isNaN(a)?null:a},"boolean":function(a){return String.isString(a)?"true"===a:a}}});
Z8.define("Z8.util.MD5",{shortClassName:"MD5",statics:{hexcase:0,b64pad:"",hex:function(a){return MD5.rstr2hex(MD5.rstr(MD5.str2rstr_utf8(a)))},b64:function(a){return MD5.rstr2b64(MD5.rstr(MD5.str2rstr_utf8(a)))},any:function(a,b){return MD5.rstr2any(MD5.rstr(MD5.str2rstr_utf8(a)),b)},hex_hmac:function(a,b){return MD5.rstr2hex(MD5.rstr_hmac(MD5.str2rstr_utf8(a),MD5.str2rstr_utf8(b)))},b64_hmac:function(a,b){return MD5.rstr2b64(MD5.rstr_hmac(MD5.str2rstr_utf8(a),MD5.str2rstr_utf8(b)))},any_hmac:function(a,
b,c){return MD5.rstr2any(MD5.rstr_hmac(MD5.str2rstr_utf8(a),MD5.str2rstr_utf8(b)),c)},vm_test:function(){return"900150983cd24fb0d6963f7d28e17f72"==MD5.hex("abc").toLowerCase()},rstr:function(a){return MD5.binl2rstr(MD5.binl(MD5.rstr2binl(a),8*a.length))},rstr_hmac:function(a,b){var c=MD5.rstr2binl(a);16<c.length&&(c=MD5.binl(c,8*a.length));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=c[f]^909522486,e[f]=c[f]^1549556828;c=MD5.binl(d.concat(MD5.rstr2binl(b)),512+8*b.length);return MD5.binl2rstr(MD5.binl(e.concat(c),
640))},rstr2hex:function(a){for(var b=MD5.hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<a.length;d++)var e=a.charCodeAt(d),c=c+(b.charAt(e>>>4&15)+b.charAt(e&15));return c},rstr2b64:function(a){for(var b="",c=a.length,d=0;d<c;d+=3)for(var e=a.charCodeAt(d)<<16|(d+1<c?a.charCodeAt(d+1)<<8:0)|(d+2<c?a.charCodeAt(d+2):0),f=0;4>f;f++)b=8*d+6*f>8*a.length?b+b64pad:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6*(3-f)&63);return b},rstr2any:function(a,b){var c=
b.length,d,e,f,g,h,k=Array(Math.ceil(a.length/2));for(d=0;d<k.length;d++)k[d]=a.charCodeAt(2*d)<<8|a.charCodeAt(2*d+1);var m=Math.ceil(8*a.length/(Math.log(b.length)/Math.log(2))),n=Array(m);for(e=0;e<m;e++){h=[];for(d=g=0;d<k.length;d++)if(g=(g<<16)+k[d],f=Math.floor(g/c),g-=f*c,0<h.length||0<f)h[h.length]=f;n[e]=g;k=h}c="";for(d=n.length-1;0<=d;d--)c+=b.charAt(n[d]);return c},str2rstr_utf8:function(a){for(var b="",c=-1,d,e;++c<a.length;)d=a.charCodeAt(c),e=c+1<a.length?a.charCodeAt(c+1):0,55296<=
d&&56319>=d&&56320<=e&&57343>=e&&(d=65536+((d&1023)<<10)+(e&1023),c++),127>=d?b+=String.fromCharCode(d):2047>=d?b+=String.fromCharCode(192|d>>>6&31,128|d&63):65535>=d?b+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(b+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return b},str2rstr_utf16le:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)&255,a.charCodeAt(c)>>>8&255);return b},str2rstr_utf16be:function(a){for(var b=
"",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)>>>8&255,a.charCodeAt(c)&255);return b},rstr2binl:function(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(c=0;c<8*a.length;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<c%32;return b},binl2rstr:function(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b},binl:function(a,b){a[b>>5]|=128<<b%32;a[(b+64>>>9<<4)+14]=b;for(var c=1732584193,d=-271733879,e=-1732584194,f=271733878,g=MD5.md5_ff,h=MD5.md5_gg,
k=MD5.md5_hh,m=MD5.md5_ii,n=MD5.safe_add,l=0;l<a.length;l+=16)var p=c,t=d,q=e,v=f,c=g(c,d,e,f,a[l+0],7,-680876936),f=g(f,c,d,e,a[l+1],12,-389564586),e=g(e,f,c,d,a[l+2],17,606105819),d=g(d,e,f,c,a[l+3],22,-1044525330),c=g(c,d,e,f,a[l+4],7,-176418897),f=g(f,c,d,e,a[l+5],12,1200080426),e=g(e,f,c,d,a[l+6],17,-1473231341),d=g(d,e,f,c,a[l+7],22,-45705983),c=g(c,d,e,f,a[l+8],7,1770035416),f=g(f,c,d,e,a[l+9],12,-1958414417),e=g(e,f,c,d,a[l+10],17,-42063),d=g(d,e,f,c,a[l+11],22,-1990404162),c=g(c,d,e,f,a[l+
12],7,1804603682),f=g(f,c,d,e,a[l+13],12,-40341101),e=g(e,f,c,d,a[l+14],17,-1502002290),d=g(d,e,f,c,a[l+15],22,1236535329),c=h(c,d,e,f,a[l+1],5,-165796510),f=h(f,c,d,e,a[l+6],9,-1069501632),e=h(e,f,c,d,a[l+11],14,643717713),d=h(d,e,f,c,a[l+0],20,-373897302),c=h(c,d,e,f,a[l+5],5,-701558691),f=h(f,c,d,e,a[l+10],9,38016083),e=h(e,f,c,d,a[l+15],14,-660478335),d=h(d,e,f,c,a[l+4],20,-405537848),c=h(c,d,e,f,a[l+9],5,568446438),f=h(f,c,d,e,a[l+14],9,-1019803690),e=h(e,f,c,d,a[l+3],14,-187363961),d=h(d,e,
f,c,a[l+8],20,1163531501),c=h(c,d,e,f,a[l+13],5,-1444681467),f=h(f,c,d,e,a[l+2],9,-51403784),e=h(e,f,c,d,a[l+7],14,1735328473),d=h(d,e,f,c,a[l+12],20,-1926607734),c=k(c,d,e,f,a[l+5],4,-378558),f=k(f,c,d,e,a[l+8],11,-2022574463),e=k(e,f,c,d,a[l+11],16,1839030562),d=k(d,e,f,c,a[l+14],23,-35309556),c=k(c,d,e,f,a[l+1],4,-1530992060),f=k(f,c,d,e,a[l+4],11,1272893353),e=k(e,f,c,d,a[l+7],16,-155497632),d=k(d,e,f,c,a[l+10],23,-1094730640),c=k(c,d,e,f,a[l+13],4,681279174),f=k(f,c,d,e,a[l+0],11,-358537222),
e=k(e,f,c,d,a[l+3],16,-722521979),d=k(d,e,f,c,a[l+6],23,76029189),c=k(c,d,e,f,a[l+9],4,-640364487),f=k(f,c,d,e,a[l+12],11,-421815835),e=k(e,f,c,d,a[l+15],16,530742520),d=k(d,e,f,c,a[l+2],23,-995338651),c=m(c,d,e,f,a[l+0],6,-198630844),f=m(f,c,d,e,a[l+7],10,1126891415),e=m(e,f,c,d,a[l+14],15,-1416354905),d=m(d,e,f,c,a[l+5],21,-57434055),c=m(c,d,e,f,a[l+12],6,1700485571),f=m(f,c,d,e,a[l+3],10,-1894986606),e=m(e,f,c,d,a[l+10],15,-1051523),d=m(d,e,f,c,a[l+1],21,-2054922799),c=m(c,d,e,f,a[l+8],6,1873313359),
f=m(f,c,d,e,a[l+15],10,-30611744),e=m(e,f,c,d,a[l+6],15,-1560198380),d=m(d,e,f,c,a[l+13],21,1309151649),c=m(c,d,e,f,a[l+4],6,-145523070),f=m(f,c,d,e,a[l+11],10,-1120210379),e=m(e,f,c,d,a[l+2],15,718787259),d=m(d,e,f,c,a[l+9],21,-343485551),c=n(c,p),d=n(d,t),e=n(e,q),f=n(f,v);return[c,d,e,f]},md5_cmn:function(a,b,c,d,e,f){var g=MD5.safe_add;return g(MD5.bit_rol(g(g(b,a),g(d,f)),e),c)},md5_ff:function(a,b,c,d,e,f,g){return MD5.md5_cmn(b&c|~b&d,a,b,e,f,g)},md5_gg:function(a,b,c,d,e,f,g){return MD5.md5_cmn(b&
d|c&~d,a,b,e,f,g)},md5_hh:function(a,b,c,d,e,f,g){return MD5.md5_cmn(b^c^d,a,b,e,f,g)},md5_ii:function(a,b,c,d,e,f,g){return MD5.md5_cmn(c^(b|~d),a,b,e,f,g)},safe_add:function(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535},bit_rol:function(a,b){return a<<b|a>>>32-b}}});
Z8.define("Z8.util.DelayedTask",{delay:function(a,b,c){this.cancel();this.fn=b;this.scope=c;this.params=Array.prototype.slice.call(arguments,3);0==a?(this.interval=0,this.timerFn(this)):this.interval=setInterval(this.timerFn,a,this)},cancel:function(){null!=this.interval&&(clearInterval(this.interval),this.interval=null)},timerFn:function(a){null!=a.interval&&(a.cancel(),a.fn.apply(a.scope,a.params))}});
Z8.define("Z8.Object",{dispose:function(){this.listeners=null;this.disposed=!0},on:function(a,b,c){var d=this.listeners=this.listeners||{};a=a.toLowerCase();var e=d[a]||[];e.push({fn:b,scope:c});d[a]=e},un:function(a,b,c){a=a.toLowerCase();b=this.listeners;if(null!=b&&null!=(b=b[a])){a=0;for(var d=b.length;a<d;a++)if(b[a].scope==c){b.removeAt(a);break}}},fireEvent:function(a){var b=this.listeners;if(null!=b&&null!=(b=b[a.toLowerCase()]))for(var b=[].concat(b),c=Array.prototype.slice.call(arguments,
1),d=0,e=b.length;d<e;d++){var f=b[d];null!=f.fn&&f.fn.apply(f.scope,c)}}});
Z8.define("Z8.data.HttpRequest",{extend:"Z8.Object",shortClassName:"HttpRequest",isUpload:!1,isGet:!1,defaultUrl:"request.json",statics:{Timeout:0,status:{AccessDenied:401},state:{Unitialized:0,Loading:1,Loaded:2,Interactive:3,Complete:4},contentType:{FormUrlEncoded:"application/x-www-form-urlencoded; charset=UTF-8",FormMultipart:"multipart/form-data"},url:function(){var a=window.location,b=a.pathname;if(0!=b.length){var c=b.lastIndexOf("/");-1!=c&&(b=b.substr(0,c))}return a.origin+b},hostUrl:function(){return window.location.origin},
send:function(a,b){(new HttpRequest).send(a,b)},get:function(a,b){(new HttpRequest).get(a,b)},upload:function(a,b,c){(new HttpRequest).upload(a,b,c)}},constructor:function(a){this.callParent(a);a=this.xhr=new XMLHttpRequest;a.timeout=0;DOM.on(a,"load",this.onLoad,this);DOM.on(a,"error",this.onError,this);DOM.on(a,"abort",this.onError,this);DOM.on(a,"loadEnd",this.onLoadEnd,this)},send:function(a,b){this.data=a;this.callback=b;var c=this.xhr;c.open("POST",HttpRequest.url()+"/"+this.defaultUrl,!0);
c.setRequestHeader("Content-Type",HttpRequest.contentType.FormUrlEncoded);c.send(this.encodeData(a))},get:function(a,b){this.callback=b;this.isGet=!0;var c=this.xhr;c.open("GET",HttpRequest.url()+"/"+a,!0);c.setRequestHeader("Content-Type",HttpRequest.contentType.FormUrlEncoded);c.send()},upload:function(a,b,c){this.data=a;this.files=b;this.callback=c;this.isUpload=!0;c=this.xhr;c.open("POST",HttpRequest.url()+"/request.json",!0);c.send(this.encodeFormData(a,b))},onLoad:function(){this.isLoaded=!0;
var a=this.xhr;if(this.isGet)Z8.callback(this.callback,{text:a.responseText},200==a.status);else{var b={};try{b=JSON.decode(a.responseText)}catch(c){b.info={messages:[{time:new Date,type:"error",text:c.message}]};Z8.callback(this.callback,b,!1);this.processResponse(b);return}b.success?null==b.retry?(Z8.callback(this.callback,b,!0),this.processResponse(b)):HttpRequest.send({retry:b.retry,server:b.server},this.callback):this.relogin(b.status)||(b.info=b.info||{},Z8.callback(this.callback,b,!1),this.processResponse(b))}},
relogin:function(a){return this.isLogin||a!=HttpRequest.status.AccessDenied?!1:(Application.login({fn:this.onRelogin,scope:this}),!0)},onRelogin:function(){this.isUpload?HttpRequest.upload(this.data,this.files,this.callback):HttpRequest.send(this.data,this.callback)},onError:function(a){if(this.isLoaded)throw"HttpRequest.onError: this.isLoaded == true;";a={info:{messages:[{time:new Date,type:"error",text:"Communication failure"}]}};Z8.callback(this.callback,a,!1);this.processResponse(a)},onLoadEnd:function(){var a=
this.xhr;DOM.un(a,"load",this.onLoad,this);DOM.un(a,"timeout",this.onError,this);DOM.un(a,"error",this.onError,this);DOM.un(a,"abort",this.onError,this);DOM.un(a,"loadEnd",this.onLoadEnd,this);this.xhr=null},encodeData:function(a){var b=[];(this.isLogin=null!=a.login)?a.request="login":a.session=Application.session;for(var c in a){var d=a[c];Z8.isEmpty(d)||(String.isString(d)||(d=JSON.encode(d)),b.push(encodeURIComponent(c)+"="+encodeURIComponent(d)))}return b.join("&")},encodeFormData:function(a,
b){a.session=Application.session;var c=new FormData,d;for(d in a){var e=a[d];Z8.isEmpty(e)||c.append(d,String.isString(e)?e:JSON.encode(e))}d=0;for(e=b.length;d<e;d++){var f=b[d];c.append(f.name,f)}return c},processResponse:function(a){a=a.info;Application.message(a.messages);var b=a.files;if(null!=b)for(var c=0,d=b.length;c<d;c++)DOM.download(HttpRequest.hostUrl()+"/"+b[c].path,a.serverId)}});
Z8.define("Z8.data.Model",{extend:"Z8.Object",shortClassName:"Model",isModel:!0,local:!1,totals:!1,destroyed:!1,phantom:!1,idProperty:"recordId",lockProperty:"lock",periodProperty:null,filesProperty:null,fields:null,ordinals:null,modified:null,original:null,busy:0,statics:{activeSaves:0,idSeed:0,nextId:function(){Model.idSeed++;return"r-"+Model.idSeed},getFieldNames:function(a){var b=[];if(null==a)return b;for(var c=0,d=a.length;c<d;c++)b.push(a[c].name);return b}},constructor:function(a){var b=this.data=
{};this.editing=0;for(var c in a){var d=a[c],e=this.getField(c),d=null!=e?e.convert(d,this):d;b[c]=d}c=this.idProperty;d=this.id=null!=a?a[c]:null;null==d&&(d=this.id=Model.nextId(),b[c]=d,this.phantom=!0);c=this.parentIdProperty;null!=c&&(a=this.parentId=null!=a?a[c]:null,null==a&&(a=this.parentId=guid.Null,b[c]=a))},dispose:function(){this.store=null;this.callParent()},getName:function(){return this.name||this.$className},getSourceCodeLocation:function(){return this.sourceCode||this.name||this.$className},
isLocal:function(){return!0===this.local},isRemote:function(){return!0!==this.local},hasTotalCount:function(){return!1!==this.totalCount},hasTotals:function(){return!0===this.totals},getAccess:function(){return this.access},getIdProperty:function(){return this.idProperty},getParentIdProperty:function(){return this.parentIdProperty},getPeriodProperty:function(){return this.periodProperty},getFilesProperty:function(){return this.filesProperty},isEqual:function(a,b){return a instanceof Date&&b instanceof
Date?Date.isEqual(a,b):a==b},getFields:function(){return this.fields},getField:function(a){return this.fields[this.getOrdinals()[a]]},getLinks:function(){return this.links},getNames:function(){return this.names},getColumns:function(){return this.columns},getQuickFilters:function(){return this.quickFilters},getRequestFields:function(){return this.requestFields},getValueFor:function(){return this.valueFor},getValueFrom:function(){return this.valueFrom},getLink:function(){return this.link},getQuery:function(){return this.query},
getId:function(){return this.id},setId:function(a){this.set(this.idProperty,a)},getLock:function(){var a=this.lockProperty;return null==a?RecordLock.None:this.get(a)},getFiles:function(){var a=this.filesProperty;return null!=a?this.get(a):null},isEditable:function(){var a=this.getLock();return a!=RecordLock.Edit&&a!=RecordLock.Full},isDestroyable:function(){var a=this.getLock();return a!=RecordLock.Destroy&&a!=RecordLock.Full},getOrdinals:function(){if(null!=this.ordinals)return this.ordinals;for(var a=
this.self.ordinals={},b=this.fields,c=0,d=b.length;c<d;c++)a[b[c].name]=c;return a},isPhantom:function(){return this.phantom},isDirty:function(){return null!=this.modified},beginEdit:function(){this.editing++},cancelEdit:function(){this.editing=0;var a=this.data,b=this.modified;for(name in b)a[name]=b[name];this.modified=this.original=null},endEdit:function(){if(0==(this.editing=Math.max(0,this.editing-1))){var a=this.modified;if(null!=a&&0!=Object.keys(a).length){var b=this.store;if(null!=b)b.onRecordChanged(this,
a);this.fireEvent("change",this,a)}}},getModifiedFields:function(){var a={},b=this.modified,c=this.data,d;for(d in b)a[d]=c[d];return a},get:function(a){a=this.data[a];return void 0!==a?a:null},set:function(a,b,c,d){var e=this.data,f=e[a],g=this.getField(a),h=this.modified,k=this.original,m=this;null!=g&&(b=g.convert(b,this),m=g);if(d||!m.isEqual(f,b))if(c)e[a]=b;else if(null!=k&&k.hasOwnProperty(a)?null!=k&&(c=k[a],!d&&m.isEqual(c,b)?(delete h[a],0==Object.keys(h).length&&(this.original=this.modified=
null)):h[a]=f):(k=this.original=this.original||{},h=this.modified=this.modified||{},k[a]=f,h[a]=f),d=this.getIdProperty(),h=this.getParentIdProperty(),d==a?this.id=b:h==a&&(this.parentId=b),e[a]=b,!this.editing){b={};b[a]=f;a=this.store;if(null!=a)a.onRecordChanged(this,b);this.fireEvent("change",this,b)}},setStore:function(a){this.store=a},getServerData:function(a){a=this.isPhantom();var b={};this.destroyed||(a?Z8.apply(b,this.data):Z8.apply(b,this.getModifiedFields()));b[this.idProperty]=a?guid.Null:
this.id;return b},startOperation:function(){this.busy++;Z8.data.Model.activeSaves++},finishOperation:function(){this.busy--;Z8.data.Model.activeSaves--},isBusy:function(){return 0!=this.busy},reload:function(a,b){if(!1===this.getAccess().read)throw"Model "+this.getName()+" does not have read record privilege";if(this.destroyed)throw"record "+this.id+" is already destroyed";if(this.isPhantom())throw"phantom record can not be reloaded";this.executeAction("read",a,Z8.apply(b||{},{recordId:this.id}))},
create:function(a,b){if(!1===this.getAccess().create)throw"Model "+this.getName()+" does not have create record privilege";if(this.destroyed)throw"record "+this.id+" is already destroyed";if(!this.isPhantom())throw"new record must be a phantom";this.executeAction("create",a,b)},update:function(a,b){if(this.destroyed)throw"record "+this.id+" is already destroyed";if(this.isPhantom())throw"phantom record can not be updated";this.isDirty()?this.executeAction("update",a,b):Z8.callback(a,this,!0)},copy:function(a,
b,c){if(!1===this.getAccess().copy)throw"Model "+this.getName()+" does not have copy record privilege";if(this.destroyed)throw"record "+this.id+" is already destroyed";if(!this.isPhantom())throw"copy of the record "+this.id+" must be a phantom";this.executeAction("copy",b,Z8.apply(c||{},{recordId:a.id}))},destroy:function(a,b){if(!1===this.getAccess().destroy)throw"Model "+this.getName()+" does not have destroy record privilege";if(this.isPhantom()){var c=this.store;null!=c&&c.remove(this);Z8.callback(a,
this,!0)}else this.executeAction("destroy",a,b)},executeAction:function(a,b,c){this.isRemote()?(new Z8.data.Batch({model:this,singleMode:!0})).execute(a,[this],b,c):Z8.callback(b,this,!0)},onAction:function(a,b){if("destroy"!=a){this.phantom=!1;this.beginEdit();for(var c in b)this.set(c,b[c]);this.endEdit()}else c=this.store,null!=c&&c.remove(this),this.destroyed=!0},afterAction:function(a){this.modified=this.original=null},attach:function(a,b,c){if(!1===this.getAccess().update)throw"Model "+this.getName()+
" does not have update record privilege";for(var d=[],e=0,f=b.length;e<f;e++){var g=b[e];Application.checkFileSize(g)&&d.push(g)}0==d.length?Z8.callback(c,this,[],!1):(b={request:this.getName(),action:"attach",recordId:this.id,field:a},HttpRequest.upload(b,d,{fn:function(b,d){d?(this.set(a,b.data,!0),Z8.callback(c,this,this.get(a),!0)):Z8.callback(c,this,[],!1)},scope:this}))},detach:function(a,b,c){if(!1===this.getAccess().update)throw"Model "+this.getName()+" does not have update record privilege";
b={request:this.getName(),action:"detach",recordId:this.id,field:a,data:b};HttpRequest.send(b,{fn:function(b,e){e?(this.set(a,b.data,!0),Z8.callback(c,this,this.get(a),!0)):Z8.callback(c,this,[],!1)},scope:this})}});
Z8.define("Z8.data.Store",{extend:"Z8.Object",shortClassName:"Store",isStore:!0,filters:[],quickFilters:[],where:[],period:[],sorter:[],remoteFilter:!0,remoteSort:!0,page:0,limit:0,totalCount:0,loadCount:0,loading:0,loadIndex:0,transaction:0,autoDispose:!0,constructor:function(a){var b=a.data;delete a.data;this.callParent(a);this.useCount=0;this.inserted=[];this.positions=[];this.removed=[];this.setWhere(this.where);this.setFilter(this.filters);this.setQuickFilter(this.quickFilters);this.setPeriod(this.period);
this.setSorter(this.sorter);this.initRecords(b);0!=this.getCount()&&(this.loadTotalCount(),this.loadTotals())},use:function(){this.useCount++},dispose:function(){if(0!=this.useCount&&(this.useCount--,0==this.useCount)){for(var a=this.records,b=0,c=a.length;b<c;b++)a[b].dispose();delete this.records;this.callParent()}},getModel:function(){String.isString(this.model)&&(this.model=Z8.classes[this.model]);return this.model},getModelName:function(){return this.isRemote()?this.getModel().prototype.getName():
null},getSourceCodeLocation:function(){return this.isRemote()?this.getModel().prototype.getSourceCodeLocation():null},isLocal:function(){return this.getModel().prototype.isLocal()},isTree:function(){return null!=this.getParentIdProperty()},isRemote:function(){return this.getModel().prototype.isRemote()},hasTotals:function(){return this.getModel().prototype.hasTotals()},hasTotalCount:function(){return this.getModel().prototype.hasTotalCount()},getAccess:function(){return this.getModel().prototype.getAccess()},
hasReadAccess:function(){return!1!==this.getAccess().read},hasWriteAccess:function(){return!1!==this.getAccess().write},hasCreateAccess:function(){return!1!==this.getAccess().create},hasCopyAccess:function(){return!1!==this.getAccess().copy},hasDestroyAccess:function(){return!1!==this.getAccess().destroy},getIdProperty:function(){return this.getModel().prototype.getIdProperty()},getParentIdProperty:function(){return this.getModel().prototype.getParentIdProperty()},getPeriodProperty:function(){return this.getModel().prototype.getPeriodProperty()},
getFilesProperty:function(){return this.getModel().prototype.getFilesProperty()},getValueForFields:function(){return this.getModel().prototype.getValueFor()},getValueFromFields:function(){return this.getModel().prototype.getValueFrom()},getRecords:function(){return this.records},getRange:function(a,b){return this.records.slice(a,b+1)},getFields:function(){return this.getModel().prototype.getFields()},getRequestFields:function(){return this.getModel().prototype.getRequestFields()},getLink:function(){return this.getModel().prototype.getLink()},
getQuery:function(){return this.getModel().prototype.getQuery()},getField:function(a){return this.getModel().prototype.getField(a)},getNames:function(){return this.getModel().prototype.getNames()},getColumns:function(){return this.getModel().prototype.getColumns()},getQuickFilters:function(){return this.getModel().prototype.getQuickFilters()},getCount:function(){return this.records.length},getTotalCount:function(){return this.isRemote()?this.totalCount:this.getCount()},getTotals:function(){return this.totals},
getRemoteFilter:function(){return this.isRemote()&&this.remoteFilter},getRemoteSort:function(){return this.isRemote()&&this.remoteSort},isEmpty:function(){return 0==this.getCount()},getAt:function(a){return this.records[a]},indexOf:function(a){return null!=a?this.getOrdinals()[a.id]:null},getById:function(a){return this.records[this.getOrdinals()[a]]},add:function(a){this.insert(a,this.getCount())},attach:function(a){this.setStore(a,this)},detach:function(a){this.setStore(a,null)},beginTransaction:function(){this.transaction++},
commit:function(){if(0==(this.transaction=Math.max(this.transaction-1,0))){var a=this.removed,b=!Z8.isEmpty(a),c=this.inserted,d=!Z8.isEmpty(c);if(b||d){var e=this.records;this.ordinals=null;b&&(e.removeAll(a),this.detach(a),this.totalCount-=a.length,this.fireEvent("remove",this,a));if(d){for(var d=[],f=this.positions,a=0,b=c.length;a<b;a++){var g=c[a];e.insert(g,f[a]);d=d.concat(g)}this.attach(d);this.totalCount+=d.length;this.treefyRecords();c=this.getIndexRanges(d);if(Array.isArray(c))for(a=0,
b=c.length;a<b;a++)e=c[a],d=e[0],this.fireEvent("add",this,this.getRange(d,e[e.length-1]),d);else this.fireEvent("add",this,this.getRange(c,c+d.length-1),c)}this.inserted=[];this.positions=[];this.removed=[];this.loadTotals()}}},rollback:function(){0==(this.transaction=Math.max(this.transaction-1,0))&&(this.inserted=[],this.positions=[],this.removed=[])},setStore:function(a,b){a=Array.isArray(a)?a:[a];for(var c=0,d=a.length;c<d;c++)a[c].setStore(b)},insert:function(a,b){null!=a&&0!=a.length&&(this.inserted.push(a),
this.positions.add(b),0==this.transaction&&this.commit())},remove:function(a){null!=a&&(a=Array.isArray(a)?a:[a],this.removed.add(a),0==this.transaction&&this.commit())},removeAll:function(){this.removed=[].concat(this.records);0==this.transaction&&this.commit()},removeAt:function(a){0>a||a>this.getCount()||this.remove([this.records[a]])},getIndexRanges:function(a){var b=this.getOrdinals(),c=[],d=a.length;if(1==d)return b[a[0].id];for(var e=0;e<d;e++)c.push(b[a[e].id]);c.sort(Number.compare);a=c[0];
for(var b=[c[0]],f=[b],e=1,d=c.length;e<d;e++){var g=c[e];a+1!=g?(b=[g],f.push(b)):b.push(g);a=g}return 1==f.length?f[0][0]:f},getOrdinals:function(){if(null!=this.ordinals)return this.ordinals;for(var a=this.ordinals={},b=this.records,c=0,d=b.length;c<d;c++)a[b[c].id]=c;return a},getValues:function(){return this.values},setValues:function(a){this.values=a},getWhere:function(){return this.where},setWhere:function(a){a=a||[];return this.where=Array.isArray(a)?a:[a]},getFilter:function(){return this.filters},
setFilter:function(a){this.page=0;a=a||[];return this.filters=Array.isArray(a)?a:[a]},getQuickFilter:function(){return this.quickFilters},setQuickFilter:function(a){this.page=0;a=a||[];return this.quickFilters=Array.isArray(a)?a:[a]},getPeriod:function(){return this.period},setPeriod:function(a){this.page=0;return this.period=a},getSorter:function(){return this.sorter},setSorter:function(a){a=a||[];return this.sorter=Array.isArray(a)?a:[a]},filter:function(a,b){this.setFilter(a);if(this.getRemoteFilter())this.load(b);
else{this.filterRecords();var c=this.records;this.fireEvent("load",this,c,!0);Z8.callback(b,this,c,!0)}},quickFilter:function(a,b){this.setQuickFilter(a);if(this.getRemoteFilter())this.load(b);else{this.filterRecords();var c=this.records;this.fireEvent("load",this,c,!0);Z8.callback(b,this,c,!0)}},sort:function(a,b){this.setSorter(a);if(this.getRemoteSort())this.load(b);else{this.sortRecords();var c=this.getRecords();this.fireEvent("load",this,c,!0);Z8.callback(b,this,c,!0)}},initRecords:function(a){var b=
void 0!=a;a=a||[];var c=this.records=[];this.ordinals=null;if(b){for(var b=this.getModel(),d=0,e=a.length;d<e;d++){var f=Z8.create(b,a[d]);this.attach(f);c.push(f)}this.isLocal()&&0!=this.getSorter().length&&this.sortRecords();this.loadCount++}return c},isLoaded:function(){return 0!=this.loadCount||this.isLocal()},isLoading:function(){return 0!=this.loading},getLoadParams:function(){return{action:"read",request:this.getModelName(),link:this.getLink(),query:this.getQuery(),fields:Model.getFieldNames(this.getRequestFields()),
where:this.getWhere(),filter:this.getFilter(),quickFilter:this.getQuickFilter(),sort:this.getSorter(),period:this.getPeriod(),values:this.getValues(),start:this.page*this.limit,limit:this.limit}},load:function(a){this.fireEvent("beforeLoad",this);var b=this.getLoadParams();this.loadIndex++;this.sendLoadRequest(b,{fn:function(b,d){var c=d?this.initRecords(b.data||[]):[];this.fireEvent("load",this,c,d);Z8.callback(a,this,c,d);d&&(this.loadTotalCount(),this.loadTotals())},scope:this})},loadTotalCount:function(a){if(this.hasTotalCount()){var b=
this.getCount();0!=b&&this.isRemote()?(b=this.getLoadParams(),b.count=!0,this.fireEvent("beforeCount",this),this.sendLoadRequest(b,{fn:function(b,d){d&&(this.calcTotalCount(b.total||0),this.fireEvent("count",this,!0));Z8.callback(a,this,d)},scope:this})):(this.calcTotalCount(b),this.fireEvent("count",this,!0),Z8.callback(a,this,!0))}},calcTotalCount:function(a){this.totalCount=a;var b=this.limit||0;this.page=0!=b&&0!=a?Math.min(this.page||0,Math.floor(a/b)+(0==a%b?0:1)-1):0},loadTotals:function(a){if(this.hasTotals())if(0!=
this.getCount()&&this.isRemote()){var b=this.getLoadParams();b.totals=!0;this.sendLoadRequest(b,{fn:function(b,d){var c=this.totals=Z8.create(this.getModel(),d?b.data:{});this.fireEvent("totals",this,c,d);Z8.callback(a,this,c,d)},scope:this})}else b=this.totals=this.calcTotals(),this.fireEvent("totals",this,b,!0),Z8.callback(a,this,b,!0)},sendLoadRequest:function(a,b){this.loading++;var c=this.loadIndex;HttpRequest.send(a,{fn:function(a,e){this.loading--;c==this.loadIndex&&Z8.callback(b,a,e)},scope:this})},
loadData:function(a){a=this.initRecords(a);this.fireEvent("load",this,a,!0)},loadPage:function(a,b){this.page=a;this.load(b)},unload:function(){this.loadCount=0},onRecordChanged:function(a,b){var c=this.getIdProperty(),d=this.getParentIdProperty();if(c in b)this.onIdChanged(a,b[c]);if(null!=d&&d in b)this.onParentIdChanged(a,b[d]);this.loadTotals()},onIdChanged:function(a,b){var c=this.ordinals;null!=c&&(index=c[b],c[a.id]=index,delete c[b]);this.fireEvent("idChange",this,a,b)},onParentIdChanged:function(a,
b){this.treefyRecords();this.fireEvent("load",this,this.getRecords(),!0)},sortRecords:function(){var a=this.getSorter();if(0!=a.length){for(var b=[],c=0,d=a.length;c<d;c++)b.push(this.getField(a[c].property));this.records.sort(function(c,d){for(var e=0,f=a.length;e<f;e++){var k=a[e],m=k.property;c=c.get(m);d=d.get(m);m=b[e].compare(c,d);if(0!=m)return"asc"==k.direction?m:-m}return 0});this.ordinals=null}},filterRecords:function(){var a=this.filters.concat(this.where).concat(this.quickFilters).concat(this.period);
null!=this.recordsCache&&(this.records=this.recordsCache,this.ordinals=this.recordsCache=null);if(0!=a.length){for(var b=this.recordsCache=this.records,c=this.records=[],d=0,e=b.length;d<e;d++){for(var f=b[d],g=0,h=a.length;g<h&&Operator.applyFilter(f,a[g]);g++);g==h&&c.push(f)}this.ordinals=null}},treefyRecords:function(){this.sortRecords();if(this.isTree()){for(var a={},b=[],c=this.getRecords(),d=0,e=c.length;d<e;d++){var f=c[d],g=f.parentId;if(g!=guid.Null){var h=a[g];null==h&&(a[g]=h=[]);h.push(f)}else b.push(f)}var k=
function(b,c){for(var d=0,e=b.length;d<e;d++){var f=b[d],g=a[f.id],h=f.data;h.hasChildren=null!=g;h.level=c;m.push(f);null!=g&&k(g,c+1)}},m=[];k(b,0);this.records=m;this.ordinals=null}},calcTotals:function(){return this.totals=Z8.create(this.getModel(),{})}});
Z8.define("Z8.data.Batch",{extend:"Z8.Object",model:null,store:null,singleMode:!1,getModel:function(){null!=this.store&&(this.model=this.store.getModel());var a=this.model;String.isString(a)&&(a=this.model=Z8.classes[this.model]);"function"==typeof a&&(a=this.model=a.prototype);return a},getServerData:function(a,b){for(var c=[],d=0,e=a.length;d<e;d++)c.push(a[d].getServerData(b));return c},create:function(a,b,c){this.execute("create",a,b,c)},update:function(a,b,c){this.execute("update",a,b,c)},destroy:function(a,
b,c){this.execute("destroy",a,b,c)},execute:function(a,b,c,d){var e=this.singleMode;if(e&&Array.isArray(b)&&1!=b.length)throw"Multiple records can not be saved in single mode";b=Array.isArray(b)?b:[b];var f=this.getModel(),g=this.getServerData(b,a),f={request:f.getName(),action:a,data:g,fields:Model.getFieldNames(f.getRequestFields()),link:f.getLink(),query:f.getQuery()};Z8.apply(f,d);this.beginTransaction();HttpRequest.send(f,{fn:function(d,f){if(f){for(var g=d.data||[],h=0,k=b.length;h<k;h++)b[h].onAction(a,
g[h]);this.commit();Z8.callback(c,e?b[0]:b,!0);h=0;for(k=b.length;h<k;h++)b[h].afterAction(a)}else this.rollback(),Z8.callback(c,e?b[0]:b,!1)},scope:this})},beginTransaction:function(){null!=this.store&&this.store.beginTransaction()},commit:function(){null!=this.store&&this.store.commit()},rollback:function(){null!=this.store&&this.store.rollback()}});
Z8.define("Z8.data.Action",{extend:"Z8.Object",statics:{actionsQueue:[]},target:"ru.ivk.postfactor.desktops.Actions",execute:function(a){this.options=a;this.getParameters(a)},getParameters:function(a){var b=function(b){var c=a.records||[];this.fireEvent("beforeaction",this,a);this.executeAction(c,b)},c=function(){Z8.callback(this.options,this,null,!1)};if(null!=this.form){var d=a.records||[],e={},f=this.form;"object"==typeof this.form&&(f=e.type,delete e.type,e=Z8.apply({},this.form));e.records=d;
e=Z8.create(f,e);e.on("ok",b,this);e.on("cancel",c,this);e.show()}else b.call(this,null)},executeAction:function(a,b){b=Z8.apply(this.options.parameters||{},b);var c={xaction:"command",request:this.target,command:this.command||this.id,parameters:b,data:this.global?[]:this.getRecordIds(a)};Z8.data.Action.actionsQueue.push(this);this.delayedRequest(c,function(a,b){Z8.data.Action.actionsQueue.shift();Z8.callback(this.options,this,a,b);this.fireEvent("action",this,b)})},delayedRequest:function(a,b){0!=
Z8.data.Model.activeSaves||Z8.data.Action.actionsQueue[0]!=this?(this.task=this.task||new Z8.util.DelayedTask,this.task.delay(100,this.delayedRequest,this,a,b)):HttpRequest.send(a,{fn:b,scope:this})},getRecordIds:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].id);return b}});
Z8.define("Z8.data.Filter",{shortClassName:"Filter",statics:{NoAction:0,Apply:1,Clear:2},active:!1,current:null,constructor:function(a){this.callParent(a);this.filters=this.filters||{}},isActive:function(){return this.active&&!this.isEmpty()},isEmpty:function(){return null==this.current},setActive:function(a){this.active=a},getActive:function(){return this.active?this.getCurrent():null},getNames:function(){return Object.keys(this.filters)},get:function(a){return this.filters[a]},getCurrent:function(){return this.get(this.current)},
setCurrent:function(a){this.current=a},add:function(a,b){this.filters[a]=b},remove:function(a){delete this.filters[a];this.current==a&&(this.current=null)},clear:function(){this.filters={};this.current=null},toJson:function(){return{active:this.active,current:this.current,filters:this.filters}},toStoreData:function(){var a=[],b=this.filters,c;for(c in b)a.push({name:c,filter:b[c]});return a}});
Z8.define("Z8.data.Period",{shortClassName:"Period",statics:{NoAction:0,Apply:1,Clear:2},constructor:function(a){this.callParent(a);this.start=Parser.date(this.start);this.finish=Parser.date(this.finish)},isActive:function(){return this.active},setActive:function(a){this.active=a},getStart:function(){return this.active?this.start:null},setStart:function(a){this.start=Parser.date(a)},getFinish:function(){return this.active?this.finish:null},setFinish:function(a){this.finish=Parser.date(a)},getActive:function(a){return this.active?
this.get():null},get:function(a){var b=[];null!=this.start&&b.push({property:a,operator:Operation.GE,value:this.start});null!=this.finish&&b.push({property:a,operator:Operation.LE,value:this.finish});return b},getText:function(){var a=this.start,b=this.finish;if(null==a&&null==b)return null;if(null!=a&&null!=b){if(Date.isEqualDate(a,b))return Format.date(a,Format.Date);var c=Format.Date;a.getYear()==b.getYear()&&(c=a.getMonth()==b.getMonth()?"d":"d.m");return Format.date(a,c)+" - "+Format.date(b,
Format.Date)}return(null!=a?"\u043f\u043e\u0441\u043b\u0435":"\u0434\u043e")+" "+Format.date(a||b,Format.Date)},toJson:function(){return{active:this.active,start:this.start,finish:this.finish}}});
Z8.define("Z8.data.field.Field",{isField:!0,name:null,type:Type.String,persist:!0,constructor:function(a){this.callParent(a)},compare:function(a,b){return null!=a&&""!==a||null!=b&&""!==b?a==b?0:a<b?-1:1:0},isEqual:function(a,b){return 0==this.compare(a,b)},getType:function(){return this.type},serialize:function(a,b){return a},convert:function(a,b){return a}});Z8.define("Z8.data.field.String",{extend:"Z8.data.field.Field",type:Type.String});
Z8.define("Z8.data.field.Boolean",{extend:"Z8.data.field.Field",type:Type.Boolean,convert:function(a){return"boolean"!=typeof a?"true"==a:a}});Z8.define("Z8.data.field.Datetime",{extend:"Z8.data.field.Field",type:Type.Datetime,format:Format.Datetime,compare:function(a,b){return Date.isDate(a)&&Date.isDate(b)?a.getTime()-b.getTime():a==b?0:-1},convert:function(a){return Date.isDate(a)?a:Z8.isEmpty(a)?null:new Date(a)},serialize:function(a){return Date.isDate(a)?a.toISOString():""}});
Z8.define("Z8.data.field.Date",{extend:"Z8.data.field.Datetime",type:Type.Date,format:Format.Date});Z8.define("Z8.data.field.Guid",{extend:"Z8.data.field.String",type:Type.Guid});Z8.define("Z8.data.field.Float",{extend:"Z8.data.field.Field",type:Type.Integer,convert:function(a){if(Number.isNumber(a))return a;if(null==a||""==a)return 0;a=parseFloat(a);return isNaN(a)?0:a}});
Z8.define("Z8.data.field.Integer",{extend:"Z8.data.field.Float",type:Type.Integer,convert:function(a){a=this.callParent(a);return 0<a?Math.floor(a):Math.ceil(a)}});
Z8.define("Z8.data.field.Json",{extend:"Z8.data.field.String",convert:function(a){if(!String.isString(a))return a;try{return""!=a?JSON.decode(a):null}catch(b){return null}},serialize:function(a){return null!=a?JSON.encode(a):null},compare:function(a,b){a=String.isString(a)?a:JSON.encode(a);b=String.isString(b)?b:JSON.encode(b);return a==b?0:-1}});Z8.define("Z8.data.field.Files",{extend:"Z8.data.field.Json",type:Type.Files,convert:function(a){return this.callParent(a)||[]}});
Z8.define("Z8.Component",{extend:"Z8.Object",shortClassName:"Component",isComponent:!0,enabled:!0,tabIndex:-1,statics:{idSeed:0,nextId:function(){this.idSeed++;return"id"+this.idSeed},destroy:function(a){if(null!=a)for(var b=Array.isArray(a)?a:[a],c=0,d=b.length;c<d;c++)a=b[c],null==a||a.disposed||(a.isComponent?b[c].destroy():DOM.isDom(a)?DOM.remove(a):null!=a.dom&&(DOM.remove(a.dom),a.dom=null))}},constructor:function(a){this.callParent(a);this.initComponent()},initComponent:function(){null==this.id&&
(this.id=Z8.Component.nextId());this.enabledLock=!this.enabled},getId:function(){return this.id},getDom:function(){return this.dom},getTitle:function(){return this.title},setTitle:function(a){this.title=a},isEnabled:function(){return this.enabled},setEnabled:function(a){this.enabled=a;this.setTabIndex(a?this.tabIndex:-1)},getTabIndex:function(){return this.enabled?this.tabIndex:-1},setTabIndex:function(a){-1!=a&&(this.tabIndex=a);return a},setText:function(a){DOM.setInnerHTML(this,a)},isVisible:function(){return this.visible},
show:function(){this.visible=!0;DOM.removeCls(this,"display-none")},hide:function(){this.visible=!1;DOM.addCls(this,"display-none")},focus:function(){return this.isEnabled()?DOM.focus(this):!1},selectNode:function(a){return DOM.selectNode(this,a)},queryNodes:function(a){return DOM.query(this,a)},appendTo:function(a){var b=this.dom;null==b?this.render(a):DOM.append(a,b)},render:function(a){if(null==this.dom){var b=this.htmlMarkup();this.dom=DOM.append(a,b);this.renderDone()}},getWidth:function(){var a=
this.dom;return null!=a?Ems.pixelsToEms(a.offsetWidth):0},getHeight:function(){var a=this.dom;return null!=a?Ems.pixelsToEms(a.offsetHeight):0},getMinWidth:function(){return this.minWidth||this.width||0},getMinHeight:function(){return this.minHeight||this.height||0},getBoxMinWidth:function(){return this.getMinWidth()},getBoxMinHeight:function(){return this.getMinHeight()},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},updateSize:function(){var a=this.width;(0<a||String.isString(a))&&
DOM.setPoint(this,"width",a);a=this.height;(0<a||String.isString(a))&&DOM.setPoint(this,"height",a);a=this.getMinWidth();(0<a||String.isString(a))&&DOM.setPoint(this,"minWidth",a);a=this.getMinHeight();(0<a||String.isString(a))&&DOM.setPoint(this,"minHeight",a)},completeRender:function(){this.updateSize();for(var a=this.subcomponents(),b=0,c=a.length;b<c;b++){var d=a[b];null!=d&&null==d.dom&&(null!=d.id&&(d.dom=this.selectNode("#"+d.id)),d.isComponent&&d.completeRender())}},afterRender:function(){for(var a=
this.subcomponents(),b=0,c=a.length;b<c;b++){var d=a[b];null!=d&&!d.afterRenderCalled&&d.isComponent&&(d.afterRender(),d.afterRenderCalled=!0)}null!=this.renderOptions&&Z8.callback(this.renderOptions)},renderDone:function(){this.completeRender();this.afterRender()},destroy:function(){this.destroying=!0;this.onDestroy();this.destroying=!1;this.dispose()},onDestroy:function(){Component.destroy(this.subcomponents());DOM.remove(this);this.alignment=this.dom=null},subcomponents:function(){return[]},htmlMarkup:function(){return{id:this.getId(),
cls:DOM.parseCls(this.cls).join(" "),tabIndex:this.getTabIndex(),html:this.html||""}},setPosition:function(a,b){DOM.setPoint(this,"left",a);DOM.setPoint(this,"top",b)},setAlignment:function(a){this.alignment=a},setAlignmentOffset:function(a,b,c){this.alignmentOffset={width:a,height:b,margin:c}},getClipping:function(){null==this.clipping&&(this.clipping=DOM.getClipping(this));return this.clipping},align:function(){var a=this.alignment,b=this.getClipping(),c=new Rect(b),b=new Rect(a||this);null==a&&
(b.height=b.width=0,b.bottom=b.top,b.right=b.left);var d=new Rect(DOM.getParent(this)),e=this.alignmentOffset||{width:0,height:0,margin:5},f=DOM.getComputedStyle(this),g=parseFloat(f.height)+parseInt(f.marginTop)+parseInt(f.marginBottom),g=Ems.pixelsToEms(g)+e.height,f=parseFloat(f.width)+parseInt(f.marginLeft)+parseInt(f.marginRight),f=Ems.pixelsToEms(f)+e.width,h=b.top-c.top,k=c.right-b.left,m=c.bottom-b.bottom,c=!1,n=m;m<g&&(h>=g||m<h)&&(c=!0,n=h);h=new Rect;f+=e.margin;h.left=b.left-(k<f?f-k:
0);c?(h.bottom=b.top-e.height,h.top=h.bottom-(Math.min(n,g)-e.height)+(n<g?e.margin:0)):(h.top=b.top+b.height,h.bottom=h.top+(Math.min(n,g)-e.height)-(n<g?e.margin:0));h.left-=d.left;h.top-=d.top;h.bottom=d.bottom-h.bottom;DOM.setLeft(this,h.left);DOM.setTop(this,h.top);null!=a&&DOM.setBottom(this,h.bottom);DOM.swapCls(this,c,"pull-up","pull-down");this.fireEvent("align",this)}});
Z8.define("Z8.Container",{extend:"Z8.Component",isContainer:!0,constructor:function(a){a=a||{};var b=a.items=a.items||[];a.minHeight=!1;for(var c=0,d=b.length;c<d;c++)b[c].container=this;this.callParent(a)},subcomponents:function(){return this.items},htmlMarkup:function(){for(var a=[],b=this.items,c=0,d=b.length;c<d;c++){var e=b[c];e.container=this;a.push(null!=e.htmlMarkup?e.htmlMarkup():e)}b=this.cls=DOM.parseCls(this.cls);return{id:this.getId(),cls:b.join(" "),tabIndex:this.getTabIndex(),cn:a}},
onDestroy:function(){Component.destroy(this.items);this.callParent()},getCount:function(){return this.items.length},indexOf:function(a){return this.items.indexOf(a)},add:function(a,b){for(var c=this.items,d=a,e=Array.isArray(a)?a:[a],f=0,g=e.length;f<g;f++)if(a=e[f],-1==this.indexOf(a)){var h=a.container;null!=h&&h!=this&&h.items.remove(a);a.container=this;h=null!=b?c[b]:null;c.insert(a,b);null!=b&&b++;if(null!=this.getDom()){var k=a.dom;null==k?(k=null!=a.isComponent?a.htmlMarkup():a,a.dom=null!=
h?DOM.insertBefore(h,k):DOM.append(this,k),a.isComponent&&a.renderDone()):null!=h?DOM.insertBefore(h,k):DOM.append(this,k)}}return d},remove:function(a){var b=this.items;a=Array.isArray(a)?b.removeAll(a):Number.isNumber(a)?b.removeAt(a):b.remove(a);Component.destroy(a)},removeAll:function(){Component.destroy(this.items);this.items=[]},focus:function(){for(var a=this.items,b=0,c=a.length;b<c;b++){var d=a[b];if(null!=d.focus&&d.focus())return!0}return this.callParent()},setEnabled:function(a){this.callParent(a);
for(var b=this.items,c=0,d=b.length;c<d;c++){var e=b[c];e.isComponent&&!e.enabledLock&&e.setEnabled(a)}}});
Z8.define("Z8.button.Button",{extend:"Z8.Component",tabIndex:0,text:"",icon:null,primary:!1,danger:!1,success:!1,info:!1,split:!1,trigger:null,menu:null,toggle:!1,toggled:null,vertical:!1,busy:!1,tooltip:"",triggerTooltip:"",iconTag:"i",initComponent:function(){this.callParent()},htmlMarkup:function(){this.setIcon(this.icon).join(" ");this.toggle=this.toggle||null!=this.toggled;this.split=this.split||null!=this.menu;var a=DOM.parseCls(this.iconCls).join(" "),a={tag:this.iconTag,icon:this.getId(),
cls:a,html:String.htmlText()},b={tag:"span",cls:"text",html:String.htmlText(this.text)},c=this.tooltip||"",b={tag:"a",anchor:this.getId(),cls:this.getButtonCls().join(" "),tabIndex:this.getTabIndex(),title:c,cn:[a,b]};if(!this.split)return b.id=this.getId(),b;a=this.trigger=new Z8.button.Trigger({cls:this.cls,primary:this.primary,danger:this.danger,success:this.success,info:this.info,tooltip:this.triggerTooltip,icon:this.triggerIcon,tabIndex:this.getTabIndex(),enabled:this.enabled});b=[b,a.htmlMarkup()];
c=this.menu;null!=c&&(c.owner=a,b.push(c.htmlMarkup()));return{tag:"div",id:this.getId(),cls:"btn-group"+(this.vertical?"-vertical":""),cn:b}},subcomponents:function(){return this.split?null!=this.menu?[this.trigger,this.menu]:[this.trigger]:[]},completeRender:function(){this.callParent();this.button=this.selectNode("a[anchor="+this.getId()+"]")||this.getDom();this.icon=this.selectNode(this.iconTag+"[icon="+this.getId()+"]");this.textElement=this.selectNode(".text");this.disableEvents||(DOM.on(this,
"click",this.onClick,this),DOM.on(this,"keyDown",this.onKeyDown,this));var a=this.menu;null!=a&&(a.setAlignment(this),a.on("show",this.onMenuShow,this),a.on("hide",this.onMenuHide,this))},onDestroy:function(){DOM.un(this,"click",this.onClick,this);DOM.un(this,"keyDown",this.onKeyDown,this);this.button=this.icon=this.textElement=null;this.callParent()},setEnabled:function(a){this.wasEnabled=a;DOM.swapCls(this.button,!a,"disabled");null!=this.trigger&&this.trigger.setEnabled(a);this.callParent(a)},
getButtonTypeCls:function(){return this.primary?"btn-primary":this.danger?"btn-danger":this.success?"btn-success":this.info?"btn-info":"btn-default"},getButtonCls:function(){var a=DOM.parseCls(this.cls).pushIf("btn",this.getButtonTypeCls());this.isEnabled()||a.pushIf("disabled");this.toggle&&this.toggled&&a.pushIf("active");return a},getIconCls:function(a){var b=DOM.parseCls(a).pushIf("fa");Z8.isEmpty(a)&&b.pushIf("no-icon");Z8.isEmpty(this.text)&&b.pushIf("no-text");return b},setIcon:function(a){a=
this.iconCls=this.getIconCls(a);DOM.setCls(this.icon,this.iconCls);return a},setPrimary:function(a){this.primary=a;DOM.swapCls(this.button,a,"btn-primary","btn-default");null!=this.trigger&&this.trigger.setPrimary(a)},setTabIndex:function(a){a=this.callParent(a);DOM.setTabIndex(this.button,a);null!=this.trigger&&this.trigger.setTabIndex(a)},getText:function(){return this.text},setText:function(a){this.text=a||"";var b=Z8.isEmpty(a);DOM.setValue(this.textElement,String.htmlText(a));this.iconCls=DOM.swapCls(this.icon,
b,"no-text")||this.iconCls},setTooltip:function(a){this.tooltip=a||"";DOM.setAttribute(this.button,"title",a)},isRadio:function(){var a=this.container;return null!=a&&a.radio},setToggled:function(a,b){this.toggle=!0;this.toggled=a;DOM.swapCls(this.button,a,"active");if(!b){if(this.isRadio())this.container.onRadioToggle(this,a);this.fireEvent("toggle",this,a)}},isBusy:function(){return this.busy},setBusy:function(a){if(this.busy!=a){if(this.busy=a){this.cachedIconCls=this.iconCls;var b=this.isEnabled();
this.setEnabled(!1);this.wasEnabled=b;this.setIcon(["fa-circle-o-notch","fa-spin"])}else this.setEnabled(this.wasEnabled),this.setIcon(this.cachedIconCls);DOM.swapCls(this,a,"z-index-10")}},focus:function(){return this.isEnabled()?DOM.focus(this.button):!1},onClick:function(a,b){a.stopEvent();if(this.isEnabled()){var c=DOM.isParentOf(this.button,b),d=!c&&DOM.isParentOf(this.trigger,b);if(c&&this.toggle)this.setToggled(this.isRadio()?!0:!this.toggled,!1);else if(d&&null!=this.menu)this.toggleMenu();
else if(c||d)Z8.callback(c?this.handler:this.triggerHandler,this.scope,this),this.fireEvent(c?"click":"triggerClick",this)}},onKeyDown:function(a,b){if(this.isEnabled()){var c=a.getKey();if(c==Event.ENTER||c==Event.SPACE)this.onClick(a,DOM.isParentOf(this.menu,b)?this.trigger.button.getDom():b);else if((c==Event.DOWN||c==Event.UP||c==Event.HOME||c==Event.END)&&null!=this.menu)this.onClick(a,this.trigger.button)}},toggleMenu:function(){this.menu.toggle()},onMenuShow:function(){DOM.addCls(this,"open");
this.trigger.rotateIcon(180)},onMenuHide:function(){DOM.removeCls(this,"open");this.trigger.rotateIcon(0);DOM.focus(this.trigger)},rotateIcon:function(a){DOM.rotate(this.icon,a)}});Z8.define("Z8.button.Trigger",{extend:"Z8.button.Button",tabIndex:-1,constructor:function(a){a=a||{};a.cls=DOM.parseCls(a.cls).concat(["btn-trigger"]);a.icon=a.icon||"fa-caret-down";a.iconTag=a.iconTag||"span";a.text="";a.disableEvents=!0;this.callParent(a)}});
Z8.define("Z8.button.Tool",{extend:"Z8.button.Button",tabIndex:-1,initComponent:function(){this.cls=DOM.parseCls(this.cls).pushIf("btn-sm");this.callParent()}});
Z8.define("Z8.button.File",{extend:"Z8.button.Button",initComponent:function(){this.callParent();this.on("click",this.processClick,this)},completeRender:function(){this.callParent();var a=this.fileInput=DOM.append(this,{tag:"input",type:"file",multiple:!0});DOM.on(a,"change",this.onFileInputChange,this)},onDestroy:function(){DOM.un(this.fileInput,"change",this.onFileInputChange,this);delete this.fileInput;this.callParent()},processClick:function(){this.fileInput.value=null;this.fileInput.click()},
onClick:function(a,b){b!=this.fileInput&&this.callParent(a,b)},onFileInputChange:function(){var a=this.fileInput.files;null!=a.length&&this.fireEvent("select",this,a)}});
Z8.define("Z8.button.Group",{extend:"Z8.Container",vertical:!1,radio:!1,constructor:function(a){a=a||{};a.items=a.items||[];this.callParent(a);this.cls=DOM.parseCls(this.cls).pushIf("btn-group"+(this.vertical?"-vertical":""))},getToggled:function(){return this.toggled},onRadioToggle:function(a,b){for(var c=this.items,d=0,e=c.length;d<e;d++){var f=c[d];f!=a&&f.toggled&&f.setToggled(!1,!0)}this.toggled=a},setTabIndex:function(a){a=this.callParent(a);for(var b=this.items,c=0,d=b.length;c<d;c++){var e=
b[c];e.isComponent&&e.setTabIndex(a)}},focus:function(){if(this.enabled){var a=this.getToggled();return null!=a&&a.focus()?!0:this.callParent()}return!1}});
Z8.define("Z8.calendar.Markup",{statics:{get:function(a){var b=a.date,c=this.getHeader(b),d=this.getDaysOfWeek(b),e=this.getDays(b),b=a.time?this.getTime(b):null;return{cls:DOM.parseCls(a.cls).pushIf("calendar").join(" "),id:a.id,cn:[c,d,e,b]}},getHeader:function(a){return{cls:"header",cn:[{tag:"span",cls:"fa fa-chevron-left previous-month",tabIndex:0},{tag:"span",month:a.getMonth(),cls:"month",tabIndex:0,html:a.getMonthName()},{tag:"span",year:a.getFullYear(),cls:"year",tabIndex:0,html:a.getFullYear()},
{tag:"span",cls:"fa fa-chevron-right next-month",tabIndex:0},this.getMonths(a),this.getYears(a)]}},getYears:function(a){var b=[];a=a.getFullYear();b.push({cls:"fa fa-chevron-left previous-year",tabIndex:0});for(var c=0;12>c;c++)b.push({cls:"year year-"+c+(c==a?" selected":""),tabIndex:a==c?0:-1,index:c,year:a+c,dropdown:!0,html:a+c});b.push({cls:"fa fa-chevron-right next-year",tabIndex:0});return{cls:"years display-none",cn:b}},getMonths:function(a){var b=[];a=null!=a?a.getMonth():-1;for(var c=0;12>
c;c++)b.push({cls:"month month-"+c+(a==c?" selected":""),tabIndex:a==c?0:-1,index:c,month:c,dropdown:!0,html:Date.MonthShortNames[c]});return{cls:"months display-none",cn:b}},getDaysOfWeek:function(a){a=[];for(i=0;7>i;i++)a.push({cls:"day"+(4<i?" week-end":""),html:Date.DayShortNames[i]});return{cls:"days-of-week",cn:a}},getDays:function(a){for(var b=a.getFirstDateOfMonth(),c=b.getFirstDayOfMonth(),d=b.getMonth(),e=new Date,f=[],b=b.add(0==c?-7:-c,Date.Day),c=0;42>c;c++){var g=b.getDate(),h=b.getMonth(),
k=b.getFullYear(),m=Date.isEqualDate(b,a),n=["day","day-"+c];4<c%7&&n.push("week-end");h<d&&n.push("previous-month");h>d&&n.push("next-month");m&&n.push("selected");Date.isEqualDate(b,e)&&n.push("today");f.push({cls:n.join(" "),index:c,day:g,month:h,year:k,tabIndex:m?0:-1,html:g});b.add(1,Date.Day)}return{cls:"days",cn:f}},getTime:function(a){var b=a.getHours(),c=a.getMinutes();return{cls:"time",cn:[{tag:"span",cls:"fa fa-clock-o icon"},{tag:"span",hour:a.getHours(),cls:"hour",tabIndex:0,html:(10>
b?"0":"")+b},":",{tag:"span",minute:a.getMinutes(),cls:"minute",tabIndex:0,html:(10>c?"0":"")+c},this.getHours(),this.getMinutes()]}},getHours:function(a){var b=[];a=null!=a?a.getHours():-1;for(var c=0;24>c;c++)b.push({cls:"hour hour-"+c+(a==c?" selected":""),tabIndex:a==c?0:-1,index:c,hour:c,dropdown:!0,html:(10>c?"0":"")+c});return{cls:"hours display-none",cn:b}},getMinutes:function(a){var b=[];a=null!=a?a.getMinutes():-1;for(var c=0;12>c;c++){var d=5*c<=a&&a<5*(c+1);b.push({cls:"minute minute-"+
c+(d?" selected":""),tabIndex:d?0:-1,index:c,minute:5*c,dropdown:!0,html:(10>5*c?"0":"")+5*c})}return{cls:"minutes display-none",cn:b}}}});
Z8.define("Z8.calendar.Calendar",{extend:"Z8.Component",time:!0,initComponent:function(){this.callParent();this.date=this.date||new Date},getDate:function(){return this.date},htmlMarkup:function(){return Z8.calendar.Markup.get(this)},completeRender:function(){this.days=this.queryNodes(".calendar>.days>.day");this.selectedDay=this.selectNode(".calendar>.days>.day.selected");this.month=this.selectNode(".calendar>.header>.month");this.year=this.selectNode(".calendar>.header>.year");this.hour=this.selectNode(".calendar>.time>.hour");
this.minute=this.selectNode(".calendar>.time>.minute");this.previousMonth=this.selectNode(".calendar>.header>.previous-month");this.nextMonth=this.selectNode(".calendar>.header>.next-month");this.yearDropdown=this.selectNode(".calendar>.header>.years");this.previousYear=this.selectNode(".calendar>.header>.years>.previous-year");this.nextYear=this.selectNode(".calendar>.header>.years>.next-year");this.years=this.queryNodes(".calendar>.header>.years>.year");this.selectedYear=this.selectNode(".calendar>.header>.years>.year.selected");
this.monthDropdown=this.selectNode(".calendar>.header>.months");this.months=this.queryNodes(".calendar>.header>.months>.month");this.selectedMonth=this.selectNode(".calendar>.header>.months>.month.selected");this.hourDropdown=this.selectNode(".calendar>.time>.hours");this.hours=this.queryNodes(".calendar>.time>.hours>.hour");this.selectedHour=this.selectNode(".calendar>.time>.hours>.hour.selected");this.minuteDropdown=this.selectNode(".calendar>.time>.minutes");this.minutes=this.queryNodes(".calendar>.time>.minutes>.minute");
this.selectedMinute=this.selectNode(".calendar>.time>.minutes>.minute.selected");DOM.on(this,"click",this.onClick,this);DOM.on(this,"keyDown",this.onKeyDown,this)},onDestroy:function(){DOM.un(this,"click",this.onClick,this);DOM.un(this,"keyDown",this.onKeyDown,this);this.minuteDropdown=this.minutes=this.selectedMinute=this.hourDropdown=this.hours=this.selectedHour=this.monthDropdown=this.months=this.selectedMonth=this.yearDropdown=this.previousYear=this.nextYear=this.years=this.selectedYear=this.month=
this.year=this.hour=this.minute=this.previousMonth=this.nextMonth=this.days=this.selectedDay=null;this.callParent()},currentYear:function(){return DOM.getIntAttribute(this.year,"year")},currentMonth:function(){return DOM.getIntAttribute(this.month,"month")},createDate:function(a,b){var c=new Date(this.date);c.setFullYear(null!=a?a:this.currentYear());c.setMonth(null!=b?b:this.currentMonth());return c},set:function(a,b){var c=Date.isDate(a)?a:(new Date(this.date)).set(a,b);Date.isEqual(c,this.date)&&
c.getFullYear()==this.currentYear()&&c.getMonth()==this.currentMonth()||(this.date=c,this.init(c,!0))},init:function(a,b){this.initDays(a,b);this.initMonths(a,b);var c=a.getFullYear();DOM.setValue(this.year,c);DOM.setAttribute(this.year,"year",c);this.initHours(a.getHours(),b);this.initMinutes(a.getMinutes(),b)},initYears:function(a,b){var c=a-a%12,d=this.years;this.select(null,"selectedYear");for(var e=0,f=d.length;e<f;e++){var g=d[e];DOM.setValue(g,c+e);DOM.setAttribute(g,"year",c+e);a==c+e?this.select(g,
"selectedYear"):this.deselect(g,"selectedYear")}null==this.selectedYear&&this.select(d[0],"selectedYear")},initMonths:function(a,b){var c=a.getMonth();DOM.setValue(this.month,a.getMonthName());DOM.setAttribute(this.month,"month",c);for(var d=this.months,e=0,f=d.length;e<f;e++)c==e?this.select(d[e],"selectedMonth"):this.deselect(d[e],"selectedMonth")},initDays:function(a,b){if(b||a.getFullYear()!=this.currentYear()||a.getMonth()!=this.currentMonth()){var c=new Date,d=a.getFirstDateOfMonth(),e=d.getFirstDayOfMonth(),
f=d.getMonth(),e=0==e?7:e,d=d.add(-e,Date.Day),g=this.days;this.select(null,"selectedDay");for(var h=0;42>h;h++){var k=g[h],m=d.getMonth();Date.isEqualDate(d,this.date)?this.select(k,"selectedDay"):this.deselect(k,"selectedDay");DOM.swapCls(k,m<f,"previous-month");DOM.swapCls(k,m>f,"next-month");DOM.swapCls(k,Date.isEqualDate(d,c),"today");DOM.setValue(k,d.getDate());DOM.setAttribute(k,"day",d.getDate());DOM.setAttribute(k,"month",m);DOM.setAttribute(k,"year",d.getFullYear());d=d.add(1,Date.Day)}null==
this.selectedDay&&this.select(g[e],"selectedDay")}},initHours:function(a,b){if(b||a!=this.date.getHours()){DOM.setValue(this.hour,(10>a?"0":"")+a);for(var c=this.hours,d=0,e=c.length;d<e;d++)a==d?this.select(c[d],"selectedHour"):this.deselect(c[d],"selectedHour")}},initMinutes:function(a,b){if(b||a!=this.date.getMinutes()){DOM.setValue(this.minute,(10>a?"0":"")+a);for(var c=this.minutes,d=0,e=c.length;d<e;d++)5*d<=a&&a<5*(d+1)?this.select(c[d],"selectedMinute"):this.deselect(c[d],"selectedMinute")}},
is:function(a,b){return a.hasAttribute(b)},isDropdown:function(a,b){return a.hasAttribute("dropdown")&&this.is(a,b)},showDropdown:function(a,b){this.dropdown!=a&&(null!=this.dropdown&&this.hideDropdown(this.dropdown),DOM.removeCls(a,"display-none"),this.dropdown=a,DOM.focus(b),DOM.on(document.body,"mouseDown",this.monitorDropdown,this))},hideDropdown:function(a){DOM.un(document.body,"mouseDown",this.monitorDropdown,this);DOM.addCls(this.dropdown,"display-none");this.dropdown=null;DOM.focus(this.selectedDay)},
monitorDropdown:function(a){DOM.isParentOf(this.dropdown,a.target)||this.hideDropdown(this.dropdown)},deselect:function(a,b){DOM.removeCls(a,"selected");DOM.setTabIndex(a,-1)},select:function(a,b,c){this.deselect(this[b],b);DOM.addCls(a,"selected");DOM.setTabIndex(a,0);c&&DOM.focus(a);this[b]=a},selectYear:function(a){this.init(this.createDate(DOM.getIntAttribute(a,"year")))},selectMonth:function(a){this.init(this.createDate(this.currentYear(),DOM.getIntAttribute(a,"month")))},selectDay:function(a,
b){this.select(a,"selectedDay",b);var c=this.date;c.set(DOM.getIntAttribute(a,"year"),Date.Year);c.set(DOM.getIntAttribute(a,"month"),Date.Month);c.set(DOM.getIntAttribute(a,"day"),Date.Day)},selectHour:function(a){var b=this.selectedDay,c=this.createDate();c.set(DOM.getIntAttribute(b,"day"),Date.Day);c.set(DOM.getIntAttribute(a,"hour"),Date.Hour);this.date=c;this.initHours(c.getHours(),!0)},selectMinute:function(a){var b=this.selectedDay,c=this.createDate();c.set(DOM.getIntAttribute(b,"day"),Date.Day);
c.set(DOM.getIntAttribute(a,"minute"),Date.Minute);this.date=c;this.initMinutes(c.getMinutes(),!0)},focusYear:function(a){this.select(a,"selectedYear",!0)},focusMonth:function(a){this.select(a,"selectedMonth",!0)},focusDay:function(a){this.selectDay(a,!0)},focusHour:function(a){this.select(a,"selectedHour",!0)},focusMinute:function(a){this.select(a,"selectedMinute",!0)},nextIndex:function(a,b,c,d){if("left"==b)return Math.max(a-1,0);if("right"==b)return Math.min(a+1,c*d-1);if("up"==b)return 0<=a-
c?a-c:a;if("down"==b)return a+c<c*d?a+c:a;throw"unknown direction "+b;},selectNext:function(a,b){if(a==this.year)this.toNextYear("up"==b||"right"==b?1:-1);else if(a==this.month)this.toNextMonth("up"==b||"right"==b?1:-1);else if(a==this.hour)this.toNextHour("up"==b||"right"==b?1:-1);else if(a==this.minute)this.toNextMinute("up"==b||"right"==b?1:-1);else if(this.is(a,"day")){var c=DOM.getIntAttribute(a,"index"),d=this.nextIndex(c,b,7,6);d!=c?this.focusDay(this.days[d]):this.toNextDay(a,"up"==b?-7:"down"==
b?7:"left"==b?-1:1)}else this.is(a,"year")?(c=DOM.getIntAttribute(a,"index"),d=this.nextIndex(c,b,3,4),d!=c?this.focusYear(this.years[d]):this.scrollToNextYear(a,"up"==b?-3:"down"==b?3:"left"==b?-1:1)):this.is(a,"month")?(c=DOM.getIntAttribute(a,"index"),d=this.nextIndex(c,b,3,4),d!=c&&this.focusMonth(this.months[d])):this.is(a,"hour")?(c=DOM.getIntAttribute(a,"index"),d=this.nextIndex(c,b,6,4),d!=c&&this.focusHour(this.hours[d])):this.is(a,"minute")&&(c=DOM.getIntAttribute(a,"index"),d=this.nextIndex(c,
b,4,3),d!=c&&this.focusMinute(this.minutes[d]))},toNextYear:function(a){a=this.createDate().add(a,Date.Year);this.init(a)},toNextMonth:function(a){a=this.createDate().add(a,Date.Month);this.init(a)},toNextDay:function(a,b){var c=DOM.getIntAttribute(a,"year"),d=DOM.getIntAttribute(a,"month"),c=this.createDate(c,d).add(b,Date.Day);this.set(c);this.focusDay(this.selectedDay)},toNextHour:function(a){a=this.createDate().add(a,Date.Hour);this.set(a)},toNextMinute:function(a){a=this.createDate().add(a,Date.Minute);
this.set(a)},scrollYears:function(a){var b=DOM.getIntAttribute(this.years[0],"year");this.initYears(b+12*a)},scrollToNextYear:function(a,b){var c=DOM.getIntAttribute(a,"index")+b;this.initYears(DOM.getIntAttribute(a,"year")+b);this.select(this.years[c+(0>c?12:-12)],"selectedYear",!0)},onDayClick:function(a){this.selectDay(a);this.fireEvent("dayClick",new Date(this.date),this)},onClick:function(a,b){a.stopEvent();if(this.is(b,"dropdown"))this.is(b,"year")?this.selectYear(b):this.is(b,"month")?this.selectMonth(b):
this.is(b,"hour")&&this.selectHour(b),this.isDropdown(b,"minute")&&this.selectMinute(b),this.hideDropdown(b);else if(b==this.year)this.initYears(this.currentYear()),this.showDropdown(this.yearDropdown,this.selectedYear);else if(b==this.month)this.showDropdown(this.monthDropdown,this.selectedMonth);else if(b==this.hour)this.showDropdown(this.hourDropdown,this.selectedHour);else if(b==this.minute)this.showDropdown(this.minuteDropdown,this.selectedMinute);else if(b==this.previousMonth)this.toNextMonth(-1);
else if(b==this.nextMonth)this.toNextMonth(1);else if(b==this.previousYear)this.scrollYears(-1);else if(b==this.nextYear)this.scrollYears(1);else if(this.is(b,"day"))this.onDayClick(b)},onKeyDown:function(a,b){var c=a.getKey(),d=this.dropdown;if(c==Event.ESC&&null!=d)this.hideDropdown(d);else if(c==Event.ENTER||c==Event.SPACE)this.onClick(a,b);else if(c==Event.LEFT)this.selectNext(b,"left");else if(c==Event.RIGHT)this.selectNext(b,"right");else if(c==Event.UP)this.selectNext(b,"up");else if(c==Event.DOWN)this.selectNext(b,
"down");else if(c==Event.TAB&&null!=d)if(d==this.yearDropdown)if(b!=this.nextYear||a.shiftKey)if(b==this.previousYear&&a.shiftKey)DOM.focus(this.nextYear);else return;else DOM.focus(this.previousYear);else this.hideDropdown(d);else return;a.stopEvent()},focus:function(){return this.isEnabled()?DOM.focus(null!=this.selectedDay?this.selectedDay:this.days[0]):!1}});
Z8.define("Z8.calendar.Dropdown",{extend:"Z8.calendar.Calendar",cls:"dropdown display-none",initComponent:function(){this.callParent();this.visible=!1},show:function(a,b){this.visible||(this.setPosition(a,b),DOM.removeCls(this,"display-none"),this.align(),this.fireEvent("show",this),this.visible=!0);DOM.focus(this.selectedDay)},hide:function(){this.visible&&(this.visible=!1,DOM.addCls(this,"display-none"),this.fireEvent("hide",this))},toggle:function(){this.visible?this.hide():this.show()},onDayClick:function(a){this.hide();
this.callParent(a)},onCancel:function(){this.hide();this.fireEvent("cancel",this)},onKeyDown:function(a,b){if(!this.callParent(a,b)){var c=a.getKey();if(c==Event.ESC)this.onCancel();else if(c==Event.TAB)if(a.shiftKey||b!=this.minute)if(a.shiftKey&&b==this.previousMonth)DOM.focus(this.minute);else return!1;else DOM.focus(this.previousMonth);else return!1;a.stopEvent();return!0}}});
Z8.define("Z8.calendar.Period",{extend:"Z8.Container",cls:"period",startDate:function(){var a=this.start.getDate(),b=this.finish.getDate();return a.getTime()<b.getTime()?a:b},finishDate:function(){var a=this.start.getDate(),b=this.finish.getDate();return a.getTime()<b.getTime()?b:a},today:function(){return{start:(new Date).truncDay(),finish:(new Date).truncDay().add(1,Date.Day).add(-1,Date.Second)}},yesterday:function(){return{start:(new Date).truncDay().add(-1,Date.Day),finish:(new Date).truncDay().add(-1,
Date.Second)}},dayBeforeYesterday:function(){return{start:(new Date).truncDay().add(-2,Date.Day),finish:(new Date).truncDay().add(-1,Date.Day).add(-1,Date.Second)}},last7Days:function(){return{start:(new Date).truncDay().add(-7,Date.Day),finish:new Date}},tomorrow:function(){return{start:(new Date).truncDay().add(1,Date.Day),finish:(new Date).truncDay().add(2,Date.Day).add(-1,Date.Second)}},thisWeek:function(){return{start:(new Date).truncDay().getFirstDateOfWeek(),finish:(new Date).truncDay().getFirstDateOfWeek().add(7,
Date.Day).add(-1,Date.Second)}},lastWeek:function(){return{start:(new Date).truncDay().getFirstDateOfWeek().add(-7,Date.Day),finish:(new Date).truncDay().getFirstDateOfWeek().add(-1,Date.Second)}},nextWeek:function(){return{start:(new Date).truncDay().getFirstDateOfWeek().add(7,Date.Day),finish:(new Date).truncDay().getFirstDateOfWeek().add(14,Date.Day).add(-1,Date.Second)}},thisMonth:function(){return{start:(new Date).getFirstDateOfMonth(),finish:(new Date).getFirstDateOfMonth().add(1,Date.Month).add(-1,
Date.Second)}},lastMonth:function(){return{start:(new Date).getFirstDateOfMonth().add(-1,Date.Month),finish:(new Date).getFirstDateOfMonth().add(-1,Date.Second)}},nextMonth:function(){return{start:(new Date).getFirstDateOfMonth().add(1,Date.Month),finish:(new Date).getFirstDateOfMonth().add(2,Date.Month).add(-1,Date.Second)}},thisQuarter:function(){return{start:(new Date).getFirstDateOfQuarter(),finish:(new Date).getFirstDateOfQuarter().add(3,Date.Month).add(-1,Date.Second)}},lastQuarter:function(){return{start:(new Date).getFirstDateOfQuarter().add(-3,
Date.Month),finish:(new Date).getFirstDateOfQuarter().add(-1,Date.Second)}},nextQuarter:function(){return{start:(new Date).getFirstDateOfQuarter().add(3,Date.Month),finish:(new Date).getFirstDateOfQuarter().add(6,Date.Month).add(-1,Date.Second)}},thisHalfYear:function(){return{start:(new Date).getFirstDateOfHalfYear(),finish:(new Date).getFirstDateOfHalfYear().add(6,Date.Month).add(-1,Date.Second)}},lastHalfYear:function(){return{start:(new Date).getFirstDateOfHalfYear().add(-6,Date.Month),finish:(new Date).getFirstDateOfHalfYear().add(-1,
Date.Second)}},nextHalfYear:function(){return{start:(new Date).getFirstDateOfHalfYear().add(6,Date.Month),finish:(new Date).getFirstDateOfHalfYear().add(12,Date.Month).add(-1,Date.Second)}},thisYear:function(){return{start:(new Date).getFirstDateOfYear(),finish:(new Date).getFirstDateOfYear().add(1,Date.Year).add(-1,Date.Second)}},lastYear:function(){return{start:(new Date).getFirstDateOfYear().add(-1,Date.Year),finish:(new Date).getFirstDateOfYear().add(-1,Date.Second)}},nextYear:function(){return{start:(new Date).getFirstDateOfYear().add(1,
Date.Year),finish:(new Date).getFirstDateOfYear().add(2,Date.Year).add(-1,Date.Second)}},htmlMarkup:function(){var a=this.period,b=this.last7Days(),c=this.start=new Z8.calendar.Calendar({cls:"start",date:a.start||b.start}),a=this.finish=new Z8.calendar.Calendar({cls:"finish",date:a.finish||b.finish}),d=new Z8.button.Button({text:"\u0421\u0435\u0433\u043e\u0434\u043d\u044f",name:"today",toggled:!0}),e=new Z8.button.Button({text:"\u0412\u0447\u0435\u0440\u0430",name:"yesterday",toggled:!1}),f=new Z8.button.Button({text:"\u041f\u043e\u0437\u0430\u0432\u0447\u0435\u0440\u0430",
name:"dayBeforeYesterday",toggled:!1}),b=new Z8.button.Button({text:"7 \u0434\u043d\u0435\u0439",name:"last7Days",toggled:!1}),g=new Z8.button.Button({text:"\u0417\u0430\u0432\u0442\u0440\u0430",name:"tomorrow",toggled:!1}),h={cls:"separator"},k=new Z8.button.Button({text:"\u0422\u0435\u043a\u0443\u0449\u0430\u044f \u043d\u0435\u0434\u0435\u043b\u044f",name:"thisWeek",toggled:!1}),m=new Z8.button.Button({text:"\u041f\u0440\u043e\u0448\u043b\u0430\u044f \u043d\u0435\u0434\u0435\u043b\u044f",name:"lastWeek",
toggled:!1}),n=new Z8.button.Button({text:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u043d\u0435\u0434\u0435\u043b\u044f",name:"nextWeek",toggled:!1}),l=new Z8.button.Button({text:"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u043c\u0435\u0441\u044f\u0446",name:"thisMonth",toggled:!1}),p=new Z8.button.Button({text:"\u041f\u0440\u043e\u0448\u043b\u044b\u0439 \u043c\u0435\u0441\u044f\u0446",name:"lastMonth",toggled:!1}),t=new Z8.button.Button({text:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u043c\u0435\u0441\u044f\u0446",
name:"nextMonth",toggled:!1}),b=new Z8.button.Group({cls:"selector",items:[d,e,f,b,g,h,k,m,n,h,l,p,t],radio:!0,vertical:!0}),d=new Z8.button.Button({text:"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u043a\u0432\u0430\u0440\u0442\u0430\u043b",name:"thisQuarter",toggled:!1}),e=new Z8.button.Button({text:"\u041f\u0440\u043e\u0448\u043b\u044b\u0439 \u043a\u0432\u0430\u0440\u0442\u0430\u043b",name:"lastQuarter",toggled:!1}),f=new Z8.button.Button({text:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u043a\u0432\u0430\u0440\u0442\u0430\u043b",
name:"nextQuarter",toggled:!1}),g=new Z8.button.Button({text:"\u0422\u0435\u043a\u0443\u0449\u0435\u0435 \u043f\u043e\u043b\u0443\u0433\u043e\u0434\u0438\u0435",name:"thisHalfYear",toggled:!1}),k=new Z8.button.Button({text:"\u041f\u0440\u043e\u0448\u043b\u043e\u0435 \u043f\u043e\u043b\u0443\u0433\u043e\u0434\u0438\u0435",name:"lastHalfYear",toggled:!1}),m=new Z8.button.Button({text:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0435\u0435 \u043f\u043e\u043b\u0443\u0433\u043e\u0434\u0438\u0435",
name:"nextHalfYear",toggled:!1}),n=new Z8.button.Button({text:"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434",name:"thisYear",toggled:!1}),l=new Z8.button.Button({text:"\u041f\u0440\u043e\u0448\u043b\u044b\u0439 \u0433\u043e\u0434",name:"lastYear",toggled:!1}),p=new Z8.button.Button({text:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0433\u043e\u0434",name:"nextYear",toggled:!1}),h=new Z8.button.Group({cls:"selector",items:[d,e,f,h,g,k,m,h,n,l,p],radio:!0,vertical:!0});
this.attachListeners(b.items);this.attachListeners(h.items);c=new Z8.Container({cls:"body",items:[c,a,b,h]});a=new Z8.button.Button({text:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",handler:this.onCancel,scope:this});h=new Z8.button.Button({text:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",primary:!0,handler:this.onApply,scope:this});a=new Z8.Container({cls:"buttons",items:[a,h]});this.items=[c,a];return this.callParent()},attachListeners:function(a){for(var b=0,c=a.length;b<c;b++){var d=
a[b];if(d.isComponent)d.on("toggle",this.onToggle,this)}},onToggle:function(a,b){if(b&&null!=a.name){var c=this[a.name]();this.start.set(c.start);this.finish.set(c.finish)}},onCancel:function(){this.fireEvent("cancel",this)},onApply:function(){this.fireEvent("apply",this,this.startDate(),this.finishDate())}});
Z8.define("Z8.calendar.Button",{extend:"Z8.button.Button",icon:"fa-calendar",toggle:!0,tooltip:"\u041f\u0435\u0440\u0438\u043e\u0434",triggerTooltip:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u043f\u0435\u0440\u0438\u043e\u0434",period:null,property:null,htmlMarkup:function(){this.filterItems=[];this.on("toggle",this.onToggle,this);var a=new Z8.calendar.Period({period:this.period});a.on("apply",this.onPeriodApply,this);a.on("cancel",this.onPeriodCancel,this);(this.menu=new Z8.menu.Menu({items:[a],
useTAB:!1})).on("itemClick",this.onMenuItemClick,this);this.init();return this.callParent()},init:function(){var a=this.period;this.setText(a.getText());this.setToggled(a.isActive(),!0)},onPeriodApply:function(a,b,c){this.menu.hide();a=this.period;a.setStart(b);a.setFinish(c);a.setActive(!0);this.init();this.fireEvent("period",this,a,Period.Activate)},onPeriodCancel:function(a){this.menu.hide();this.fireEvent("period",this,this.period,Period.NoAction)},onToggle:function(a,b){var c=this.period;c.setActive(b);
this.fireEvent("period",this,c,b?Period.Apply:Period.Clear)}});
Z8.define("Z8.list.Item",{extend:"Z8.Component",collapsed:!1,hidden:0,initComponent:function(){this.callParent();var a=this.record;if(null!=a){this.level=a.get("level");this.children=a.get("hasChildren");var b=a.get("icon");this.icon=null!=b?b:this.icon;if(null!=a.on)a.on("change",this.onRecordChange,this)}},isReadOnly:function(){var a=this.record;return null!=a?a.getLock()!=RecordLock.None:!1},onRecordChange:function(a,b){for(var c=this.list.getFields(),d=0,e=c.length;d<e;d++){var f=c[d],g=f.name;
b.hasOwnProperty(g)&&this.setText(d,this.formatText(f,a.get(g)))}this.list.locks&&DOM.swapCls(this.lockIcon,this.isReadOnly(),"fa-lock","")},columnsMarkup:function(){var a=this.record,b=[];if(this.list.checks){var c={cls:"text",cn:[{tag:"i",cls:"fa "+(this.checked?"fa-check-square":"fa-square-o")}]};b.push({tag:"td",cls:"check column",cn:[c]})}this.list.locks&&(c={cls:"text",cn:[{tag:"i",cls:"fa "+(this.isReadOnly()?"fa-lock":"")}]},b.push({tag:"td",cls:"lock column",cn:[c]}));c=[];if(null!=this.icon){var d=
{tag:"i",cls:this.setIcon(this.icon).join(" "),html:String.htmlText()};c.push(d)}return b.concat(this.fieldsMarkup(c,a))},fieldsMarkup:function(a,b){var c=[];if(null!=b){var d=this.list.getFields(),e=this.hasChildren();if(null!=e){var f=this.getLevel(),g={tag:"i",cls:(e?"fa fa-chevron-down ":"")+"icon",html:String.htmlText()};a.insert({tag:"span",cls:"collapser tree-level-"+(e?f:f+1),cn:[g]},0)}e=0;for(f=d.length;e<f;e++){var h=d[e],g=null,k=this.formatText(h,b.get(h.name)),h=h.type;String.isString(k)&&
(g=h!=Type.Text?Format.htmlEncode(k):"",k=String.htmlText(k));k={tag:"div",cls:"text",cn:0==e?a.concat([k]):[k]};c.push({tag:"td",cls:"column"+(null!=h?" "+h:""),field:e,cn:[k],title:g})}}else k=String.htmlText(this.text),k={tag:"div",cls:"text",cn:a.concat([k])},c.push({tag:"td",cls:"column",cn:[k],title:this.text||""});return c},formatText:function(a,b){if(null!=a.renderer)return a.renderer.call(a,b);switch(a.type){case Type.Date:return Format.date(b,a.format);case Type.Datetime:return Format.datetime(b,
a.format);case Type.Integer:return Format.integer(b,a.format);case Type.Float:return Format["float"](b,a.format);case Type.Boolean:return{tag:"i",cls:b?"fa fa-check-square":"fa fa-square-o"};default:return b||""}},htmlMarkup:function(){var a=["item"];this.enabled||a.push(["disabled"]);this.active&&a.pushIf("active");return{tag:"tr",id:this.getId(),cls:a.join(" "),tabIndex:this.getTabIndex(),cn:this.columnsMarkup()}},completeRender:function(){this.callParent();this.collapser=this.selectNode(".item .collapser .icon");
this.iconElement=this.selectNode(".item .icon");this.checkIcon=this.selectNode(".item>.column.check>.text>.fa");this.checkElement=this.selectNode(".item>.column.check");this.lockIcon=this.selectNode(".item>.column.lock>.text>.fa");this.cells=this.queryNodes(".item>.column:not(.check):not(.lock)");DOM.on(this,"mouseDown",this.onMouseDown,this);DOM.on(this,"click",this.onClick,this);DOM.on(this,"dblClick",this.onDblClick,this);DOM.on(this,"keyDown",this.onKeyDown,this)},onDestroy:function(){DOM.un(this,
"mouseDown",this.onMouseDown,this);DOM.un(this,"click",this.onClick,this);DOM.un(this,"dblClick",this.onDblClick,this);DOM.un(this,"keyDown",this.onKeyDown,this);null!=this.record&&null!=this.record.un&&this.record.un("change",this.onRecordChange,this);this.collapser=this.iconElement=this.checkIcon=this.checkElement=this.lockIcon=this.cells=null;this.callParent()},setTabIndex:function(a){a=this.callParent(a);DOM.setTabIndex(this,a);return a},setActive:function(a){this.active=a;DOM.swapCls(this,a,
"active")},focus:function(){return this.enabled?DOM.focus(this):!1},toggleCheck:function(){var a=!this.checked;this.setChecked(a);this.list.onItemCheck(this,a)},isChecked:function(){return this.checked},setChecked:function(a){this.checked=a;DOM.swapCls(this.checkIcon,a,"fa-check-square","fa-square-o")},setIcon:function(a){this.icon=a;a=this.iconCls=DOM.parseCls(a).pushIf("fa","fa-fw","icon");DOM.setCls(this.iconElement,this.iconCls);return a},setEnabled:function(a){DOM.swapCls(this,!a,"disabled");
this.callParent(a)},getValue:function(){var a=this.record;return null!=a?a.id:this.getId()},getText:function(a){var b=this.record;return null!=b?b.get(a)||"":this.text},hasChildren:function(){return this.children},isRoot:function(){return 0==this.level},isCollapsed:function(){return!0===this.collapsed},isExpanded:function(){return this.children&&!this.collapsed},getLevel:function(){return this.level},hide:function(a){0==this.hidden&&a?DOM.addCls(this,"display-none"):1!=this.hidden||a||DOM.removeCls(this,
"display-none");this.hidden=Math.max(this.hidden+(a?1:-1),0)},collapse:function(a){this.collapsed!=a&&(this.collapsed=a,DOM.rotate(this.collapser,a?-90:0),this.list.onItemCollapse(this,a))},setText:function(a,b){var c=this.cells[a];String.isString(b)?(DOM.setValue(c.firstChild.lastChild||c.firstChild,String.htmlText(b)),DOM.setAttribute(c,"title",b)):(DOM.setInnerHTML(c.firstChild,DOM.markup(b)),DOM.setAttribute(c,"title",""))},onMouseDown:function(a,b){var c=DOM.get(this);DOM.selectNode(c.parentNode,
"tr:focus")!=c||!this.isEnabled()||b==this.collapser||this.list.checks&&DOM.isParentOf(this.checkElement,b)||(c=this.findCellIndex(b),this.startEdit(c)&&a.stopEvent())},onClick:function(a,b){a.stopEvent();if(this.isEnabled())if(b==this.collapser)this.collapse(!this.collapsed);else if(this.list.checks&&DOM.isParentOf(this.checkElement,b))this.toggleCheck(),this.list.onItemClick(this,-1);else{var c=this.findCellIndex(b);this.list.onItemClick(this,c)}},onDblClick:function(a,b){a.stopEvent();if(this.enabled){var c=
this.findCellIndex(b),d=-1!=c?this.list.getFields()[c]:null;if(null==d||!DOM.isParentOf(d.editor,b))this.list.onItemDblClick(this,c)}},onKeyDown:function(a,b){var c=this.list;if(!c.isEditing()){var d=a.getKey();d==Event.ENTER?this.useENTER&&(c.onItemClick(this,-1),a.stopEvent()):d==Event.SPACE&&(c.checks?(a.stopEvent(),this.toggleCheck()):(c.onItemClick(this,-1),a.stopEvent()))}},startEdit:function(a){return this.active&&-1!=a?this.list.onItemStartEdit(this,a):!1},getCell:function(a){return this.cells[a]},
findCell:function(a){a=this.findCellIndex(a);return-1!=a?this.cells[a]:null},findCellIndex:function(a){for(var b=this.cells,c=0,d=b.length;c<d;c++)if(DOM.isParentOf(b[c],a))return c;return-1}});Z8.define("Z8.list.Divider",{extend:"Z8.Component",cls:"divider",enabled:!1});
Z8.define("Z8.list.HeaderBase",{extend:"Z8.Component",shortClassName:"HeaderBase",statics:{Numeric:Ems.pixelsToEms(70),Date:Ems.pixelsToEms(70),Datetime:Ems.pixelsToEms(130),Icon:Ems.pixelsToEms(24),Min:Ems.pixelsToEms(110),Stretch:Ems.pixelsToEms(5E3)},initComponent:function(){this.callParent()},getSort:function(){},setSort:function(){},getFilter:function(){},setFilter:function(){}});
Z8.define("Z8.list.Total",{extend:"Z8.Component",htmlMarkup:function(){var a=this.formatText(this.getTotal()),a={cls:"text",html:a,title:a},b=this.cls=DOM.parseCls(this.cls).pushIf("column").pushIf(this.field.type);return{tag:"td",id:this.getId(),cls:b.join(" "),cn:[a]}},completeRender:function(){this.callParent();this.textElement=this.selectNode(".text")},onDestroy:function(){this.textElement=null;this.callParent()},getTotal:function(){var a=this.list.getStore().getTotals();return null!=a?a.get(this.field.name):
null},getText:function(a){return this.text},setText:function(a){this.text=a;a=String.htmlText(this.formatText(a));DOM.setValue(this.textElement,a);DOM.setTitle(this.textElement,a)},formatText:function(a){var b=this.field;if(null!=b.renderer)return b.renderer.call(b,a);switch(b.type){case Type.Date:return Format.date(a,b.format);case Type.Datetime:return Format.datetime(a,b.format);case Type.Integer:return Format.integer(a,b.format);case Type.Float:return Format["float"](a,b.format);default:return""}}});
Z8.define("Z8.list.Header",{extend:"Z8.list.HeaderBase",initComponent:function(){this.callParent();var a=this.field;this.text=a.header;this.icon=a.icon;this.width=null!=a?a.width:null;this.sortDirection=a.sortDirection},getWidth:function(){var a=this.getDefaultWidth(),b=this.width;return null!=b&&0!=b?Math.max(b,this.getMinWidth()):a},getMinWidth:function(){var a=this.field,b=a.format;switch(a.type){case Type.Integer:case Type.Float:return HeaderBase.Numeric;case Type.Date:return Format.measureDate(b||
Format.Date)+1;case Type.Datetime:return Format.measureDate(b||Format.Datetime)+1;default:return HeaderBase.Min}},getDefaultWidth:function(){switch(this.field.type){case Type.Integer:case Type.Float:case Type.Date:case Type.Datetime:return this.getMinWidth();default:return HeaderBase.Stretch}},setWidth:function(a){return this.width=a},htmlMarkup:function(){if(null!=this.icon)var a=this.setIcon(this.icon),b={tag:"i",cls:a.join(" "),html:String.htmlText()};var a=this.setSort(this.sortDirection),c={tag:"i",
cls:a.join(" "),html:String.htmlText()},a=this.setFilter(!1),d={tag:"i",cls:a.join(" "),html:String.htmlText()},e=String.htmlText(this.text),e={cls:"text",title:e,cn:null!=b?[b,e]:[e]},a=this.getCls().join(" ");return{tag:"td",id:this.getId(),cls:a,tabIndex:this.getTabIndex(),cn:[{cls:"resize-handle-left"},e,c,d,{cls:"resize-handle-right"}],title:this.text}},completeRender:function(){this.callParent();this.textElement=this.selectNode(".text");this.iconElement=this.selectNode(".icon");this.sortElement=
this.selectNode(".sort");this.filterElement=this.selectNode(".filter");this.resizeHandleLeft=this.selectNode(".resize-handle-left");this.resizeHandleRight=this.selectNode(".resize-handle-right");DOM.on(this,"click",this.onClick,this);DOM.on(this,"mouseDown",this.onMouseDown,this)},onDestroy:function(){DOM.un(this,"click",this.onClick,this);DOM.un(this,"mouseDown",this.onMouseDown,this);this.resizeHandleLeft=this.resizeHandleRight=this.textElement=this.iconElement=this.sortElement=this.filterElement=
null;this.callParent()},getCls:function(){var a=this.cls=DOM.parseCls(this.cls).pushIf("column");null!=this.sortDirection&&a.pushIf("sort");this.filtered&&a.pushIf("filter");return a},setBusy:function(a){},setIcon:function(a){this.icon=a;a=this.iconCls=DOM.parseCls(a).pushIf("fa","fa-fw","icon");DOM.setCls(this.iconElement,this.iconCls);return a},getSortIcon:function(){var a=this.sortDirection;if(null==a)return"display-none";var b="fa-sort-";switch(this.field.type){case Type.Date:case Type.Datetime:case Type.Integer:case Type.Float:b+=
"numeric-";break;default:b+="alpha-"}return b+a},getSort:function(){return this.sortDirection},setSort:function(a){this.sortDirection=a;var b=this.sortCls=DOM.parseCls(this.getSortIcon()).pushIf("fa","fa-fw","sort");DOM.setCls(this.sortElement,b);DOM.swapCls(this,null!=a,"sort");return b},getFilterIcon:function(){return this.filtered?"fa-filter":"display-none"},setFilter:function(a){this.filtered=a;var b=this.filterCls=DOM.parseCls(this.getFilterIcon()).pushIf("fa","fa-fw","filter");DOM.setCls(this.filterElement,
b);DOM.swapCls(this,a,"filter");return b},getText:function(a){return this.text},setText:function(a,b){this.text=b;b=String.htmlText(b);DOM.setValue(this.textElement,b);DOM.setTitle(this.textElement,b)},onMouseDown:function(a,b){if(b==this.resizeHandleLeft||b==this.resizeHandleRight){a.stopEvent();this.lastPageX=a.pageX;this.currentHandle=b;var c=this.resizer=DOM.append(document.body,{cls:"column-resizer-mask"});DOM.on(c,"mouseMove",this.onMouseMove,this);DOM.on(c,"mouseUp",this.onMouseUp,this)}},
onMouseMove:function(a,b){a.stopEvent();var c=Ems.pixelsToEms(a.pageX-this.lastPageX);this.list.onHeaderResize(this,c,this.currentHandle==this.resizeHandleLeft?"left":"right");this.lastPageX=a.pageX},onMouseUp:function(a,b){var c=this.resizer;DOM.un(c,"mouseMove",this.onMouseMove,this);DOM.un(c,"mouseUp",this.onMouseUp,this);DOM.remove(this.resizer);this.resizer=null;this.list.onHeaderResized(this)},onClick:function(a,b){a.stopEvent();this.list.onHeaderSort(this)}});
Z8.define("Z8.list.HeaderIcon",{extend:"Z8.list.HeaderBase",fixed:!0,initComponent:function(){this.callParent();var a=this.field;this.icon=null!=a?a.icon:this.icon;this.title=(null!=a?a.header:this.title)||""},getWidth:function(){return this.width||HeaderBase.Icon},getMinWidth:function(){return this.getWidth()},htmlMarkup:function(){if(null!=this.icon)var a=DOM.parseCls(this.icon).pushIf("fa").join(" "),b={tag:"i",cls:a};else b={tag:"span",html:this.title.substr(0,2)};a=DOM.parseCls(this.cls).pushIf("column",
"icon").join(" ");return{tag:"td",id:this.getId(),cls:a,tabIndex:this.getTabIndex(),cn:[b],title:this.title}},completeRender:function(){this.callParent();this.icon=this.selectNode(".column>.fa")},onDestroy:function(){this.icon=null;this.callParent()}});
Z8.define("Z8.list.HeaderFilter",{extend:"Z8.Component",initComponent:function(){this.callParent()},subcomponents:function(){return[this.searchBox]},htmlMarkup:function(){var a=this.field||{},b=null;switch(a.type){case Type.String:case Type.Text:b=new Z8.form.field.Search({field:a,placeholder:a.header}),b.on("search",this.onSearch,this),b.on("focusIn",this.onFocusIn,this),b.on("focusOut",this.onFocusOut,this),b.on("keyDown",this.onKeyDown,this)}this.searchBox=b;a=DOM.parseCls(this.cls).pushIf("column").join(" ");
return{tag:"td",id:this.getId(),cls:a,tabIndex:this.getTabIndex(),cn:null!=b?[b.htmlMarkup()]:[]}},focus:function(){return null!=this.searchBox?this.searchBox.focus():!1},reset:function(){var a=this.searchBox;null!=a&&a.reset()},onSearch:function(a,b){this.list.onHeaderFilter(this,b)},getFilter:function(){var a=this.searchBox;return null==a?null:a.getFilter()},onFocusIn:function(a){this.fireEvent("focusIn",this)},onFocusOut:function(a){this.fireEvent("focusOut",this)},onKeyDown:function(a,b,c){b.getKey()==
Event.DOWN&&(this.list.focus(),b.stopEvent())}});
Z8.define("Z8.list.HeaderCheck",{extend:"Z8.list.HeaderIcon",cls:"check",isChecked:function(){return this.checked},setChecked:function(a){this.checked=a;DOM.swapCls(this.icon,a,"fa-check-square","fa-square-o");return a},toggleCheck:function(){return this.setChecked(!this.checked)},htmlMarkup:function(){this.icon=this.checked?"fa-check-square":"fa-square-o";return this.callParent()},completeRender:function(){this.callParent();DOM.on(this,"click",this.onClick,this)},onDestroy:function(){DOM.un(this,
"click",this.onClick,this);this.callParent()},onClick:function(a,b){a.stopEvent();if(this.enabled)this.list.onCheckHeaderClick(this)}});
Z8.define("Z8.list.List",{extend:"Z8.Component",checks:!0,autoFit:!0,headers:null,items:null,totals:!1,headerType:null,itemType:null,store:null,name:"id",fields:"name",visible:!0,editable:!1,useTAB:!1,useENTER:!0,confirmSelection:!1,autoSelectFirst:!0,itemsRendered:!1,manualItemsRendering:!1,ordinals:null,filterVisible:!1,lastEditedColumn:null,tabIndex:0,constructor:function(a){this.callParent(a)},initComponent:function(){this.callParent();this.items=this.items||[];this.fragments=[];this.fields=this.createFields(this.fields||
"name");this.headers=this.createHeaders();this.filters=this.createQuickFilters();this.totals=this.createTotals();this.initItems();this.initStore();this.editors=this.initEditors()},initItems:function(){for(var a=this.items,b=0,c=a.length;b<c;b++)a[b].list=this},initStore:function(){var a=this.store;this.store=null;this.setStore(a)},setStore:function(a){this.store!=a&&(null!=this.store&&(this.store.un("load",this.onStoreLoad,this),this.store.un("add",this.onStoreAdd,this),this.store.un("remove",this.onStoreRemove,
this),this.store.un("totals",this.onStoreTotals,this),this.store.un("idChange",this.onStoreIdChange,this),this.store.dispose()),this.store=a,null!=a&&(a.use(),a.on("load",this.onStoreLoad,this),a.on("add",this.onStoreAdd,this),a.on("remove",this.onStoreRemove,this),a.on("totals",this.onStoreTotals,this),a.on("idChange",this.onStoreIdChange,this),a.isLoaded()&&this.setRecords(a.getRecords())))},onStoreLoad:function(a,b,c){c&&(this.setRecords(b),this.updateSort(),this.updateFilter(),this.updateChecks())},
onStoreAdd:function(a,b,c){this.addRecords(b,c)},onStoreRemove:function(a,b){this.removeRecords(b)},onStoreTotals:function(a,b,c){c&&this.setTotals(b)},onStoreIdChange:function(a,b,c){this.getValue()==c&&this.setValue(b.id);this.resetOrdinals()},initEditors:function(){var a=[];if(null==this.store)return a;for(var b=this.fields,c=0,d=b.length;c<d;c++){var e=b[c],f=e.type;if(e.editable&&null!=f&&f!=Type.Boolean){var g=Z8.apply({},e);g.label=!1;g.type=f!=Type.Text?f:Type.String;g.enterOnce=!0;g.height=
null;f=e.editor;null==f&&(f=e.editor=Z8.form.Helper.createControl(g));f.on("change",this.onItemEditorChange,this);f.index=c;a.push(f)}}return a},setEditable:function(a){this.editable=a},headersMarkup:function(){for(var a=[],b=[],c=this.headers,d=this.filters,e=this.hasQuickFilters(),f=0,g=c.length;f<g;f++)a.push(c[f].htmlMarkup()),e&&b.push(d[f].htmlMarkup());a.push({tag:"td",cls:"extra",style:"width: 0;"});a=[{tag:"tr",cls:"header",cn:a}];e&&a.push({tag:"tr",cls:"filter display-none",cn:b});return a},
itemsMarkup:function(a){var b=[];a=a||this.items;for(var c=0,d=a.length;c<d;c++){var e=a[c],e="-"==e?new Z8.list.Divider:e;b.push(e.htmlMarkup())}this.itemsRendered=!0;return b},totalsMarkup:function(){for(var a=[],b=this.totals,c=0,d=b.length;c<d;c++)a.push(b[c].htmlMarkup());a.push({tag:"td",cls:"extra",style:"width: 0;"});return[{tag:"tr",cls:"total",cn:a}]},tableMarkup:function(a){var b=0!=this.headers.length,c=b?this.getTotalWidth():0,c=0!=c?"width: "+c+"em;":"",b=b?{tag:"colGroup",cn:this.colGroupMarkup(a)}:
null,d=[];"headers"==a?d=this.headersMarkup():"totals"==a?d=this.totalsMarkup():"items"!=a||this.manualItemsRendering||(d=this.itemsMarkup());a={tag:"tbody",cn:d};return{tag:"table",style:c,cn:null!=b?[b,a]:[a]}},colGroupMarkup:function(a){for(var b=this.headers,c=[],d=0,e=b.length;d<e;d++)c.push({tag:"col",style:"width: "+b[d].getWidth()+"em;"});"items"!=a&&c.push({tag:"col",cls:"extra",style:"width: 0;"});return c},htmlMarkup:function(){var a=0!=this.headers.length,b=0!=this.totals.length,c=DOM.parseCls(this.cls).pushIf("list");
a&&c.pushIf("columns");b&&c.pushIf("totals");this.autoFit&&c.pushIf("auto-fit");var d=[];a&&(a={cls:"scroller headers",cn:[this.tableMarkup("headers")]},d.push(a));a={cls:"scroller items",cn:[this.tableMarkup("items")]};d.push(a);b&&(b={cls:"scroller totals",cn:[this.tableMarkup("totals")]},d.push(b));return{id:this.getId(),tabIndex:this.getTabIndex(),cls:c.join(" "),cn:d}},subcomponents:function(){return this.headers.concat(this.filters).concat(this.itemsRendered?this.items:[]).concat(this.totals)},
completeRender:function(){this.callParent();if(null==this.itemsTable){var a=this.itemsScroller=this.selectNode(".scroller.items"),b=this.headersScroller=this.selectNode(".scroller.headers"),c=this.totalsScroller=this.selectNode(".scroller.totals");this.headersTable=this.selectNode(".scroller.headers>table");this.headerCols=this.queryNodes(".scroller.headers>table>colgroup>col")||[];this.filter=this.selectNode(".scroller.headers tr.filter");this.totalsTable=this.selectNode(".scroller.totals>table");
this.totalCols=this.queryNodes(".scroller.totals>table>colgroup>col")||[];this.itemsTable=this.selectNode(".scroller.items>table");this.itemsTableBody=this.selectNode(".scroller.items>table>tbody");this.itemCols=this.queryNodes(".scroller.items>table>colgroup>col");DOM.on(this,"keyDown",this.onKeyDown,this);null!=b&&(DOM.on(window,"resize",this.onResize,this),DOM.on(c||a,"scroll",this.onScroll,this))}},afterRender:function(){this.callParent();if(!this.manualItemsRendering){var a=this.currentItem()||
(this.autoSelectFirst?0:null);this.selectItem(a,this.autoSelectFirst)}this.adjustAutoFit()},getTotalWidth:function(){for(var a=0,b=this.headers,c=0,d=b.length;c<d;c++)a+=b[c].getWidth();return a},setAutoFit:function(a,b){this.autoFit=a;DOM.swapCls(this,a,"auto-fit");this.adjustAutoFit();this.silent||this.fireEvent("autoFit",this,a)},hasVScrollbar:function(){return this.itemsScroller.clientHeight<this.itemsTable.clientHeight},hasHScrollbar:function(){return this.itemsScroller.clientWidth<this.itemsTable.clientWidth},
getScrollbarWidth:function(){var a=this.itemsScroller,a=(new Rect(a)).width-DOM.getClientWidth(a);return Math.max(a,0)},adjustAutoFit:function(){var a=this.headers,b=this.itemsScroller;if(0!=this.headers.length&&null!=b)if(this.autoFit){for(var c=0,d=0,e=0,f=this.headerCols,g=this.totalCols,h=this.itemCols,k=[],m=0,n=a.length;m<n;m++){var l=a[m],p=l.getWidth(),e=e+p;l.fixed?c+=p:(d+=p,k.push(m))}b=(new Rect(b)).width-this.getScrollbarWidth();if(!(0>=b-c||e==c)){do for(var e=!1,t=(b-c)/d,m=d=0,n=k.length;m<
n;m++){var q=k[m],l=a[q],p=l.getWidth(),q=l.getMinWidth();p==q&&l.adjusted||(p=Math.max(q,m!=k.length-1?l.getWidth()*t:b-c-d),p==q?(e=!0,c+=p):d+=p,l.adjusted=!0,l.setWidth(p))}while(e);m=0;for(n=k.length;m<n;m++)q=k[m],l=a[q],p=l.getWidth(),DOM.setPoint(f[q],"width",p),DOM.setPoint(h[q],"width",p),DOM.setPoint(g[q],"width",p),l.adjusted=!1;p=c+d;DOM.setPoint(this.itemsTable,"width",p);this.adjustScrollers(p)}}else this.adjustScrollers()},adjustScrollers:function(a){var b=this.itemsScroller;if(0!=
this.headers.length&&null!=b){var b=this.headerCols,c=this.totalCols;a=a||Ems.pixelsToEms(parseFloat(DOM.getComputedStyle(this.itemsTable).width));var d=this.getScrollbarWidth();DOM.setPoint(b[b.length-1],"width",d);DOM.setPoint(c[c.length-1],"width",d);DOM.setPoint(this.headersTable,"width",a+d);DOM.setPoint(this.totalsTable,"width",a+d);this.onScroll()}},renderItems:function(){if(this.itemsRendered&&!this.itemsAdded||null==this.getDom())return!1;this.getItems();if(!this.itemsRendered)return DOM.append(this.itemsTableBody,
this.itemsMarkup()),this.renderDone(),!0;if(!this.itemsAdded)throw"List: invalid render state";for(var a=this.fragments,b=0,c=a.length;b<c;b++){var d=a[b],e=DOM.get(this.itemsTableBody).childNodes[d.index];null!=e?DOM.insertBefore(e,this.itemsMarkup(d.items)):DOM.append(this.itemsTableBody,this.itemsMarkup(d.items))}this.fragments=[];this.itemsAdded=!1;this.renderDone();return!0},onDestroy:function(){DOM.un(this,"keyDown",this.onKeyDown,this);DOM.un(this.totalsScroller||this.itemsScroller,"scroll",
this.onScroll,this);DOM.un(window,"resize",this.onResize,this);this.setStore(null);Component.destroy(this.editors);this.callParent();this.filters=this.totals=this.editors=this.items=this.fields=this.fragment=this.headers=this.checkHeader=this.totalCols=this.itemsTable=this.itemsTableBody=this.itemCols=this.headersTable=this.headerCols=this.filter=this.totalsTable=this.itemsScroller=this.headersScroller=this.totalsScroller=null},getStore:function(){return this.store},isLoaded:function(){return null!=
this.store?this.store.isLoaded():0!=this.getCount()},load:function(a,b){var c=this.store;null==c?this.setItems(this.getItems()):null==b?c.load(a):c.filter(b,a)},clearFilter:function(){var a=this.getStore();a.setFilter([]);a.unload()},createHeader:function(a,b){return Z8.create(this.headerType||(a.type!=Type.Boolean?"Z8.list.Header":"Z8.list.HeaderIcon"),{list:this,field:a,cls:b})},createTotal:function(a,b){return Z8.create(this.totalType||"Z8.list.Total",{list:this,field:a,cls:b})},hasQuickFilters:function(){return 0!=
this.filters.length},createQuickFilter:function(a,b){var c=new Z8.list.HeaderFilter({list:this,field:a,cls:b});c.on("focusIn",this.onQuickFilterFocusIn,this);c.on("focusOut",this.onQuickFilterFocusOut,this);return c},createHeaders:function(){var a=[],b=this.fields;if(0==b.length||0==this.headers)return a;if(this.checks){var c=this.checkHeader=new Z8.list.HeaderCheck({list:this});a.push(c)}this.locks&&(c=new Z8.list.HeaderIcon({list:this,cls:"lock",icon:"fa-lock"}),a.push(c));for(var d=this.store,
d=null!=d&&null!=d.getSorter?d.getSorter():[],d=0!=d.length?d[0]:null,e=0,f=b.length;e<f;e++){var c=b[e],g=0!=e?e==f-1?"last":null:"first",h=null!=d&&c.name==d.property&&!1!==c.sortable;c.sortDirection=h?d.direction:null;c=this.createHeader(b[e],g);h&&(this.sortHeader=c);a.push(c)}return a},createTotals:function(){var a=[];if(!this.totals)return a;if(this.checks){var b=new Z8.list.HeaderIcon({list:this,title:"\u03a3"});a.push(b)}this.locks&&(b=new Z8.list.HeaderIcon({list:this,title:this.checks?"":
"\u03a3"}),a.push(b));for(var c=this.fields,d=0,e=c.length;d<e;d++)b=this.createTotal(c[d],0!=d?d==e-1?"last":null:"first"),a.push(b);return a},createQuickFilters:function(){var a=[],b=this.headers;if(0==b.length||!1===this.filters)return a;for(var c=0,d=b.length;c<d;c++){var e=this.createQuickFilter(b[c].field,0!=c?c==d-1?"last":null:"first");a.push(e)}return a},createItem:function(a){a={list:this,record:a,name:this.name||"id",icon:this.icons?"":null,useENTER:this.useENTER};return null!=this.itemType?
Z8.create(this.itemType,a):new Z8.list.Item(a)},createItems:function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=this.createItem(a[c]);b.push(e)}return b},createFields:function(a){if(null==a)return[];if(String.isString(a))return[{name:a,header:a}];if(Array.isArray(a)){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];b.push(String.isString(e)?{name:e}:e)}return b}return[a]},setFields:function(a){},setRecords:function(a){a=this.createItems(a||this.store.getRecords());this.setItems(a);this.visible&&
this.renderItems()},addRecords:function(a,b){var c=this.createItems(a||this.store.geRecords());this.addItems(c,b,!0);this.visible&&this.renderItems()},removeRecords:function(a){var b=[];i=0;for(length=a.length;i<length;i++)b.push(this.getItem(a[i].id));this.removeItems(b)},setTotals:function(a){var b=this.totals;if(0!=b.length)for(var c=0+(this.checks?1:0)+(this.locks?1:0),d=b.length;c<d;c++)b[c].setText(a.get(b[c].field.name))},getItems:function(){return this.items||[]},getCount:function(){return this.getItems().length},
getAt:function(a){var b=this.getItems();return a<b.length?b[a]:null},getItem:function(a){a=this.getIndex(a);return-1!=a?this.getAt(a):null},getIndex:function(a){var b=this.getOrdinals();if(a instanceof Z8.list.Item)return a=b[a.getValue()],null!=a?a:-1;a=Number.isNumber(a)?a:b[a];return null!=a?a:-1},getOrdinals:function(){if(null!=this.ordinals)return this.ordinals;var a=this.ordinals={},b=this.items;if(null==b)return a;for(var c=0,d=b.length;c<d;c++){var e=b[c];if(e.isComponent){var f=null!=e.getValue?
e.getValue():null;null!=f&&(a[f]=c);a[e.getId()]=c}}return a},resetOrdinals:function(){this.ordinals=null},getFields:function(){return this.fields},getHeaders:function(){return this.headers},getHeader:function(a){for(var b=this.headers,c=0+(this.checks?1:0)+(this.locks?1:0),d=b.length;c<d;c++){var e=b[c];if(e.field.name==a)return e}return null},getHeaderIndex:function(a){for(var b=this.headers,c=0,d=b.length;c<d;c++)if(a==b[c])return c;return-1},getValue:function(){return this.value},setValue:function(a){this.value=
a},addItems:function(a,b,c){if(!c){c=0;for(var d=a.length;c<d;c++)a[c].list=this}this.items.insert(a,b);this.resetOrdinals();this.itemsRendered&&(this.fragments.push({index:b,items:a}),this.itemsAdded=!0);this.onContentChange()},removeItems:function(a){this.resetOrdinals();Component.destroy(a);this.items.removeAll(a);this.adjustAutoFit();this.onContentChange()},setItems:function(a){this.items!=a&&(this.clear(),this.items=a,this.resetOrdinals(),this.onContentChange())},onContentChange:function(){this.fireEvent("contentChange",
this);this.setTabIndex(this.getTabIndex())},clear:function(){Component.destroy(this.items);this.items=this.fragments=[];this.itemsRendered=this.itemsAdded=!1},findItem:function(a){a=this.findItemIndex(a);return-1!=a?this.getItem(a):null},findItemIndex:function(a){for(var b=document.body;null!=a&&1==a.nodeType&&a!==b;){var c=this.getIndex(a.id);if(-1!=c)return c;a=a.parentNode}return-1},setTabIndex:function(a){a=this.callParent(a);var b=this.currentItem();null!=b&&b.setTabIndex(a);null==DOM.get(this)?
this.tabIndex=0==this.getCount()?a:-1:DOM.setTabIndex(this,0==this.getCount()?a:-1);return a},focus:function(a,b,c){if(!this.enabled)return!1;if(0==this.getCount())return DOM.focus(this);var d=this.getItems();a=null==a?this.currentItem():a;a instanceof Z8.list.Item&&(a=this.getIndex(a));String.isString(a)&&(b=a,a=this.getIndex(this.getValue()));a=null!=a?a:-1;b=b||"next";var e=0,f=d.length;do{"first"==b?(a=0,b="next"):"last"==b&&(a=f-1,b="previous");if(0==e&&c||0!=e)"next"==b?a=a!=f-1?a+1:0:"previous"==
b&&(a=0!=a?a-1:f-1);a=Math.min(Math.max(a,0),f-1);if(-1==a)return!1;var g=d[a];if(!String.isString(g)&&!g.hidden&&this.focusItem(g))return!0}while(++e<f);return DOM.focus(this)},focusItem:function(a){return null!=a.focus&&a.focus()?(this.selectItem(a),!0):!1},currentItem:function(){return this.getItem(this.getValue())},getChecked:function(a){for(var b=[],c=this.getItems(),d=0,e=c.length;d<e;d++){var f=c[d];f.isChecked()&&b.push(a?f.record:f)}return b},getCheckedRecords:function(){return this.getChecked(!0)},
activateItem:function(a,b){a.setActive(b);a.setTabIndex(b?0:-1)},selectItem:function(a,b){var c=this.currentItem(),d=!1;c!=a&&null!=c&&(d=this.selectNode(":focus")==DOM.get(c),this.activateItem(c,!1));Number.isNumber(a)&&(a=this.getAt(a));null!=a&&(this.activateItem(a,!0),d&&a.focus());this.setValue(null!=a&&null!=a.getValue?a.getValue():null);(b||!this.confirmSelection&&a!=c)&&this.fireEvent("select",a,this)},setSelection:function(a){this.selectItem(a,!0)},onKeyDown:function(a,b){var c=a.getKey();
this.isEditing()||this.isFiltering()&&c!=Event.ESC||(c==Event.DOWN||c==Event.TAB&&!a.shiftKey&&this.useTAB?this.focus(this.findItemIndex(b),"next",!0)&&a.stopEvent():c==Event.UP||c==Event.TAB&&a.shiftKey&&this.useTAB?this.focus(this.findItemIndex(b),"previous",!0)&&a.stopEvent():c==Event.HOME?this.focus("first")&&a.stopEvent():c==Event.END?this.focus("last")&&a.stopEvent():c==Event.F&&a.ctrlKey&&null!=this.filter?(this.showQuickFilter(!0),a.stopEvent()):c==Event.ESC&&this.filterVisible?(this.showQuickFilter(!1),
this.focus(this.currentItem()),a.stopEvent()):c==Event.LEFT?(c=this.findItem(b),null!=c&&(c.isExpanded()?c.hasChildren()&&(c.collapse(!0),a.stopEvent()):c.isRoot()||(c=this.getParent(c),null!=c&&this.focus(c)))):c==Event.RIGHT&&(c=this.findItem(b),null!=c&&c.hasChildren()&&c.isCollapsed()&&(c.collapse(!1),a.stopEvent())))},onScroll:function(a,b){var c=this.totalsScroller||this.itemsScroller;this.headersScroller.scrollLeft=c.scrollLeft;this.itemsScroller.scrollLeft=c.scrollLeft},onResize:function(a,
b){this.adjustAutoFit()},onHeaderSort:function(a){if(0!=a.field.sortable){var b="asc"==a.getSort()?"desc":"asc",c={property:a.field.name,direction:b};a.setBusy(!0);this.store.sort(c,{fn:function(c,e,f){a.setBusy(!1);null!=this.sortHeader&&this.sortHeader.setSort(null);a.setSort(b);this.sortHeader=a},scope:this})}},updateSort:function(){var a=null!=this.store?this.store.getSorter():null,a=0!=a.length?a[0]:null,b=this.sortHeader;if(null!=a||null!=b)null!=b&&null!=a&&b.field.name==a.property&&!1!==b.field.sortable?
b.setSort(a.direction):(null!=b&&(b.setSort(null),this.sortHeader=null),null!=a&&(b=this.getHeader(a.property),null!=b&&(b.setSort(a.direction),this.sortHeader=b)))},updateFilter:function(){for(var a=null!=this.store?this.store.getQuickFilter():null,b={},c=0,d=a.length;c<d;c++)b[a[c].property]=!0;a=this.headers;c=0;for(d=a.length;c<d;c++){var e=a[c],f=e.field;null!=f&&e.setFilter(b[f.name])}},onHeaderFilter:function(a,b){for(var c=[],d=this.filters,e=0,f=d.length;e<f;e++){var g=d[e].getFilter();null!=
g&&c.push(g)}var h=a.searchBox;h.setBusy(!0);this.store.quickFilter(c,{fn:function(a,b,c){h.setBusy(!1)},scope:this})},showQuickFilter:function(a,b){this.filterVisible=a;DOM.swapCls(this.headersScroller,a,"filters");DOM.swapCls(this.filter,!a,"display-none");this.adjustAutoFit();var c=function(a,b,c){this.focus()};if(a)this.focusQuickFilter();else{var d=this.store;0!=d.getQuickFilter().length&&d.quickFilter([],{fn:c,scope:this});this.resetQuickFilter()}!0!==b&&this.fireEvent(a?"quickFilterShow":"quickFilterHide",
this)},focusQuickFilter:function(){for(var a=this.filters,b=0,c=a.length;b<c&&!a[b].focus();b++);},resetQuickFilter:function(){for(var a=this.filters,b=0,c=a.length;b<c;b++)a[b].reset()},onQuickFilterFocusIn:function(a){this.activeFilter=a},onQuickFilterFocusOut:function(a){this.activeFilter=null},isFiltering:function(){return null!=this.activeFilter},setItemsChecked:function(a){for(var b=this.items,c=0,d=b.length;c<d;c++)b[c].setChecked(a)},checkAll:function(){var a=this.checkHeader;if(null==a)return!1;
a.setChecked(!0);this.setItemsChecked(!0);this.fireEvent("check",this,this.items);return!0},onCheckHeaderClick:function(a){a=a.toggleCheck();this.setItemsChecked(a);this.fireEvent("check",this,a?this.items:[])},onItemCheck:function(a,b){var c=this.checkHeader;c.isChecked()&&!b&&c.setChecked(!1);this.fireEvent("check",this,[a])},updateChecks:function(){this.checks&&0!=this.headers.length&&this.headers[0].setChecked(!1)},onItemClick:function(a,b){this.setSelection(a);this.fireEvent("itemClick",this,
a,b)},onItemDblClick:function(a,b){this.fireEvent("itemDblClick",this,a,b)},onHeaderResize:function(a,b,c){var d=this.getHeaderIndex(a);"left"==c&&d--;a=this.headers[d];if(!a.fixed&&0!=b){this.setAutoFit(!1);c=DOM.getPoint(this.headerCols[d],"width");var e=DOM.getPoint(this.itemsTable,"width"),f=Math.max(a.getMinWidth(),c+b);b=f-c;a.setWidth(f);0!=b&&(DOM.setPoint(this.itemsTable,"width",e+b),DOM.setPoint(this.itemCols[d],"width",f),DOM.setPoint(this.headerCols[d],"width",f),DOM.setPoint(this.totalCols[d],
"width",f),this.adjustScrollers())}},onHeaderResized:function(a){},getParent:function(a){if(a.isRoot())return null;var b=a.getLevel();a=this.getIndex(a);for(var c=this.items,d=a-1;0<=d;d--)if(a=c[d],a.getLevel()<b)return a;return null},onItemCollapse:function(a,b){for(var c=this.autoFit,d=c?this.hasVScrollbar():!1,e=this.getIndex(a),f=a.getLevel(),g=this.items,e=e+1,h=g.length;e<h;e++)if(a=g[e],f<a.getLevel())a.hide(b);else break;c&&d!=this.hasVScrollbar()&&this.adjustAutoFit()},getFirstEditorIndex:function(a){var b=
this.fields;a=null==a?0:a;for(var c=b.length;a<c;a++)if(null!=b[a].editor)return a;return-1},onItemStartEdit:function(a,b){var c=a.record;if(null!=c&&!c.isEditable())return!1;null==b&&(b=this.lastEditedColumn);null==b&&(b=this.getFirstEditorIndex());if(-1==b)return!1;c=this.fields[b].editor;return null==c?!1:this.editable?this.startEdit(a,c):!1},isEditing:function(){return null!=this.currentEditor},startEdit:function(a,b){var c=a.record;if(!c.isEditable())return!1;if(this.finishing)return this.editingQueue=
{item:a,editor:b},!0;var d=c.get(b.name)||null,e=c.get(b.displayName);b.initValue(d,e);b.setRecord(c);b.item=a;this.openEditor(b);this.currentEditor=b;a!=this.currentItem()&&this.selectItem(a);return!0},openEditor:function(a){var b=a.item.getCell(a.index);a.appendTo(b);DOM.addCls(b,"overflow-visible");DOM.addCls(b.firstChild,"display-none");a.show();a.on("focusOut",this.onEditorFocusOut,this);DOM.on(a,"keyDown",this.onEditorKeyDown,this);a.focus(!0)},closeEditor:function(a,b){this.lastEditedColumn=
a.index;a.un("focusOut",this.onEditorFocusOut,this);DOM.un(a,"keyDown",this.onEditorKeyDown,this);if(!a.item.disposed){var c=a.item.getCell(a.index);DOM.removeCls(c,"overflow-visible");DOM.removeCls(c.firstChild,"display-none")}a.hide();b&&this.focus()},cancelEdit:function(a){this.finishEdit(a,null,!0)},finishEdit:function(a,b,c){if(!this.finishing)if(c||!a.isValid())this.closeEditor(a,!0),this.currentEditor=null;else{if("next"==b||"previous"==b)this.editingQueue="next"==b?this.getNextEditor(a.item,
a):this.getPreviousEditor(a.item,a);b=a.record;b.beginEdit();b.set(a.name,a.getValue());this.finishing=!0;b.update({fn:function(b,c){c?b.endEdit():b.cancelEdit();c&&this.fireEvent("itemEdit",this,a,b,this.fields[a.index]);this.closeEditor(a,!c||null==this.editingQueue);this.currentEditor=null;this.finishing=!1;if(c&&null!=this.editingQueue){var d=this.editingQueue;this.editingQueue=null;this.startEdit(d.item,d.editor)}},scope:this},{values:this.store.getValues()})}},onEditorFocusOut:function(a){this.finishEdit(a)},
onItemEditorChange:function(a,b,c){this.fireEvent("itemEditorChange",this,a,b,c)},onEditorKeyDown:function(a,b){var c=a.getKey();c==Event.ESC?(this.cancelEdit(this.currentEditor),this.focus(this.currentItem()),a.stopEvent()):c==Event.ENTER?(this.finishEdit(this.currentEditor),a.stopEvent()):c==Event.TAB&&(this.finishEdit(this.currentEditor,a.shiftKey?"previous":"next"),a.stopEvent())},getNextEditor:function(a,b){for(var c=this.fields,d=b.index+1,e=c.length;d<e;d++)if(b=c[d].editor,null!=b)return{item:a,
editor:b};d=this.getIndex(a)+1;a=this.getAt(d!=this.getCount()?d:0);d=0;for(e=c.length;d<e;d++)if(b=c[d].editor,null!=b)return{item:a,editor:b};return null},getPreviousEditor:function(a,b){for(var c=this.fields,d=b.index-1;0<=d;d--)if(b=c[d].editor,null!=b)return{item:a,editor:b};d=this.getIndex(a)-1;a=this.getAt(-1!=d?d:this.getCount()-1);for(d=c.length-1;0<=d;d--)if(b=c[d].editor,null!=b)return{item:a,editor:b};return null}});
Z8.define("Z8.list.Dropdown",{extend:"Z8.list.List",visible:!1,cls:"dropdown-list display-none",manualItemsRendering:!0,confirmSelection:!0,autoSelectFirst:!1,render:function(a){this.inRender||(this.callParent(a),this.renderItems())},renderItems:function(){var a=this.callParent();this.needAlign=this.needAlign||a;this.visible&&this.needAlign&&!this.inShow&&(this.inRender=!0,this.show(null,null,!1),delete this.inRender);return a},setTabIndex:function(a){a=this.callParent(a);for(var b=this.getItems(),
c=0,d=b.length;c<d;c++){var e=b[c];String.isString(e)||e.setTabIndex(a)}return a},show:function(a,b,c){this.inShow=!0;this.render();if(!this.visible||this.needAlign)this.needAlign=!1,this.setPosition(a,b),DOM.setBottom(this,"auto"),DOM.removeCls(this,"display-none"),a=this.visible,this.visible=!0,this.align(),this.adjustAutoFit(),a||this.fireEvent("show",this);!1!==c&&this.focus(c);delete this.inShow},hide:function(){this.visible&&(this.visible=!1,DOM.addCls(this,"display-none"),this.selectItem(null),
this.fireEvent("hide",this))},toggle:function(){this.visible?this.hide():this.show()},setSelection:function(a){this.hide();this.callParent(a)},onCancel:function(){this.hide();this.fireEvent("cancel",this)},onKeyDown:function(a,b){var c=a.getKey(),d=this.getDom();c==Event.ESC||c==Event.TAB&&b==d?(this.onCancel(),a.stopEvent()):this.callParent(a,b)}});
Z8.define("Z8.form.field.Field",{extend:"Z8.Object",mixinId:"field",autoSave:!1,updatingDependencies:0,suspendCheckChange:0,valid:!0,initField:function(){this.initValue()},initValue:function(a,b){a=void 0!==a?a:this.value;this.suspendCheckChange++;this.setValue(a,b);this.suspendCheckChange--;this.initialValue=this.originalValue=this.lastValue=this.getValue();this.originalDisplayValue=b},getName:function(){return this.name},getRecord:function(){return this.record},getRecordId:function(){return null!=
this.record?this.record.id:null},setRecord:function(a){this.record=a},getValue:function(){return this.value},getDisplayValue:function(){return this.getValue()},setValue:function(a,b){this.value=a;this.validate();this.checkChange()},reset:function(){this.setValue(this.originalValue)},isEqual:function(a,b){return String(a||null)===String(b||null)},checkChange:function(){if(0>=this.suspendCheckChange){var a=this.getValue(),b=this.lastValue;!this.disposed&&this.didValueChange(a,b)&&(this.lastValue=a,
this.fireEvent("change",this,a,b))}},didValueChange:function(a,b){return!this.isEqual(a,b)},setAutoSave:function(a){this.autoSave!=a&&(this.autoSave=a,this.isCombobox||this.isCheckbox||(this.suspendCheckChange+=a?1:-1))},initEvents:function(){DOM.on(this,"focus",this.onFocusIn,this,!0);DOM.on(this,"blur",this.onFocusOut,this,!0)},clearEvents:function(){DOM.un(this,"focus",this.onFocusIn,this,!0);DOM.un(this,"blur",this.onFocusOut,this,!0)},onFocusIn:function(a){DOM.addCls(this,"focus");this.fireEvent("focusIn",
this)},onFocusOut:function(a){var b=DOM.get(this);a=a.relatedTarget;if(b==a||DOM.isParentOf(b,a))return!1;this.autoSave&&(this.isValid()?(this.suspendCheckChange--,this.setValue(this.getValue(),this.getDisplayValue()),this.suspendCheckChange++):this.initValue(this.originalValue,this.originalDisplayValue));DOM.removeCls(this,"focus");this.fireEvent("focusOut",this);return!0},isValid:function(){return this.valid},setValid:function(a){this.valid=a},validate:function(){},isDependent:function(){var a=
this.field;return null!=a&&null!=a.dependency||null!=this.dependsOn},getDependencyField:function(){return this.field.dependency},hasDependsOnField:function(){return null!=this.field&&null!=this.field.dependsOn},getDependsOnField:function(){return this.field.dependsOn},getDependsOnValue:function(){return this.dependsOnValue},setDependsOnValue:function(a){this.dependsOnValue=a},hasDependsOnValue:function(){return!Z8.isEmpty(this.dependsOnValue)&&this.dependsOnValue!=guid.Null},addDependency:function(a){null==
this.dependencies&&(this.dependencies=[]);a.dependsOn=this;this.dependencies.push(a)},updateDependencies:function(a){if(null!=this.dependencies&&0==this.updatingDependencies&&!this.disposed){this.updatingDependencies++;for(var b=this.dependencies,c=0,d=b.length;c<d;c++){var e=b[c];if(0==e.updatingDependencies)e.onDependencyChange(a)}this.updatingDependencies--}},onDependencyChange:function(a){}});
Z8.define("Z8.form.field.Control",{extend:"Z8.Component",mixins:["Z8.form.field.Field"],tabIndex:0,label:null,readOnly:!1,readOnlyLock:!1,initComponent:function(){this.callParent();this.initField();this.readOnlyLock=this.isReadOnly();this.enabledLock=!this.isEnabled()},getBoxMinHeight:function(){var a=this.getMinHeight();return 0!=a?a+Ems.UnitSpacing:0},subcomponents:function(){return[this.labelTextControl,this.tools]},htmlMarkup:function(){var a=this.label=String.isString(this.label)?{text:this.label}:
this.label,b=this.controlMarkup(),c=this.cls=DOM.parseCls(this.cls).pushIf("control-group");this.isEnabled()||c.pushIf("disabled");this.isReadOnly()&&c.pushIf("readonly");a||c.pushIf("label-none");this.flex&&c.pushIf("flexed");this.isValid()||c.pushIf("invalid");if(a){var d=a.align,e=null!=a.icon?{tag:"i",cls:this.getIconCls(a.icon).join(" ")}:null,f=a.text,g=null!=f&&"object"==typeof f,h=this.labelTextControl=g?f:null,k=a.title||(g?null:f),f=g?null!=h.htmlMarkup?h.htmlMarkup():h:String.htmlText(f),
e=[{cls:"text"+(null!=h?" has-control":""),cn:null!=e?[e,f]:[f]}];null!=a.tools&&(h=this.tools=a.tools,e.push(h.htmlMarkup()));a=null!=a.width?"min-width:"+a.width+"px;width:"+a.width+"px;":"";a={tag:"span",name:"label",cls:this.getLabelCls().join(" "),title:k||"",style:a,cn:e};"right"==d?b.add(a):b.insert(a,0);null!=d&&c.pushIf("label-"+d)}return{id:this.getId(),cls:c.join(" "),cn:b}},completeRender:function(){this.callParent();var a=this.label=this.selectNode("span[name=label]");null!=a&&(this.labelText=
DOM.selectNode(a,".text"),this.labelIcon=DOM.selectNode(a,".text>.icon"));DOM.on(a,"mouseDown",this.onLabelMouseDown,this);this.mixins.field.initEvents.call(this)},onDestroy:function(){this.mixins.field.clearEvents.call(this);DOM.un(this.label,"mousedown",this.onLabelMouseDown,this);this.label=this.labelText=this.labelIcon=null;this.callParent()},setEnabled:function(a){this.callParent(a);DOM.swapCls(this,!a,"disabled");DOM.swapCls(this.label,!a,"disabled");this.updateTools()},isReadOnly:function(){return this.readOnly},
setReadOnly:function(a){this.readOnly=a;DOM.swapCls(this,a,"readonly");DOM.swapCls(this.label,a,"readonly");this.updateTools()},updateTools:function(){DOM.swapCls(this.tools,this.isReadOnly()||!this.isEnabled(),"display-none")},getRawValue:function(){},setRawValue:function(){},setValue:function(a,b){this.mixins.field.setValue.call(this,a,b);a=this.valueToRaw(a);this.setRawValue(a)},isEqualValues:function(a,b){return String(a)==String(b)},valueToRaw:function(a){return a},rawToValue:function(a){return a},
isRequired:function(){return this.required},isEmptyValue:function(a){return Z8.isEmpty(a)},setValid:function(a){this.mixins.field.setValid.call(this,a);DOM.swapCls(this,!a,"invalid");null!=this.validationCallback&&this.validationCallback(this,a)},validate:function(){var a=this.getValue();this.setValid(!this.isEmptyValue(a)||!this.isRequired())},getIconCls:function(a){return null!=a?DOM.parseCls(a).pushIf("fa","fa-fw","icon"):null},getLabelCls:function(){var a=this.label;if(null==a)return null;var b=
DOM.parseCls(this.labelCls).pushIf("label");this.isEnabled()||b.pushIf("disabled");this.isReadOnly()&&b.pushIf("readonly");null!=a.textAlign&&b.push("text-"+a.textAlign);null!=a.tools&&b.push("tools");Z8.isEmpty(a.text)&&b.pushIf("empty");return b},setIcon:function(a){a=this.getIconCls(a);DOM.setCls(this.labelIcon,a)},setLabel:function(a){DOM.setValue(this.labelText,a)},onLabelMouseDown:function(a,b){if(b==DOM.get(this.label)||b==this.labelText)null==this.labelTextControl&&a.stopEvent(),this.focus()}});
Z8.define("Z8.form.field.Html",{extend:"Z8.form.field.Control",initComponent:function(){this.callParent()},controlMarkup:function(){return[{tag:"div",cls:DOM.parseCls(this.cls).pushIf("control","html-text").join(" "),tabIndex:this.getTabIndex(),html:this.getValue()}]},completeRender:function(){this.callParent();this.div=this.selectNode(".html-text")},onDestroy:function(){this.div=null;this.callParent()},setValue:function(a,b){this.callParent(a,b);DOM.setInnerHTML(this.div,a)},setEnabled:function(a){DOM.swapCls(this.div,
!a,"disabled");this.callParent(a)},setScrollTop:function(a){this.div.scrollTop=a},setScrollLeft:function(a){this.div.scrollLeft=a}});
Z8.define("Z8.form.field.Document",{extend:"Z8.form.field.Control",isDocument:!0,label:"",tag:"div",height:Ems.unitsToEms(3),isValid:function(){return!0},validate:function(){},controlMarkup:function(){return[{tag:this.tag,cls:"control"}]},completeRender:function(){this.callParent();this.document=this.selectNode(".control");this.setValue(this.getValue())},onDestroy:function(){this.document=null;this.callParent()},getSource:function(a){return null!=a?encodeURI(a.replace(/\\/g,"/"))+"?&session="+Application.session:
null},setSource:function(a){throw"Z8.form.field.Document.setSource is not implemented";},setValue:function(a){this.callParent(a);this.setSource(this.getSource(a))},focus:function(){return this.isEnabled()?DOM.focus(this):!1}});Z8.define("Z8.form.field.Image",{extend:"Z8.form.field.Document",initComponent:function(){this.callParent();this.cls=DOM.parseCls(this.cls).pushIf("image")},setSource:function(a){DOM.setStyle(this.document,"backgroundImage",null!=a?"url("+a+")":"none")}});
Z8.define("Z8.form.field.File",{extend:"Z8.form.field.Document",tag:"iframe",initComponent:function(){this.callParent();this.cls=DOM.parseCls(this.cls).pushIf("file")},setSource:function(a){DOM.setProperty(this.document,"src",null!=a?a+"&preview=true":"")}});
Z8.define("Z8.form.field.Text",{extend:"Z8.form.field.Control",triggers:null,placeholder:"",tag:"input",editable:!0,initComponent:function(){this.triggers=this.triggers||[];this.callParent()},controlMarkup:function(){var a=this.valueToRaw(this.getValue()),b=this.isEnabled(),c=this.isReadOnly(),d=this.getInputTag(),e=this.getInputCls().join(" "),a=Format.htmlEncode(a),a={tag:d,name:"input",cls:e,tabIndex:this.getTabIndex(),spellcheck:!1,type:this.password?"password":"text",title:this.tooltip||"",placeholder:this.placeholder,
value:"input"==d?a:null,html:"input"!=d?a:null};b||(a.disabled=null);c&&(a.readOnly=null);a=[a];d=this.triggers;if(!Z8.isEmpty(d)){d=Array.isArray(d)?d:[d];this.triggers=[];this.cls=DOM.parseCls(this.cls).pushIf("trigger-"+d.length);for(var e=0,f=d.length;e<f;e++){var g=d[e],h=DOM.parseCls(g.cls).pushIf("trigger-"+(f-e));b&&!c||h.pushIf("hidden");g=new Z8.button.Trigger({primary:!0,tooltip:g.tooltip,icon:g.icon,handler:g.handler,scope:g.scope,cls:h});a.push(g.htmlMarkup());this.triggers.push(g)}}return a},
subcomponents:function(){return this.callParent().concat(this.triggers)},completeRender:function(){DOM.on(this,"click",this.onClick,this);DOM.on(this,"keyDown",this.onKeyDown,this);var a=this.input=this.selectNode(this.getInputTag()+"[name=input]");if(this.editable)DOM.on(a,"input",this.onInput,this);this.callParent()},onDestroy:function(){DOM.un(this.input,"input",this.onInput,this);DOM.un(this,"click",this.onClick,this);DOM.un(this,"keyDown",this.onKeyDown,this);this.input=null;this.callParent()},
swapTriggersCls:function(a,b,c){for(var d=this.triggers,e=0,f=d.length;e<f;e++)DOM.swapCls(d[e],a,b,c)},setEnabled:function(a){DOM.swapCls(this.input,!a,"disabled");DOM.setDisabled(this.input,!a);this.swapTriggersCls(!a||this.isReadOnly(),"hidden");this.callParent(a)},setReadOnly:function(a){this.isReadOnly()!=a&&(DOM.setReadOnly(this.input,a),this.swapTriggersCls(!this.isEnabled()||a,"hidden"));this.callParent(a)},getRawValue:function(a){return DOM.getValue(this.input)},setRawValue:function(a){DOM.setValue(this.input,
a);DOM.setAttribute(this.input,"title",a)},setTabIndex:function(a){a=this.callParent(a);DOM.setTabIndex(this.input,a);return a},getInputTag:function(){return this.editable?this.tag:"div"},getInputCls:function(){var a=DOM.parseCls(this.inputCls).pushIf("control");this.isEnabled()||a.pushIf("disabled");return a},focus:function(a){return this.isEnabled()?DOM.focus(this.input,a):!1},getTrigger:function(a){var b=this.triggers;return b[a||b.length-1]},onClick:function(a,b){a.stopEvent();for(var c=this.triggers,
d=0,e=c.length;d<e;d++){var f=c[d];if(DOM.isParentOf(f,b)&&f.isEnabled()){c=f.handler;if(null!=c)c.call(f.scope,f);else this.onTriggerClick(f);break}}},onTriggerClick:function(a){},onKeyEvent:function(a,b){},onKeyDown:function(a,b){this.isEnabled()&&!this.isReadOnly()&&this.onKeyEvent(a,b)&&a.stopEvent()},onInput:function(a,b){var c=this.getRawValue(),c=this.rawToValue(c);this.mixins.field.setValue.call(this,c)}});
Z8.define("Z8.form.field.Number",{extend:"Z8.form.field.Text",increment:1,getInputCls:function(){return this.callParent().pushIf("number")},onKeyEvent:function(a,b){var c=a.getKey(),d=0;c==Event.UP&&a.ctrlKey||c==Event.PAGE_UP?d=10*this.increment:c==Event.UP&&a.shiftKey?d=100*this.increment:c==Event.DOWN&&a.ctrlKey||c==Event.PAGE_DOWN?d=-10*this.increment:c==Event.DOWN&&a.shiftKey?d=-100*this.increment:c==Event.UP?d=this.increment:c==Event.DOWN&&(d=-this.increment);return 0!=d?(this.setValue((this.getValue()||
0)+d),!0):Event.A<=c&&c<=Event.Z&&!a.ctrlKey&&!a.altKey}});Z8.define("Z8.form.field.Integer",{extend:"Z8.form.field.Number",radix:10,rawToValue:function(a){return Parser.integer(a,this.radix)},valueToRaw:function(a){return Format.integer(a)}});Z8.define("Z8.form.field.Float",{extend:"Z8.form.field.Number",rawToValue:function(a){return Parser["float"](a)},valueToRaw:function(a){return Format["float"](a)}});
Z8.define("Z8.form.field.Checkbox",{extend:"Z8.form.field.Control",isCheckbox:!0,initComponent:function(){this.callParent();this.cls=DOM.parseCls(this.cls).pushIf("checkbox")},isValid:function(){return!0},validate:function(){},controlMarkup:function(){var a=this.label;null!=a&&(a.align=a.align||"right",a.icon=null);return[{tag:"div",name:"icon",cls:this.iconCls.join(" "),html:String.htmlText("")}]},htmlMarkup:function(){var a=this.callParent();a.tabIndex=this.getTabIndex();return a},completeRender:function(){this.icon=
this.selectNode("div[name=icon]");DOM.on(this,"click",this.onClick,this);DOM.on(this,"keyDown",this.onKeyDown,this);this.callParent()},onDestroy:function(){DOM.un(this,"click",this.onClick,this);DOM.un(this,"keyDown",this.onKeyDown,this);this.icon=null;this.callParent()},isEqualValues:function(a,b){return a&&b||!(a||b)},setValue:function(a){this.callParent(a);this.iconCls=[a?"fa-check-square":"fa-square-o","fa","control"];DOM.swapCls(this.icon,a,"fa-check-square","fa-square-o")},setTabIndex:function(a){a=
this.callParent(a);DOM.setTabIndex(this,a);return a},onClick:function(a,b){a.stopEvent();this.isEnabled()&&!this.isReadOnly()&&this.setValue(!this.getValue())},onKeyDown:function(a,b){if(this.isEnabled()&&!this.isReadOnly()&&a.getKey()==Event.SPACE)this.onClick(a,b)},focus:function(){return this.isEnabled()?DOM.focus(this):!1}});Z8.define("Z8.form.field.TextArea",{extend:"Z8.form.field.Text",trigger:!1,tag:"textarea"});
Z8.define("Z8.form.field.Combobox",{extend:"Z8.form.field.Text",isCombobox:!0,displayName:"name",name:"id",emptyValue:guid.Null,enterToOpen:!0,enterOnce:!1,queryDelay:250,lastQuery:"",pagerMode:"visible",initComponent:function(){var a=this.store;null==a||a.isStore||(this.store=new Z8.query.Store(a));this.callParent();this.cls=DOM.parseCls(this.cls).pushIf("dropdown-combo");this.editable&&(this.queryTask=new Z8.util.DelayedTask);this.initStore()},isEmptyValue:function(a){return a==this.emptyValue||
this.callParent(a)},getStore:function(){return this.store},createDropdown:function(){var a=this.dropdown=new Z8.list.Dropdown({store:this.getStore(),value:this.getValue(),name:this.name,fields:this.fields||this.displayName,icons:this.icons,checks:this.checks});a.on("select",this.selectItem,this);a.on("cancel",this.cancelDropdown,this);this.needsPager();this.pager=new Z8.pager.Pager({cls:"display-none",store:this.getStore()});a.on("align",this.onDropdownAlign,this);a.on("show",this.onDropdownShow,
this);a.on("hide",this.onDropdownHide,this)},htmlMarkup:function(){var a=this.triggers;null!=this.source&&a.push({icon:"fa-pencil",tooltip:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c '"+this.source.text+"'",handler:this.editSource,scope:this});this.isRequired()||a.push({icon:"fa-times",tooltip:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",handler:this.clearValue,scope:this});a.push({});a=this.callParent();this.createDropdown();a.cn.push(this.dropdown.htmlMarkup());
a.cn.push(this.pager.htmlMarkup());return a},subcomponents:function(){return this.callParent().add([this.dropdown,this.pager])},completeRender:function(){this.callParent();this.dropdown.setAlignment(this.input);if(!this.editable)DOM.on(this,"keyPress",this.onKeyPress,this);DOM.on(this.input,"dblClick",this.onDblClick,this)},onDestroy:function(){DOM.un(this,"keyPress",this.onKeyPress,this);DOM.un(this.input,"dblClick",this.onDblClick,this);this.setStore(null);this.callParent()},setEnabled:function(a){a||
null==this.dropdown||this.dropdown.hide();this.callParent(a)},setReadOnly:function(a){a||null==this.dropdown||this.dropdown.hide();this.callParent(a)},formatValue:function(a){var b=this.field||{};switch(b.type){case Type.Date:case Type.Datetime:return a=String.isString(a)?Parser.datetime(a):a,null!=a?Format.date(a,b.format):"";case Type.Boolean:return Parser["boolean"](a)?"\u0434\u0430":"\u043d\u0435\u0442";default:return a}},getSelectedRecord:function(a){var b=this.getStore();return null!=b?b.getById(a||
this.getValue()):null},setValue:function(a,b){if(void 0==b){var c=this.getSelectedRecord(a);b=null!=c?c.get(this.displayName):null}this.entered=!0;this.displayValue=b=this.formatValue(b||"");this.clearFilter();this.callParent(a,b)},onDependencyChange:function(a){a=this.dependsOnValue=null!=a?this.hasDependsOnField()?a.get(this.getDependsOnField()):a.id:null;this.updateWhere(a);this.setValue(this.emptyValue)},setRecord:function(a){this.callParent(a);null!=a&&this.updateWhere(null!=this.dependsOn?a.get(this.dependsOn.name):
null)},updateWhere:function(a){a=this.getWhere(a);var b=this.getStore();b.setWhere(a);b.unload()},getWhere:function(a){var b=[];null!=a&&b.push({property:this.getDependencyField(),value:a});a=this.getRecord();var c=this.field.link;if(null==a||!c.isParentKey)return b;for(var c=c.parentKeys,d=0,e=c.length;d<e;d++)b.push({property:c[d],operator:Operation.NotEq,value:a.id});return b},getDisplayValue:function(){return this.displayValue},valueToRaw:function(a){return this.displayValue},currentItem:function(){return this.dropdown.getItem(this.getValue())},
currentIndex:function(){return this.dropdown.getIndex(this.getValue())},isLoaded:function(){return this.dropdown.isLoaded()},initStore:function(){var a=this.store;this.store=null;this.setStore(a)},setStore:function(a){if(this.store!=a){var b=this.store;null!=b&&(b.un("beforeLoad",this.beforeLoadCallback,this),b.un("load",this.loadCallback,this),b.dispose());this.store=a;null!=a&&(a.use(),this.beforeLoadCallback=this.beforeLoadCallback||function(){this.getTrigger().setBusy(!0)},a.on("beforeLoad",this.beforeLoadCallback,
this),this.loadCallback=this.loadCallback||function(){this.getTrigger().setBusy(!1)},a.on("load",this.loadCallback,this));null!=this.pager&&this.pager.setStore(a);null!=this.dropdown&&this.dropdown.setStore(a)}},load:function(a,b){this.dropdown.load(a,b)},filter:function(){var a=this.getRawValue()||"";if(a!=this.lastQuery||""==a){var b=this.dropdown.getStore();if(null!=b){var c=b.getRemoteFilter()?this.queryDelay:0,d=function(a){if(b.isLoading())this.queryTask.delay(c,d,this,a);else{this.lastQuery=
a;var e=Z8.isEmpty(a)?[]:[{property:this.displayName,operator:Operation.Contains,value:a,anyMatch:!0}];this.load({fn:function(b,c,d){d&&(b=this.findItem(a),this.dropdown.selectItem(b),this.showDropdown(!0))},scope:this},e)}};this.queryTask.delay(c,d,this,a)}}},clearFilter:function(){""!=this.lastQuery&&(this.queryTask.cancel(),this.lastQuery="",this.dropdown.clearFilter())},findItem:function(a,b){if(Z8.isEmpty(a))return null;for(var c=this.dropdown.getItems(),d=b=b||0,e=c.length;d<e;){var f=c[d];
if((f.getText(this.displayName)||"").toLowerCase().startsWith(a.toLowerCase()))return f;d=d<e-1?d+1:0;if(d==b)break}return null},select:function(a,b){var c=function(c,e,f){f&&(String.isString(a)?(b=a,a=this.currentItem()):a=a||this.currentItem(),c=null!=a?this.dropdown.getIndex(a.getValue()):-1,e=this.dropdown.getItems(),f=e.length,"next"==b?c=c!=f-1?c+1:0:"previous"==b?c=0!=c?c-1:f-1:"first"==b?c=0:"last"==b&&(c=f-1),c=Math.min(Math.max(c,0),f-1),-1!=c&&(a=e[c],this.setValue(a.getValue(),a.getText(this.displayName))))};
this.isLoaded()?c.call(this,this.store,this.store.getRecords(),!0):this.load({fn:c,scope:this})},selectByKey:function(a){var b=function(b,d,e){e&&(b=this.currentIndex(),this.findItem(a,b+1),b=this.findItem(a,b+1),null!=b&&this.setValue(b.getValue(),b.getText(this.displayName)))};this.isLoaded()?b.call(this,this.store,this.store.getRecords(),!0):this.load({fn:b,scope:this})},selectItem:function(a){var b=null!=a?a.getValue():this.emptyValue;a=null!=a?a.getText(this.displayName):"";this.setValue(b,a);
this.hideDropdown()},show:function(){this.entered=!1;this.callParent()},openDropdown:function(){var a=function(a,c,d){d&&this.showDropdown()};this.isLoaded()?this.showDropdown():this.load({fn:a,scope:this})},needsPager:function(){return"visible"==this.pagerMode},realignPager:function(){if(this.needsPager()){var a=this.dropdown,b=new Rect(this.dropdown),c=DOM.get(this.pager);DOM.setLeft(c,DOM.getLeft(a));DOM.setRight(c,DOM.getRight(a));DOM.setTop(c,DOM.getTop(a)+b.height)}},getPagerSize:function(){if(!this.needsPager())return{width:0,
height:0};var a=this.pager,b=this.pager.isVisible();b||this.showPager();a.size=a.getSize();b||this.hidePager();return a.size},showDropdown:function(a){var b=this.dropdown,c=DOM.getOffsetLeft(this.input);DOM.setLeft(b,c);DOM.setRight(b,Ems.pixelsToEms(-1));c=this.currentItem();a=a?!1:c;c=this.getPagerSize();b.setAlignmentOffset(0,c.height,Ems.pixelsToEms(17));b.show(null,null,a)},hideDropdown:function(){this.dropdown.hide();this.clearFilter()},cancelDropdown:function(){this.setRawValue(this.displayValue);
this.hideDropdown()},toggleDropdown:function(){this.dropdown.visible?this.cancelDropdown():this.openDropdown()},showPager:function(){this.needsPager()?this.pager.show():this.hidePager()},hidePager:function(){this.pager.hide()},onDropdownAlign:function(a){this.realignPager();this.showPager()},onDropdownShow:function(){this.getTrigger().rotateIcon(180)},onDropdownHide:function(){this.hidePager();this.getTrigger().rotateIcon(0);DOM.focus(this.input)},onFocusOut:function(a){if(!this.callParent(a))return!1;
this.cancelDropdown();return!0},onTriggerClick:function(a){this.toggleDropdown()},onDblClick:function(a,b){this.isEnabled()&&!this.isReadOnly()&&this.toggleDropdown()},onKeyEvent:function(a,b){var c=a.getKey(),d=this.editable,e=this.dropdown,f=e.visible,g=this.dropdown.currentItem();if(c==Event.DOWN)f?e.focus(g):this.select("next");else if(c==Event.UP)f?e.focus(g):this.select("previous");else if(c!=Event.HOME||d&&DOM.isParentOf(this.input,b))if(c!=Event.END||d&&DOM.isParentOf(this.input,b)){if(c==
Event.TAB&&DOM.isParentOf(this.triggers,b))return f?e.focus(g):this.cancelDropdown(),!1;if(c==Event.ENTER||c==Event.SPACE&&(!this.editable||DOM.isParentOf(this.triggers,b)))if(f)g||!this.isRequired()?this.selectItem(g):this.cancelDropdown();else if(!this.enterToOpen||this.enterOnce&&this.entered)if(a.ctrlKey)this.onTriggerClick(a,b);else return!1;else this.onTriggerClick(a,b),this.entered=!0;else{if(c!=Event.ESC||!f&&""==this.lastQuery)return!1;this.cancelDropdown()}}else f?e.focus(g):this.select("last");
else f?e.focus(g):this.select("first");return!0},onInput:function(a,b){this.filter()},onKeyPress:function(a,b){this.selectByKey(String.fromCharCode(a.getKey()))},editSource:function(){Viewport.open(this.source.id);this.getStore().unload()},clearValue:function(){this.setValue(this.emptyValue,"")}});
Z8.define("Z8.form.field.Listbox",{extend:"Z8.form.field.Control",tabIndex:-1,isListbox:!0,tools:!1,locks:!1,totals:!1,editable:!1,pagerMode:"visible",initComponent:function(){var a=this.store;null==a||a.isStore||(this.store=new Z8.query.Store(a));this.callParent();this.setValue(this.value)},isEmptyValue:function(a){return 0==this.store.getCount()},getValue:function(){return this.mixins.field.getValue.call(this)},setValue:function(a){var b=this.list;if(null!=b){var c=b.getItem(a);null!=c?b.selectItem(c):
a=guid.Null}a!=this.getValue()&&this.mixins.field.setValue.call(this,a)},isEditable:function(){return this.editable&&!this.isReadOnly()},setEnabled:function(a){this.callParent(a);var b=this.list;null!=b&&b.setEditable(this.editable&&a&&!this.isReadOnly())},setReadOnly:function(a){this.callParent(a);var b=this.list;null!=b&&b.setEditable(this.editable&&!a&&this.isEnabled())},hasLink:function(){return null!=this.getLink()},getLink:function(){var a=this.query;return null!=a&&null!=a.link?this.query.link.name:
null},getItem:function(a){a=a.isModel?a.id:a;return this.list.getItem(a)},getModel:function(){return this.store.getModel()},getFields:function(){return this.list.getFields()},getControl:function(a){var b=this.controls;if(null==b)return null;for(var c=0,d=b.length;c<d;c++){var e=b[c];if(e.name==a||e.displayName==a)return e}return null},getHeaders:function(){return this.list.getHeaders()},needsValues:function(){var a=this.getValues();if(null==a)return!1;for(var b in a){var c=a[b];if(Z8.isEmpty(c)||
c==guid.Null)return!0}return!1},getValues:function(){var a=this.record;if(null==a)return null;var b=a.getValueFor();if(0==b.length)return null;for(var c={},d=0,e=b.length;d<e;d++){var f=b[d];c[f.valueFor]=a.get(f.name)}return c},setRecord:function(a){var b=this.getRecord();null!=b&&b.un("change",this.onRecordChange,this);this.callParent(a);if(null!=a)a.on("change",this.onRecordChange,this);this.afterRecordSet(a);this.onRecordChange(a,{})},onRecordChange:function(a,b){this.setEnabled(!this.needsValues())},
getFilter:function(a){if(!this.hasLink())return null;var b=this.getDependencyWhere(this.getLink(),a.id),b=Array.isArray(b)?b:null!=b?[b]:[],c=this.query.link.parentKeys;if(null!=c){for(var d=0,e=c.length;d<e;d++)b.push({property:c[d],value:a.id});return[{logical:"or",expressions:b}]}return b},afterRecordSet:function(a){null!=a?this.isDependent()||(a=this.getFilter(a),this.store.setValues(this.getValues()),this.store.filter(a,{fn:function(a,c,d){this.validate()},scope:this})):(this.clear(),this.validate())},
getDependencyWhere:function(a,b){return[{property:a,value:b}]},onDependencyChange:function(a){var b=this.getRecordId(),c=null,d=function(a,b,d){this.setDependsOnValue(c);this.validate()};null!=a?(c=this.hasDependsOnField()?a.get(this.getDependsOnField()):a.id,a=this.getDependencyWhere(this.getDependencyField(),c),this.hasLink()&&a.push({property:this.getLink(),value:b}),this.store.setWhere(a),this.store.load({fn:d,scope:this})):(this.store.removeAll(),this.setDependsOnValue(c),this.validate(),this.onSelect(null))},
clear:function(){null!=this.list&&this.list.setRecords([])},subcomponents:function(){return this.callParent().add([this.list,this.pager,this.selector,this.actions])},htmlMarkup:function(){this.cls=DOM.parseCls(this.cls).pushIf("list-box").pushIf(this.needsPager()?"pager-on":"");var a=this.label;this.tools&&(null==a&&(a=this.label={}),null==a.tools&&(a.tools=new Z8.button.Group({items:this.createTools()})),this.hasTools=!0);return this.callParent()},setAddTool:function(a){this.addTool=a},setCopyTool:function(a){this.copyTool=
a},setEditTool:function(a){this.editTool=a},setRefreshTool:function(a){this.refreshTool=a},setRemoveTool:function(a){this.removeTool=a},setFilterTool:function(a){this.filterTool=a},setPeriodTool:function(a){this.periodTool=a},setSortTool:function(a){this.sortTool=a},setExportTool:function(a){this.exportTool=a},setAutoFitTool:function(a){this.autoFitTool=a},createTools:function(){var a=this.store,b=[];if(a.hasCreateAccess()){var c=new Z8.button.Tool({icon:"fa-file-o",tooltip:"\u041d\u043e\u0432\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c (Insert)",
handler:this.onAddRecord,scope:this});this.setAddTool(c);b.push(c)}a.hasCopyAccess()&&(c=new Z8.button.Tool({icon:"fa-copy",tooltip:"\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c (Shift+Insert)",handler:this.onCopyRecord,scope:this}),this.setCopyTool(c),b.push(c));a.hasReadAccess()&&(null!=this.source&&(c=new Z8.button.Tool({icon:"fa-pencil",tooltip:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c '"+this.source.text+
"'",handler:this.onEdit,scope:this}),this.setEditTool(c),b.push(c)),c=new Z8.button.Tool({icon:"fa-refresh",tooltip:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c (Ctrl+R)",handler:this.onRefresh,scope:this}),b.push(c),this.setRefreshTool(c));a.hasDestroyAccess()&&(a=new Z8.button.Tool({cls:"remove",danger:!0,icon:"fa-trash",tooltip:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c (Delete)",handler:this.onRemoveRecord,scope:this}),b.push(a),this.setRemoveTool(a));
a=[];0!=b.length&&(b=new Z8.button.Group({items:b}),a.push(b));b=[];!1!==this.filter&&(c=new Z8.button.Tool({icon:"fa-filter",tooltip:"\u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f (Ctrl+F)",toggled:!1}),this.setFilterTool(c),c.on("toggle",this.onQuickFilter,this),b.push(c));c=new Z8.button.Tool({enabled:!1,cls:"btn-sm",icon:"fa-sort",tooltip:"\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438"});this.setSortTool(c);b.push(c);b=new Z8.button.Group({items:b});
a.push(b);b=this.createPeriodTool();this.setPeriodTool(b);null!=b&&a.push(b);b=this.createExportTool();this.setExportTool(b);a.push(b);b=new Z8.button.Tool({icon:"fa-arrows-h",tooltip:"Auto fit columns",toggled:!0});b.on("toggle",this.onAutoFit,this);this.setAutoFitTool(b);a.push(b);return a},createPeriodTool:function(){if(null==this.store.getPeriodProperty())return null;var a=new Z8.data.Period,a=new Z8.calendar.Button({cls:"btn-sm",icon:"fa-calendar",period:a});a.on("period",this.onPeriod,this);
return a},createExportTool:function(){var a=[new Z8.menu.Item({text:"Acrobat Reader (*.pdf)",icon:"fa-file-pdf-o",format:"pdf"}),new Z8.menu.Item({text:"Microsoft Excel (*.xls)",icon:"fa-file-excel-o",format:"xls"}),new Z8.menu.Item({text:"Microsoft Word (*.doc)",icon:"fa-file-word-o",format:"doc"}),"-",new Z8.menu.Item({text:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438",icon:"fa-print",enabled:!1})],a=new Z8.menu.Menu({items:a});a.on("itemClick",this.onMenuExportAs,this);return new Z8.button.Tool({cls:"btn-sm",
icon:"fa-file-pdf-o",tooltip:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a PDF",menu:a,handler:this.exportAs,scope:this,format:"pdf"})},createActions:function(){var a=this.query;if(null==a)return null;a=a.actions;if(Z8.isEmpty(a))return null;for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=e.type,e=new Z8.button.Button({name:e.id,text:e.text,tooltip:e.description,icon:e.icon,action:e,primary:"primary"==f,success:"success"==f,danger:"danger"==f,handler:this.onAction,scope:this});
b.push(e)}this.controls=b;return new Z8.Container({cls:"actions",items:b})},controlMarkup:function(){var a=this.list=new Z8.list.List({cls:"control",store:this.store,items:this.items,totals:this.totals,locks:this.locks,name:this.name,fields:this.fields,editable:this.isEditable(),itemType:this.itemType,value:this.getValue(),icons:this.icons,checks:this.checks,filters:this.filters,useENTER:!1});a.on("select",this.onSelect,this);a.on("contentChange",this.onContentChange,this);a.on("itemEditorChange",
this.onItemEditorChange,this);a.on("itemEdit",this.onItemEdit,this);a.on("itemClick",this.onItemClick,this);a.on("itemDblClick",this.onItemDblClick,this);a.on("check",this.onItemCheck,this);a.on("quickFilterShow",this.onQuickFilterShow,this);a.on("quickFilterHide",this.onQuickFilterHide,this);a.on("autoFit",this.onListAutoFit,this);var b=this.needsPager()?"":"display-none",b=this.pager=new Z8.pager.Pager({cls:b,store:this.store}),a=[a.htmlMarkup(),b.htmlMarkup()],b=this.actions=this.createActions();
null!=b&&a.push(b.htmlMarkup());return a},completeRender:function(){this.callParent();DOM.on(this,"keyDown",this.onKeyDown,this);var a=this.store;a.on("beforeLoad",this.onBeforeLoad,this);a.on("load",this.onLoad,this)},onDestroy:function(){this.setRecord(null);var a=this.store;a.un("beforeLoad",this.onBeforeLoad,this);a.un("load",this.onLoad,this);DOM.un(this,"keyDown",this.onKeyDown,this);this.callParent()},setFields:function(a){this.fields=a;null!=this.list&&this.list.setFields(a)},onSelect:function(a){a=
null!=a?a.record:null;this.mixins.field.setValue.call(this,null!=a?a.id:guid.Null);this.fireEvent("select",this,a);this.updateTools();null==this.selectTask&&(this.selectTask=new Z8.util.DelayedTask);this.selectTask.delay(50,this.updateDependencies,this,a)},onContentChange:function(){this.fireEvent("contentChange",this);this.updateTools();this.updatePager()},onItemEditorChange:function(a,b,c,d){this.fireEvent("itemEditorChange",this,b,c,d)},onItemEdit:function(a,b,c,d){null!=d&&d.important&&this.reloadRecord()},
focus:function(){return this.isEnabled()?this.list.focus():!1},getSelection:function(){var a=null!=this.list?this.list.currentItem():null;return null!=a?a.record:null},getChecked:function(){if(null==this.list)return[];var a=this.list.getCheckedRecords();if(0!=a.length)return a;a=this.getSelection();return null!=a?[a]:[]},getDestroyable:function(){for(var a=[],b=this.getChecked(),c=0,d=b.length;c<d;c++){var e=b[c];e.isDestroyable()&&a.push(e)}return a},select:function(a){var b=this.list;String.isString(a)?
a=b.getItem(a):Number.isNumber(a)?a=b.getAt(Math.min(a,b.getCount()-1)):null!=a&&a.isModel&&(a=b.getItem(a.id));this.list.setSelection(a);return a},startEdit:function(a,b){if(null!=a){var c=this.list,d=c.getItem(a.id);return c.onItemStartEdit(d,b)}return!1},getSelectorQuery:function(a){for(var b=null,c=[],d=this.getLink(),e=0,f=a.length;e<f;e++){var g=a[e];if(g.isCombobox){if(!g.link.isBackward&&g.link.name!=d){if(null!=b&&g.link.name!=b.link.name)return null;b=g}g.link.name!=d&&c.push(g)}}return null==
b?null:{id:this.query.id,name:b.query.name,link:b.link.name,primaryKey:b.link.primaryKey,fields:c,label:{text:b.header,icon:b.icon}}},createRecordsSelector:function(){var a;if(null==this.query)return null;a=this.getSelectorQuery(this.query.columns);if(null==a)return null;var b=Z8.form.Helper.storeConfig({isListbox:!0,query:{id:a.id,name:a.name,fields:a.fields,primaryKey:a.primaryKey},values:this.getValues()});return new Z8.form.field.Listbox({name:a.link,fields:a.fields,label:a.label,store:b,tools:!1,
pagerMode:"visible",checks:!0,height:"100%"})},newRecord:function(){var a=Z8.create(this.getModel());this.hasLink()&&a.set(this.getLink(),this.getRecordId());this.isDependent()&&a.set(this.getDependencyField(),this.getDependsOnValue());return a},createRecords:function(a){(new Z8.data.Batch({model:this.getModel()})).create(a,{fn:function(a,c){if(c){this.reloadRecord();var b=this.store;b.setValues(this.getValues());b.insert(a,0);b=a[0];this.select(b);null==this.selector&&this.startEdit(b,0)||this.focus()}null!=
this.selector&&(c?this.closeSelector():this.selector.setBusy(!1))},scope:this},{values:this.getValues()})},closeSelector:function(){this.selector.close();this.selector=null},onAddRecord:function(a){this.addRecord(a)},getValueFromFields:function(){null==this.valueFromFields&&(this.valueFromFields=this.store.getValueFromFields());return this.valueFromFields},reloadRecord:function(a){var b=this.record;null!=b&&b.reload(a)},addRecord:function(a){var b=this.createRecordsSelector();if(null==b){var c=this.newRecord();
this.createRecords(c)}else null!=a&&a.setBusy(!0),b.store.load({fn:function(c,e,f){null!=a&&a.setBusy(!1);f&&(c=new Z8.Container({cls:"padding-15",items:[b],height:"100%"}),this.selector=new Z8.window.Window({cls:"air",header:this.query.text,icon:"fa-plus-circle",autoClose:!1,body:[c],selector:b,handler:function(a,b){if(b){for(var c=[],d=a.selector,e=d.getChecked(),d=d.name,f=this.getValueFromFields(),g=0,h=e.length;g<h;g++){var q=this.newRecord(),v=e[g];q.set(d,v.id);for(var u=0,w=f.length;u<w;u++){var r=
f[u];q.set(r.name,v.get(r.valueFrom))}c.push(q)}this.createRecords(c)}else this.closeSelector(),this.focus()},scope:this}),this.selector.open())},scope:this})},onCopyRecord:function(a){this.copyRecord(this.getChecked()[0],a)},copyRecord:function(a,b){null!=b&&b.setBusy(!0);Z8.create(this.getModel()).copy(a,{fn:function(a,d){null!=b&&b.setBusy(!1);d&&(this.reloadRecord(),this.store.insert(a,0),this.select(a.id),this.startEdit(a,0)||this.focus())},scope:this},{values:this.getValues()})},onBeforeLoad:function(a){null!=
this.refreshTool&&this.refreshTool.setBusy(!0)},onLoad:function(a,b,c){null!=this.refreshTool&&this.refreshTool.setBusy(!1)},onRefresh:function(a){a=a||this.refreshTool;if(null!=a){var b=function(b,d){a.setBusy(!1);this.focus()};a.setBusy(!0)}this.store.load({fn:b,scope:this})},onRemoveRecord:function(a){this.removeRecord(this.getDestroyable(),a)},removeRecord:function(a,b){if(0==a.length)throw"Listbox.removeRecord: records.length == 0";var c=this.store.indexOf(a[0]);null!=b&&b.setBusy(!0);(new Z8.data.Batch({store:this.store})).destroy(a,
{fn:function(a,e){null!=b&&b.setBusy(!1);e&&(this.reloadRecord(),this.select(c),this.focus())},scope:this})},onPeriod:function(a,b,c){c!=Period.NoAction&&this.store.setPeriod(b);this.onRefresh(this.periodTool)},getSelectedIds:function(){for(var a=[],b=this.getChecked(),c=0,d=b.length;c<d;c++)b[c].phantom||a.push(b[c].id);return a},onMenuExportAs:function(a,b){var c=b.format;"pdf"==c?this.exportAsPdf():"xls"==c?this.exportAsXls():"doc"==c&&this.exportAsDoc()},exportAsPdf:function(){var a=this.exportTool;
a.setIcon("fa-file-pdf-o");a.setTooltip("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a PDF");a.format="pdf";this.exportAs()},exportAsXls:function(){var a=this.exportTool;a.setIcon("fa-file-excel-o");a.setTooltip("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a XLS");a.format="xls";this.exportAs()},exportAsDoc:function(){var a=this.exportTool;a.setIcon("fa-file-word-o");a.setTooltip("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a DOC");
a.format="doc";this.exportAs()},exportAs:function(){for(var a=this.exportTool,b=a.format,c=[],d=this.getHeaders(),e=0,f=d.length;e<f;e++){var g=d[e],h=g.field;null!=h&&h.type!=Type.Text&&c.push({id:h.name,width:Ems.emsToPixels(g.getWidth())})}d=this.store;b={request:d.getModelName(),action:"export",format:b,query:d.getQuery(),columns:c,filter:d.getFilter(),quickFilter:d.getQuickFilter(),where:d.getWhere(),sort:d.getSorter(),period:d.getPeriod(),values:d.getValues()};a.setBusy(!0);HttpRequest.send(b,
{fn:function(b,c){a.setBusy(!1)},scope:this});this.focus()},onAction:function(a){a.setBusy(!0);Z8.isEmpty(a.action.parameters)?this.runAction(a):this.requestActionParameters(a)},requestActionParameters:function(a){this.runAction(a)},runAction:function(a){var b=a.action,c=this.record,d=this.query,b={request:this.store.getModelName(),action:"action",id:b.id,query:d.name,records:null==c||c.phantom?null:[c.id],selection:this.getSelectedIds(),parameters:b.parameters};HttpRequest.send(b,{fn:function(b,
d){a.setBusy(!1);this.onActionComplete(a,c,b,d)},scope:this})},onActionComplete:function(a,b,c,d){d&&this.record==b&&b.reload({fn:function(b,c){a.setBusy(!1);c&&(this.onRefresh(),this.fireEvent("action",this,a.action))},scope:this})},onItemClick:function(a,b,c){if(-1!=c&&this.editable){var d=this.fields[c];if(d.type!=Type.Boolean||!d.isText||!d.editable)return;a=b.record;if(a.isBusy())return;d=d.name;a.beginEdit();a.set(d,!a.get(d));this.hasLink()&&a.set(this.getLink(),this.getRecordId());this.isDependent()&&
a.set(this.getDependencyField(),this.getDependsOnValue());a.update({fn:function(a,b){b?a.endEdit():a.cancelEdit()},scope:this},{values:this.getValues()})}this.fireEvent("itemClick",this,b,c)},onItemDblClick:function(a,b,c){this.fireEvent("itemDblClick",this,b,c)},onKeyDown:function(a,b){var c=a.getKey();this.list.isEditing()||this.list.isFiltering()||(c==Event.ENTER||c==Event.F2?this.startEdit(this.getSelection())&&a.stopEvent():c==Event.INSERT?(c=a.ctrlKey?this.copyTool:this.addTool,null!=c&&c.isEnabled()&&
(c.handler.call(c.scope,c),a.stopEvent())):c==Event.DELETE?(c=this.removeTool,null!=c&&c.isEnabled()&&(c.handler.call(c.scope,c),a.stopEvent())):c==Event.A&&a.ctrlKey?this.list.checkAll()&&a.stopEvent():c==Event.R&&a.ctrlKey&&!a.shiftKey&&(this.onRefresh(this.refreshTool),a.stopEvent()))},onItemCheck:function(a,b){this.updateTools()},onEdit:function(a){Viewport.open(this.source.id)},onQuickFilter:function(a,b){this.list.showQuickFilter(b,!0)},onQuickFilterShow:function(a){null!=this.filterTool&&this.filterTool.setToggled(!0,
!0)},onQuickFilterHide:function(a){null!=this.filterTool&&this.filterTool.setToggled(!1,!0)},onAutoFit:function(a,b){this.list.setAutoFit(b,!0);this.focus()},show:function(){this.callParent();this.list.adjustAutoFit()},onListAutoFit:function(a,b){null!=this.autoFitTool&&this.autoFitTool.setToggled(b,!0)},updateTools:function(){if(this.hasTools&&null!=this.getDom()){var a=this.isEnabled()&&!this.isReadOnly();null!=this.removeTool&&this.removeTool.setEnabled(a&&!Z8.isEmpty(this.getDestroyable()));if(null!=
this.copyTool){var b=this.getChecked();this.copyTool.setEnabled(a&&!Z8.isEmpty(b)&&1==b.length)}null!=this.addTool&&(b=this.getRecord(),this.addTool.setEnabled(a&&null!=b&&(!this.isDependent()||this.hasDependsOnValue())))}},needsPager:function(){return"visible"==this.pagerMode},updatePager:function(){var a=this.needsPager();DOM.swapCls(this.pager,!a,"display-none");DOM.swapCls(this,a,"pager-on")}});
Z8.define("Z8.data.file.Model",{extend:"Z8.data.Model",local:!0,idProperty:"id",fields:[new Z8.data.field.Guid({name:"id"}),new Z8.data.field.String({name:"name"}),new Z8.data.field.String({name:"path"}),new Z8.data.field.Integer({name:"size"}),new Z8.data.field.Datetime({name:"time"}),new Z8.data.field.String({name:"author"})]});
Z8.define("Z8.form.field.Files",{extend:"Z8.form.field.Listbox",tools:!0,checks:!0,fields:[{name:"name",header:"\u0424\u0430\u0439\u043b",type:Type.String,icon:"fa-file-o"},{name:"size",header:"\u0420\u0430\u0437\u043c\u0435\u0440",type:Type.Integer,renderer:Format.fileSize},{name:"time",header:"\u0414\u0430\u0442\u0430",type:Type.Datetime,renderer:Format.dateOrTime,icon:"fa-clock-o"},{name:"author",header:"\u0410\u0432\u0442\u043e\u0440",type:Type.String,icon:"fa-user-o"}],initComponent:function(){this.store=
new Z8.data.Store({model:"Z8.data.file.Model"});this.callParent()},setValue:function(a,b){this.callParent(a,b);null!=this.store&&this.store.loadData(a)},afterRecordSet:function(a){},createTools:function(){var a=this.uploadTool=new Z8.button.Tool({cls:"btn-sm",icon:"fa-upload",tooltip:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0444\u0430\u0439\u043b(\u044b)",handler:this.onUploadFile,scope:this}),b=this.downloadTool=new Z8.button.Tool({cls:"btn-sm",icon:"fa-download",tooltip:"\u0421\u043a\u0430\u0447\u0430\u0442\u044c \u0444\u0430\u0439\u043b(\u044b)",
handler:this.onDownloadFile,scope:this}),c=this.removeTool=new Z8.button.Tool({cls:"btn-sm remove",danger:!0,icon:"fa-trash",tooltip:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0444\u0430\u0439\u043b(\u044b)",handler:this.onRemoveFile,scope:this});return[a,b,c]},completeRender:function(){this.callParent();var a=this.fileInput=DOM.append(this,{tag:"input",type:"file",multiple:!0});DOM.on(a,"change",this.onFileInputChange,this);DOM.on(this,"dragEnter",this.onDragEnter,this);DOM.on(this,"dragOver",
this.onDragOver,this);DOM.on(this,"drop",this.onDrop,this);DOM.on(window,"dragEnter",this.onWindowDragEnter,this);DOM.on(window,"dragOver",this.onWindowDragOver,this);DOM.on(window,"dragLeave",this.onWindowDragLeave,this);DOM.on(window,"drop",this.onWindowDrop,this)},onDestroy:function(){DOM.un(window,"dragEnter",this.onWindowDragEnter,this);DOM.un(window,"dragOver",this.onWindowDragOver,this);DOM.un(window,"dragLeave",this.onWindowDragLeave,this);DOM.un(window,"drop",this.onWindowDrop,this);DOM.un(this,
"dragEnter",this.onDragEnter,this);DOM.un(this,"dragOver",this.onDragOver,this);DOM.un(this,"drop",this.onDrop,this);DOM.un(this.fileInput,"change",this.onFileInputChange,this);DOM.remove(this.fileInput);this.fileInput=null;this.callParent()},updateTools:function(){if(null!=this.getDom()){var a=!this.isReadOnly()&&this.isEnabled();this.uploadTool.setEnabled(a);a=a&&0!=this.getChecked().length;this.downloadTool.setEnabled(a);this.removeTool.setEnabled(a)}},onUploadFile:function(a){this.fileInput.value=
null;this.fileInput.click()},onRemoveFile:function(a){a=[];for(var b=this.getChecked(),c=0,d=b.length;c<d;c++)a.push(b[c].id);this.removeTool.setBusy(!0);this.getRecord().detach(this.name,a,{fn:function(a,b,c){this.removeTool.setBusy(!1);c&&this.getRecord()==a&&this.setValue(b)},scope:this})},onDownloadFile:function(a){a=this.getChecked();var b=a.length,c=function(a){0==--b&&this.downloadTool.setBusy(!1)};this.downloadTool.setBusy(!0);for(var d=0,e=a.length;d<e;d++)DOM.download(HttpRequest.hostUrl()+
"/"+a[d].get("path"),null,{fn:c,scope:this})},onFileInputChange:function(){this.upload(this.fileInput.files)},onDragEnter:function(a){var b=a.dataTransfer;null!=b&&!this.isReadOnly()&&this.isEnabled()&&(b.effectAllowed=b.dropEffect="copy",a.stopEvent())},onDragOver:function(a){null!=a.dataTransfer&&!this.isReadOnly()&&this.isEnabled()&&a.stopEvent()},onDrop:function(a){var b=a.dataTransfer;null!=b&&!this.isReadOnly()&&this.isEnabled()&&(b.effectAllowed=b.dropEffect="copy",a.stopEvent(),this.upload(b.files))},
onWindowDragEnter:function(a){},onWindowDragLeave:function(a){},onWindowDragOver:function(a){var b=a.dataTransfer;a.dataTransfer&&(b.effectAllowed=b.dropEffect="none",a.stopEvent())},onWindowDrop:function(a){null!=a.dataTransfer&&a.stopEvent()},upload:function(a){0!=a.length&&(this.uploadTool.setBusy(!0),this.getRecord().attach(this.name,a,{fn:function(a,c,d){this.uploadTool.setBusy(!1);d&&this.getRecord()==a&&(this.setValue(c),a=c.last(),this.select(null!=a?a.id:null),this.focus())},scope:this}))}});
Z8.define("Z8.form.field.Date",{extend:"Z8.form.field.Text",triggers:[{icon:"fa-calendar"}],enterToOpen:!0,enterOnce:!1,format:"d.m.Y",initComponent:function(){this.callParent()},setValue:function(a,b){this.entered=!0;a=String.isString(a)?this.rawToValue(a):a;this.callParent(a,b)},valueToRaw:function(a){return Format.date(a,this.format)},rawToValue:function(a){return Parser.datetime(a,this.format)},isEqual:function(a,b){return Date.isEqual(a,b)},htmlMarkup:function(){var a=this.callParent(),b=this.getValue(),
b=this.dropdown=new Z8.calendar.Dropdown({date:null!=b?new Date(b):null});b.on("dayClick",this.setValue,this);b.on("cancel",this.cancelDropdown,this);b.on("show",this.onDropdownShow,this);b.on("hide",this.onDropdownHide,this);a.cn.push(b.htmlMarkup());return a},subcomponents:function(){return this.callParent().add(this.dropdown)},completeRender:function(){this.callParent();this.dropdown.setAlignment(this.input)},select:function(a){},show:function(){this.entered=!1;this.callParent()},showDropdown:function(){var a=
this.dropdown,b=DOM.getOffsetLeft(this.input);DOM.setLeft(a,b);this.dropdown.show()},hideDropdown:function(){this.dropdown.hide()},openDropdown:function(){var a=this.getValue();this.dropdown.set(null!=a?new Date(a):null);this.showDropdown()},cancelDropdown:function(){this.hideDropdown()},toggleDropdown:function(){this.dropdown.visible?this.cancelDropdown():this.openDropdown()},onDropdownShow:function(){this.getTrigger().rotateIcon(360)},onDropdownHide:function(){this.getTrigger().rotateIcon(0);DOM.focus(this.input)},
onFocusOut:function(a){if(!this.callParent(a))return!1;this.cancelDropdown();return!0},onTriggerClick:function(a){this.toggleDropdown()},onKeyEvent:function(a,b){var c=a.getKey(),d=this.dropdown,e=d.visible;if(c==Event.DOWN)e?d.focus():this.select("next");else if(c==Event.UP)e?d.focus():this.select("previous");else{if(c==Event.TAB&&DOM.isParentOf(this.trigger,b))return e?d.focus():this.cancelDropdown(),!1;if(c==Event.ENTER||c==Event.SPACE&&DOM.isParentOf(this.trigger,b))if(e)this.setValue(d.date),
this.cancelDropdown();else if(!this.enterToOpen||this.enterOnce&&this.entered)if(a.ctrlKey)this.onTriggerClick(a,b);else return!1;else this.onTriggerClick(a,b),this.entered=!0;else if(c==Event.ESC&&e)this.cancelDropdown();else return!1}return!0}});Z8.define("Z8.form.field.Datetime",{extend:"Z8.form.field.Date",format:"d.m.Y H:i"});
Z8.define("Z8.form.field.Search",{extend:"Z8.form.field.Text",triggers:[{icon:"fa-search"}],searchPending:!1,lastSearchValue:"",initComponent:function(){this.callParent()},isValid:function(){return!0},getValue:function(){return this.callParent()||""},completeRender:function(){this.callParent();this.updateTrigger()},setBusy:function(a){this.getTrigger().setBusy(a)},updateTrigger:function(){var a=this.getTrigger();a.isBusy()||(a.setIcon(this.searchPending||""==this.lastSearchValue?"fa-search":"fa-times"),
a.setEnabled(this.searchPending||""!=this.lastSearchValue))},onInput:function(a,b){this.callParent(a,b);this.searchPending=this.getValue()!=this.lastSearchValue;this.updateTrigger()},search:function(){if(this.getTrigger().isEnabled()){this.searchPending||this.setValue("");var a=this.lastSearchValue=this.getValue();this.searchPending=!1;this.updateTrigger();this.fireEvent("search",this,a)}},clear:function(){if(!this.getTrigger().isEnabled())return!1;this.setValue("");this.searchPending&&""==this.lastSearchValue?
(this.searchPending=!1,this.updateTrigger()):this.search();return!0},onTriggerClick:function(a){this.search()},onKeyEvent:function(a,b){var c=a.getKey();if(c==Event.ENTER)this.search();else{if(c==Event.ESC)return this.clear();this.fireEvent("keyDown",this,a,b);return!1}return!0},reset:function(){this.callParent();this.searchPending=!1;this.lastSearchValue="";this.updateTrigger()},getFilter:function(){if(null==this.field)return null;var a=this.getValue();return Z8.isEmpty(a)?null:{property:this.field.name,
operator:Operation.Contains,value:a}}});
Z8.define("Z8.form.field.Filter",{extend:"Z8.form.field.Control",tabIndex:-1,setValue:function(a){a!=this.getValue()&&(this.callParent(a),null!=this.expression&&(this.expression.setExpression(a),this.updateTools()))},isEqual:function(a,b){return JSON.encode(a)==JSON.encode(b)},subcomponents:function(){return this.callParent().add(this.expression)},htmlMarkup:function(){this.cls=DOM.parseCls(this.cls).pushIf("filter-control");var a=this.label=this.label||{},b=this.newLineButton=new Z8.button.Button({tooltip:"\u041d\u043e\u0432\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430",
icon:"fa-file-o",handler:this.newLine,scope:this}),c=this.groupButton=new Z8.button.Button({tooltip:"\u0413\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c",icon:"fa-link",handler:this.group,scope:this}),d=this.ungroupButton=new Z8.button.Button({tooltip:"\u0420\u0430\u0437\u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c",icon:"fa-unlink",handler:this.ungroup,scope:this}),e=this.removeLineButton=new Z8.button.Button({tooltip:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0438",
cls:"remove",icon:"fa-trash",danger:!0,handler:this.removeLine,scope:this});a.tools=new Z8.button.Group({items:[b,c,d,e]});return this.callParent()},controlMarkup:function(){var a=this.expression=new Z8.filter.Expression({cls:"control",fields:this.fields,expression:this.getValue()});a.on("select",this.onExpressionSelect,this);a.on("change",this.onExpressionChange,this);return[a.htmlMarkup()]},completeRender:function(){this.callParent();this.updateTools()},focus:function(){return this.isEnabled()?
this.expression.focus():!1},getSelection:function(){return this.expression.getSelection()},updateTools:function(a){a=a||this.getSelection();this.newLineButton.setEnabled(this.isEnabled());this.removeLineButton.setEnabled(0!=a.length);this.groupButton.setEnabled(null!=a&&1<a.length);this.ungroupButton.setEnabled(0!=this.getGroups(a).length)},onExpressionSelect:function(a){this.updateTools(a)},onExpressionChange:function(a){this.superclass.setValue.call(this,a);this.updateTools()},newLine:function(){var a=
this.getSelection(),a=0!=a.length?a[0]:null;(a instanceof Z8.filter.Group?a:null!=a?a.container:this.expression).newLine()},removeLine:function(){var a=this.getSelection(),b=a[0].container;b.removeLine(a);b.focus()},group:function(){var a=this.getSelection();a[0].container.group(a)},ungroup:function(){for(var a=this.getGroups(this.getSelection()),b=0,c=a.length;b<c;b++)a[b].ungroup()},getGroups:function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];e instanceof Z8.filter.Group&&b.push(e)}return b},
getExpression:function(){return this.expression.getExpression()},getExpressionText:function(){return this.expression.getExpressionText()}});
Z8.define("Z8.form.Fieldset",{extend:"Z8.Component",shortClassName:"Fieldset",statics:{MarginTop:.71428571,MarginBottom:.71428571,PaddingTop:1.07142857,PaddingBottom:0,Border:.07142857,extraHeight:function(){return Fieldset.MarginTop+Fieldset.MarginBottom+Fieldset.PaddingTop+Fieldset.PaddingBottom+2*Fieldset.Border}},isFieldset:!0,colCount:1,constructor:function(a){this.controls=[];this.readOnlyLock=null!=a?a.readOnly:!1;this.callParent(a)},getControls:function(){return this.controls},getControl:function(a){return this.traverseControls(this.controls,
a)},traverseControls:function(a,b){if(null==a)return null;for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e.name==b||e.displayName==b)return e;e=this.traverseControls(e.controls,b);if(null!=e)return e}return null},getBoxMinHeight:function(){var a=this.getMinHeight();return 0!=a?a+(this.plain?0:Fieldset.extraHeight()):0},subcomponents:function(){return this.controls},htmlMarkup:function(){this.setReadOnly(this.isReadOnly());if(null!=this.icon)var a=DOM.parseCls(this.icon).pushIf("fa").join(" "),a={tag:"i",
cls:a};var b=this.legend||"",a={cls:"legend",cn:null!=a?[a,b]:[b]},a=(this.plain?[]:[a]).concat(this.rowsMarkup()),b=DOM.parseCls(this.cls).pushIf("fieldset",this.plain?"section":"",this.isEnabled()?"":"disabled",this.isReadOnly()?"readonly":"",this.flex?"flexed":"").join(" ");return{id:this.getId(),cls:b,cn:a}},rowsMarkup:function(){for(var a=[],b=this.getRows(),c=this.controls,d=b.length,e=Math.floor(12/Math.max(1,this.colCount)),f=0,g=Ems.UnitHeight+Ems.UnitSpacing,h=0,k=0;k<d;k++){for(var m=[],
n=b[k],l=0,p=0,t=n.length;p<t;p++)l=Math.max(l,c[h].flex||0);for(var q=0!=l?" flexed":"",v=0,u=0,p=0,t=n.length;p<t;p++){var w=[],r=c[h];w.push(null!=r.htmlMarkup?r.htmlMarkup():r);u=Math.max(u,r.isComponent?r.getBoxMinHeight():0);r=Math.min(12,n[p]*e);m.push({cls:"col-lg-"+r+" col-md-"+r+" col-sm-"+r+" cell"+q,cn:w});v+=r;h++}12>v&&(n=12-v,m.push({cls:"col-lg-"+n+" col-md-"+n+" col-sm-"+n+" cell"+q}));f+=u||g;m={cls:"row"+(0!=l?" flex-"+l:""),cn:m};0!=u&&(m.style="min-height: "+u+"em");a.push(m)}null!=
this.actions&&(a.push(this.actionsMarkup()),f+=g);!1!==this.minHeight&&(this.minHeight=f);return a},getRows:function(){for(var a=this.controls,b=[],c=[b],d=this.colCount,e=0,f=0,g=a.length;f<g;f++){var h=a[f].colSpan||1,e=e+h;e>d&&0!=f?(b=[h],e=h,c.push(b)):b.push(h)}return 0!=c[0].length?c:[]},actionsMarkup:function(){for(var a=this.actions,b=this.controls,c=[],d=0,e=a.length;d<e;d++){var f=a[d],g=f.type,f=new Z8.button.Button({name:f.id,text:f.text,tooltip:f.description,icon:f.icon,action:f,primary:"primary"==
g,success:"success"==g,danger:"danger"==g});b.push(f);c.insert(f.htmlMarkup())}return{cls:"row",cn:[{cls:"col-lg-12 col-md-12 col-sm-12 cell actions",cn:c}]}},setEnabled:function(a){DOM.swapCls(this,!a,"disabled");this.callParent(a)},isReadOnly:function(){return this.readOnly},setReadOnly:function(a){for(var b=this.controls,c=0,d=b.length;c<d;c++){var e=b[c];e.readOnlyLock||null==e.setReadOnly||e.setReadOnly(a)}this.readOnly=a;DOM.swapCls(this,a,"readonly")},focus:function(){for(var a=this.controls,
b=0,c=a.length;b<c;b++){var d=a[b];if(null!=d.focus&&d.focus())return!0}return!1}});
Z8.define("Z8.form.Form",{extend:"Z8.form.Fieldset",mixins:["Z8.form.field.Field"],isForm:!0,autoSave:!1,fields:null,controls:null,fieldsMap:null,constructor:function(a){a=a||{};null==a.name&&(a.cls=DOM.parseCls(a.cls).pushIf("form"));this.callParent(a)},initComponent:function(){this.callParent();this.initControls();this.initFields();this.setReadOnly(this.readOnly)},setReadOnly:function(a){this.callParent(a||null==this.record||!this.record.isEditable())},initControls:function(){var a=this.controls;
this.fields=[];this.fieldsMap={};this.controls=[];for(var b=0,c=a.length;b<c;b++)this.initControl(a[b],this)},getFields:function(){return this.fields},getField:function(a){return this.fieldsMap[a]},getQuery:function(){return null!=this.query?this.query.id:null},initControl:function(a,b){if(a.isForm||a instanceof Z8.form.Form)a=this.initForm(a);else if(a.isSection||a instanceof Z8.form.Fieldset)a=this.initFieldset(a);else if(a.isTabControl||a instanceof Z8.form.Tabs)a=this.initTabControl(a);else if(a instanceof
Z8.form.field.Listbox)this.addField(a);else if(a.isListbox)a=Z8.form.Helper.createControl(a),this.addField(a);else if(a instanceof Z8.form.field.Control)this.addField(a);else{if(a.isText&&a.isLink)return;a.isText?(a=Z8.form.Helper.createControl(a),this.addField(a)):a.isCombobox&&(a=Z8.form.Helper.createControl(a),this.addField(a))}b.controls.push(a)},initForm:function(a){if(a.isForm){a.autoSave=!0;a.plain=!0;a.height=Ems.unitsToEms(a.height);var b=Application.getSubclass(a.ui);a=null!=b?Z8.create(b,
a):new Z8.form.Form(a)}this.addField(a);for(var b=a.fields,c=0,d=b.length;c<d;c++)this.addField(b[c]);return a},initFieldset:function(a){var b=a.controls||[];a.isSection?a=Z8.form.Helper.createFieldset(a):a.controls=[];for(var c=0,d=b.length;c<d;c++)this.initControl(b[c],a);return a},initTab:function(a){var b=a.controls||[];a.isSection?a=Z8.form.Helper.createTab(a):a.controls=[];for(var c=0,d=b.length;c<d;c++)this.initControl(b[c],a);return a},initTabControl:function(a){for(var b=[],c=a.tabs||[],
d=0,e=c.length;d<e;d++){var f=this.initTab(c[d]);b.push(f)}return new Z8.form.Tabs({name:a.name,controls:b,actions:a.actions,colSpan:a.colSpan,readOnly:a.readOnly,flex:a.flex,height:a.height})},addField:function(a){null!=a.name&&(this.fields.push(a),this.fieldsMap[a.name]=a,null!=a.displayName&&(this.fieldsMap[a.displayName]=a),null==a.form&&(a.form=this))},initAutoSave:function(a){!this.autoSave||a.isListbox||a.isForm||a.form!=this||(a.setAutoSave(!0),a.on("change",this.autoSaveCallback,this))},
initDependencies:function(a){var b=null!=a.field?a.field.dependencies:a.dependencies;if(null!=b&&(a.isCombobox||a.isListbox||a.isForm)){a.dependencies=null;for(var c=0,d=b.length;c<d;c++){var e=this.getField(b[c]);null!=e&&a.addDependency(e)}}},initFields:function(){for(var a=this.fields,b=0,c=a.length;b<c;b++){var d=a[b];this.initAutoSave(d);this.initDependencies(d)}},autoSaveCallback:function(a,b,c){if(this.autoSave&&(a.isValid()||a.isDependent())){c=this.record;c.beginEdit();c.set(a.name,b);null!=
a.displayName&&c.set(a.displayName,a.getDisplayValue());b={};var d=this.link;if(null!=d){b.link=d.name;var e=d.primaryKey,f=d.query.primaryKey;c.set(e,c.get(e),!1,!0);c.set(f,c.get(d.name),!1,!0)}c.update({fn:function(b,c){c?(this.applyRecordChange(b,a),a.isCombobox&&a.updateDependencies(a.getSelectedRecord()),b.endEdit()):(a.initValue(a.originalValue,a.originalDisplayValue),b.cancelEdit())},scope:this},b)}},applyRecordChange:function(a,b){for(var c=this.getFields(),d=a.getModifiedFields(),e=0,f=
c.length;e<f;e++){var g=c[e],h=g.name,k=g.displayName;g!=b&&(h in d||k in d)&&(h=a.get(h)||null,k=null!=a?a.get(k):null,g.initValue(h,k))}},isMyRecord:function(a){if(!this.isDependent())return!0;var b=this.getQuery();return null==a||null==b||b==a.getQuery()},setRecord:function(a){if(this.isMyRecord(a)){var b=this.record;null!=b&&b.un("change",this.onRecordChange,this);this.record=a;this.updateDependencies(a);if(null!=a)a.on("change",this.onRecordChange,this)}},onDestroy:function(){var a=this.record;
null!=a&&a.un("change",this.onRecordChange,this);this.callParent()},onRecordChange:function(a,b){this.applyRecordChange(a,null);for(var c in b){var d=this.getField(c);null!=d&&d.isCombobox&&d.updateDependencies(d.getSelectedRecord())}},loadRecord:function(a){var b=this.fields,c=this.record;this.setRecord(a);for(var d=0,e=b.length;d<e;d++){var f=b[d],g=f.form;if(g==this||g.isMyRecord(a)){if(null!=a){var g=a.get(f.name),h=null!=f.displayName?a.get(f.displayName):null;f.initValue(g,h)}else f.initValue(null,
null);f.setRecord(a)}}this.readOnlyLock||this.setReadOnly(null==a||!a.isEditable());this.fireEvent("change",this,this.record,c)},onDependencyChange:function(a){this.loadRecord(a)}});
Z8.define("Z8.form.Helper",{statics:{storeConfig:function(a){return Z8.query.Store.config(a)},createControl:function(a){if(null==a)return null;var b=!1!==a.label?{text:a.header,icon:a.icon,align:"top"}:!1,c={label:b,placeholder:a.header,name:a.name,field:a,colSpan:a.colSpan,flex:a.flex,readOnly:a.readOnly,editable:a.editable,enterOnce:a.enterOnce,source:a.source};null!=a.format&&(c.format=a.format);var d=Application.getSubclass(a.ui);if(a.isCombobox)return c.store=this.storeConfig(a),c.displayName=
a.name,c.fields=a,c.name=a.link.name,c.required=a.required,c.checks=!1,c.pagerMode="visible",null!=d?Z8.create(d,c):new Z8.form.field.Combobox(c);if(a.isListbox)return b=a.query,c.store=this.storeConfig(a),c.query=b,c.fields=b.columns,c.tools=!0,c.pagerMode="visible",c.checks=!0,c.locks=null!=b.lockKey,c.totals=b.totals,c.minHeight=c.height=Ems.unitsToEms(a.height||5),null!=d?Z8.create(d,c):new Z8.form.field.Listbox(c);var e=a.type;if(e==Type.Boolean)return b.align="right",null!=d?Z8.create(d,c):
new Z8.form.field.Checkbox(c);if(e==Type.Integer)return null!=d?Z8.create(d,c):new Z8.form.field.Integer(c);if(e==Type.Float)return null!=d?Z8.create(d,c):new Z8.form.field.Float(c);if(e==Type.Date)return null!=d?Z8.create(d,c):new Z8.form.field.Date(c);if(e==Type.Datetime)return null!=d?Z8.create(d,c):new Z8.form.field.Datetime(c);if(e==Type.String)return null!=d?Z8.create(d,c):new Z8.form.field.Text(c);if(e==Type.Text)return c.minHeight=Ems.unitsToEms(a.height),null!=d?Z8.create(d,c):a.html?new Z8.form.field.Html(c):
new Z8.form.field.TextArea(c);if(e==Type.Files)return c.height=Ems.unitsToEms(a.height||3),null!=d?Z8.create(d,c):new Z8.form.field.Files(c);if(e==Type.Guid||e==Type.Datespan)return null!=d?Z8.create(d,c):new Z8.form.field.Text(c);throw'Unknown server type "'+e+'"';},createFieldset:function(a){var b={name:a.name,actions:a.actions,colCount:a.colCount,colSpan:a.colSpan,readOnly:a.readOnly,legend:a.legend,icon:a.icon,plain:!a.isFieldset,height:Ems.unitsToEms(a.height),flex:a.flex};a=Application.getSubclass(a.ui);
return null!=a?Z8.create(a,b):new Z8.form.Fieldset(b)},createTab:function(a){var b={name:a.name,title:a.header,actions:a.actions,colCount:a.colCount,colSpan:a.colSpan,readOnly:a.readOnly,icon:a.icon,height:Ems.unitsToEms(a.height),flex:a.flex};a=Application.getSubclass(a.ui);return null!=a?Z8.create(a,b):new Z8.form.Tab(b)}}});Z8.define("Z8.form.Tab",{extend:"Z8.form.Fieldset",shortClassName:"Tab",minHeight:!1,plain:!0,setText:function(a){var b=this.tag;null!=b&&b.setText(a)}});
Z8.define("Z8.form.Tabs",{extend:"Z8.Container",shortClassName:"Tabs",initComponent:function(){this.minHeight=this.height=this.height||Ems.unitsToEms(6);this.callParent()},htmlMarkup:function(){this.setReadOnly(this.isReadOnly());var a=this.controls||[];this.cls=DOM.parseCls(this.cls).pushIf("tabs",this.flex?"flexed":"");this.headerCls=DOM.parseCls(this.headerCls).pushIf("header");this.bodyCls=DOM.parseCls(this.bodyCls).pushIf("body");for(var b=function(a,b){DOM.addCls(this.getActiveTab(),"inactive");
var c=this.activeTab=a.tab;DOM.removeCls(c,"inactive")},c=[],d=0,e=a.length;d<e;d++){var f=a[d];f.cls=DOM.parseCls(f.cls).pushIf("tab",0!=d?"inactive":"").join(" ");var g=f.tag=new Z8.button.Button({cls:"tag",toggle:!0,text:f.title,icon:f.icon,tab:f});f.icon=null;g.on("toggle",b,this);c.push(g)}b=this.header=new Z8.button.Group({radio:!0,cls:this.headerCls.join(" "),items:c});a=new Z8.Container({cls:this.bodyCls.join(" "),items:a});this.items=[b,a];return this.callParent()},completeRender:function(){this.callParent();
Z8.isEmpty(this.controls)||this.activateTab(this.controls[0])},getActiveTab:function(){return this.activeTab},showTab:function(a,b){DOM.swapCls(a.tag,!b,"display-none");b||a!=this.getActiveTab()||DOM.addCls(a,"inactive")},activateTab:function(a){a.tag.setToggled(!0)},isReadOnly:function(){return this.readOnly},setReadOnly:function(a){for(var b=this.controls,c=0,d=b.length;c<d;c++){var e=b[c];e.readOnlyLock||null==e.setReadOnly||e.setReadOnly(a)}this.readOnly=a;DOM.swapCls(this,a,"readonly")}});
Z8.define("Z8.menu.Item",{extend:"Z8.list.Item",icon:"fa-circle transparent",tabIndex:0,useENTER:!0});
Z8.define("Z8.menu.Menu",{extend:"Z8.list.Dropdown",cls:"dropdown-menu display-none",itemType:"Z8.menu.Item",manualItemsRendering:!0,useTAB:!0,headers:!1,checks:!1,activateItem:function(){},completeRender:function(){this.callParent();DOM.on(this,"blur",this.onFocusOut,this,!0)},onDestroy:function(){DOM.un(this,"blur",this.onFocusOut,this,!0);this.callParent()},onFocusOut:function(a){var b=DOM.get(this);a=a.relatedTarget;if(b!=a&&!DOM.isParentOf(b,a)&&!DOM.isParentOf(this.owner,a))this.onCancel()},
toggle:function(){0!=this.getCount()&&this.callParent()}});
Z8.define("Z8.pager.Pager",{extend:"Z8.Container",initComponent:function(){this.callParent();var a=this.store;this.store=null;this.setStore(a)},setStore:function(a){var b=this.store;a!=b&&(null!=b&&(b.un("load",this.updateControls,this),b.un("add",this.updateControls,this),b.un("remove",this.updateControls,this),b.un("beforeCount",this.onBeforeCount,this),b.un("count",this.onCount,this),b.dispose()),this.store=a,null!=a&&(a.use(),a.on("load",this.updateControls,this),a.on("add",this.updateControls,
this),a.on("remove",this.updateControls,this),a.on("count",this.updateControls,this)),this.updateControls())},htmlMarkup:function(){var a=this.first=new Z8.button.Button({tabIndex:-1,icon:"fa-angle-double-left",cls:"btn-tool",tooltip:"To the First Page",handler:this.onFirst,scope:this}),b=this.previous=new Z8.button.Button({tabIndex:-1,icon:"fa-angle-left",cls:"btn-tool",tooltip:"To the Previous Page",handler:this.onPrevious,scope:this}),c=this.pageNumber=new Z8.form.field.Integer({tabIndex:-1,inputCls:"input-sm",
tooltip:"To the Page"}),d=this.pageTotals=new Z8.Component({cls:"totals",html:this.pageTotalsText()}),e=this.next=new Z8.button.Button({tabIndex:-1,icon:"fa-angle-right",cls:"btn-tool",tooltip:"To the Next Page",handler:this.onNext,scope:this}),f=this.last=new Z8.button.Button({tabIndex:-1,icon:"fa-angle-double-right",cls:"btn-tool",tooltip:"To the Last Page",handler:this.onLast,scope:this}),a=this.paging=new Z8.Container({cls:"paging",items:[a,b,c,d,e,f]}),b=this.totals=new Z8.Component({cls:"totals",
html:this.totalsText()});this.items=[a,b];this.cls=DOM.parseCls(this.cls).pushIf("pager");return this.callParent()},completeRender:function(){this.callParent();this.updateControls();DOM.on(this.pageNumber,"keyDown",this.onKeyDown,this)},onDestroy:function(){DOM.un(this.pageNumber,"keyDown",this.onKeyDown,this);this.setStore(null);this.callParent()},getPage:function(){return null!=this.store?this.store.page:0},count:function(){return null!=this.store?this.store.getCount():0},totalCount:function(){return null!=
this.store?this.store.getTotalCount():0},pageSize:function(){return null!=this.store?this.store.limit:0},pageCount:function(){var a=this.totalCount(),b=this.pageSize();return 0!=b?Math.ceil(a/b):1},pageTotalsText:function(){var a=this.pageCount();return 0!=a?"\u0438\u0437 "+Format.integer(a):""},totalsText:function(){var a=this.totalCount();if(0==a)return"\u041d\u0435\u0442 \u0437\u0430\u043f\u0438\u0441\u0435\u0439";var b=this.getPage(),c=this.pageSize(),b=b*c+1,c=Math.min(b+this.count()-1,a);return Format.integer(b)+
" - "+Format.integer(c)+" \u0438\u0437 "+Format.integer(a)},load:function(a,b){b.setBusy(!0);this.store.loadPage(a,{fn:function(a,d,e){b.setBusy(!1);this.updateControls()},scope:this})},onFirst:function(){this.load(0,this.first)},onPrevious:function(){this.load(Math.max(this.getPage()-1,0),this.previous)},onNext:function(){this.load(Math.min(this.getPage()+1,this.pageCount()-1),this.next)},onLast:function(){this.load(Math.min(this.pageCount()-1),this.last)},onBeforeCount:function(a){},onCount:function(a){this.updateControls()},
updateControls:function(){if(null!=this.dom){var a=this.getPage(),b=this.pageCount();1<b?(this.first.setEnabled(0!=b&&0!=a),this.previous.setEnabled(0!=b&&0!=a),this.next.setEnabled(0!=b&&a!=b-1),this.last.setEnabled(0!=b&&a!=b-1),this.pageNumber.setValue(0!=b?a+1:""),this.pageTotals.setText(this.pageTotalsText()),this.paging.show()):this.paging.hide();this.totals.setText(this.totalsText())}},onKeyDown:function(a,b){if(a.getKey()==Event.ENTER){var c=this.pageNumber.getValue(),c=Math.max(Math.min(c,
this.pageCount()),1)-1;this.load(c,c<this.getPage()?this.previous:this.next);a.stopEvent()}}});Z8.define("Z8.toolbar.Toolbar",{extend:"Z8.Container",cls:"toolbar",initComponent:function(){this.cls=DOM.parseCls(this.cls).pushIf("toolbar");this.callParent()}});
Z8.define("Z8.window.Window",{extend:"Z8.Container",shortClassName:"Window",closable:!0,autoClose:!0,autoDestroy:!0,isOpen:!1,htmlMarkup:function(){var a={tag:"i",cls:DOM.parseCls(this.icon).pushIf("icon","fa","fw-fa").join(" ")},b=this.text={cls:"text",html:this.header},a=[{cls:"dragger",cn:[a,b]}];this.closable&&(b=this.closeButton=new Z8.button.Button({cls:"btn-tool",icon:"fa-close",handler:this.cancel,scope:this}),a.push(b));var a=this.header=new Z8.Container({cls:"header",items:a}),b=this.body=
new Z8.Container({cls:"body",items:this.body}),c=[];if(this.closable){var d=this.cancelButton=new Z8.button.Button({text:"\u041e\u0442\u043c\u0435\u043d\u0430",handler:this.cancel,scope:this});c.push(d)}d=this.okButton=new Z8.button.Button({text:"\u0413\u043e\u0442\u043e\u0432\u043e",primary:!0,handler:this.ok,scope:this});c.push(d);c=this.footer=new Z8.Container({cls:"footer",items:c});this.cls=DOM.parseCls(this.cls).pushIf("window");this.items=[a,b,c];return this.callParent()},onDestroy:function(){this.close();
this.callParent()},open:function(){if(!this.isOpen){this.isOpen=!0;if(null==this.getDom()){var a=Viewport.getBody();a.items.push(this);this.mask=DOM.append(a,{cls:"window-mask"});this.aligner=DOM.append(a,{cls:"window-aligner"});this.render(this.aligner)}else DOM.removeCls(this.mask,"display-none"),DOM.removeCls(this.aligner,"display-none");DOM.on(Viewport,"mouseDown",this.monitorOuterClick,this);DOM.on(this,"keyDown",this.onKeyDown,this);this.focus()}},close:function(){this.isOpen&&(this.isOpen=
!1,DOM.un(Viewport,"mouseDown",this.monitorOuterClick,this),DOM.un(this,"keyDown",this.onKeyDown,this),this.autoDestroy?(Viewport.getBody().items.remove(this),DOM.remove(this.aligner),DOM.remove(this.mask),this.aligner=this.mask=null,this.destroying||this.destroy()):(DOM.addCls(this.mask,"display-none"),DOM.addCls(this.aligner,"display-none")))},monitorOuterClick:function(a){var b=DOM.get(this);a=a.target;b==a||DOM.isParentOf(b,a)||this.cancel()},ok:function(){this.notifyAndClose(!0)},cancel:function(){this.closable&&
this.notifyAndClose(!1)},setBusy:function(a){null!=this.busyButton&&this.busyButton.setBusy(a)},notifyAndClose:function(a){var b=this.busyButton=a?this.okButton:this.cancelButton;this.autoClose||null==b||b.setBusy(!0);null!=this.handler&&this.handler.call(this.scope,this,a);this.autoClose&&this.close()},focus:function(){return this.isEnabled()?this.body.focus()?!0:DOM.focus(this):!1},onKeyDown:function(a,b){var c=a.getKey();c==Event.ESC?(this.cancel(),a.stopEvent()):c==Event.ENTER&&(this.ok(),a.stopEvent())}});
Z8.define("Z8.filter.operator.Model",{extend:"Z8.data.Model",local:!0,idProperty:"id",fields:[new Z8.data.field.String({name:"id"}),new Z8.data.field.String({name:"name"}),new Z8.data.field.String({name:"icon"}),new Z8.data.field.String({name:"type"})]});
Z8.define("Z8.filter.String",{statics:{contains:function(a,b){return null!=a?-1!=a.indexOf(b||""):!1},notContains:function(a,b){return null!=a?-1==a.indexOf(b||""):!1},eq:function(a,b){return null!=a?a.toLowerCase()==(b||"").toLowerCase():!1},notEq:function(a,b){return null!=a?a.toLowerCase()!=(b||"").toLowerCase():!1},gt:function(a,b){return null!=a?a>(b||""):!1},ge:function(a,b){return null!=a?a>=(b||""):!1},lt:function(a,b){return null!=a?a<(b||""):!1},le:function(a,b){return null!=a?a<=(b||""):
!1},beginsWith:function(a,b){return null!=a?a.startsWith(b||""):!1},notBeginsWith:function(a,b){return null!=a?!a.startsWith(b||""):!1},endsWith:function(a,b){return null!=a?a.endsWith(b||""):!1},notEndsWith:function(a,b){return null!=a?!a.endsWith(b||""):!1},isEmpty:function(a){return Z8.isEmpty(a)},isNotEmpty:function(a){return!Z8.isEmpty(a)}}});
Z8.define("Z8.filter.Number",{statics:{eq:function(a,b){return a==b},notEq:function(a,b){return number!=b},gt:function(a,b){return number>b},ge:function(a,b){return number>=b},lt:function(a,b){return number<b},le:function(a,b){return number<=b}}});
Z8.define("Z8.filter.Operator",{shortClassName:"Operator",statics:{data:{"boolean":[{id:Operation.isTrue,name:"\u0434\u0430",icon:"fa-dot-circle-o"},{id:Operation.isFalse,name:"\u043d\u0435\u0442",icon:"fa-circle-o"}],datetime:[{id:Operation.GT,name:"\u043f\u043e\u0441\u043b\u0435",icon:"fa-math-gt",type:Type.Datetime},{id:Operation.GE,name:"\u043d\u0435 \u0440\u0430\u043d\u0435\u0435",icon:"fa-math-ge",type:Type.Datetime},{id:Operation.LT,name:"\u0434\u043e",icon:"fa-math-lt",type:Type.Datetime},
{id:Operation.LE,name:"\u043d\u0435 \u043f\u043e\u0437\u0436\u0435",icon:"fa-math-le",type:Type.Datetime},{id:Operation.Yesterday,name:"\u0432\u0447\u0435\u0440\u0430"},{id:Operation.Today,name:"\u0441\u0435\u0433\u043e\u0434\u043d\u044f"},{id:Operation.Tomorrow,name:"\u0437\u0430\u0432\u0442\u0440\u0430"},{id:Operation.LastWeek,name:"\u043f\u0440\u043e\u0448\u043b\u0430\u044f \u043d\u0435\u0434\u0435\u043b\u044f"},{id:Operation.ThisWeek,name:"\u0442\u0435\u043a\u0443\u0449\u0430\u044f \u043d\u0435\u0434\u0435\u043b\u044f"},
{id:Operation.NextWeek,name:"\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u043d\u0435\u0434\u0435\u043b\u044f"},{id:Operation.LastMonth,name:"\u043f\u0440\u043e\u0448\u043b\u044b\u0439 \u043c\u0435\u0441\u044f\u0446"},{id:Operation.ThisMonth,name:"\u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043c\u0435\u0441\u044f\u0446"},{id:Operation.NextMonth,name:"\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u043c\u0435\u0441\u044f\u0446"},{id:Operation.LastYear,name:"\u043f\u0440\u043e\u0448\u043b\u044b\u0439 \u0433\u043e\u0434"},
{id:Operation.ThisYear,name:"\u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434"},{id:Operation.NextYear,name:"\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0433\u043e\u0434"},{id:Operation.LastDays,name:"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 X \u0434\u043d\u0435\u0439",type:Type.Integer},{id:Operation.NextDays,name:"\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 X \u0434\u043d\u0435\u0439",type:Type.Integer},{id:Operation.LastHours,name:"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 X \u0447\u0430\u0441\u043e\u0432",
type:Type.Integer},{id:Operation.NextHours,name:"\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 X \u0447\u0430\u0441\u043e\u0432",type:Type.Integer}],date:[{id:Operation.Eq,name:"\u0440\u0430\u0432\u043d\u043e",icon:"fa-math-eq",type:Type.Date},{id:Operation.NotEq,name:"\u043d\u0435 \u0440\u0430\u0432\u043d\u043e",icon:"fa-math-not-eq",type:Type.Date},{id:Operation.GT,name:"\u043f\u043e\u0441\u043b\u0435",icon:"fa-math-gt",type:Type.Date},{id:Operation.GE,name:"\u043d\u0435 \u0440\u0430\u043d\u0435\u0435",
icon:"fa-math-ge",type:Type.Date},{id:Operation.LT,name:"\u0434\u043e",icon:"fa-math-lt",type:Type.Date},{id:Operation.LE,name:"\u043d\u0435 \u043f\u043e\u0437\u0436\u0435",icon:"fa-math-le",type:Type.Date},{id:Operation.Yesterday,name:"\u0432\u0447\u0435\u0440\u0430"},{id:Operation.Today,name:"\u0441\u0435\u0433\u043e\u0434\u043d\u044f"},{id:Operation.Tomorrow,name:"\u0437\u0430\u0432\u0442\u0440\u0430"},{id:Operation.LastWeek,name:"\u043f\u0440\u043e\u0448\u043b\u0430\u044f \u043d\u0435\u0434\u0435\u043b\u044f"},
{id:Operation.ThisWeek,name:"\u0442\u0435\u043a\u0443\u0449\u0430\u044f \u043d\u0435\u0434\u0435\u043b\u044f"},{id:Operation.NextWeek,name:"\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u043d\u0435\u0434\u0435\u043b\u044f"},{id:Operation.LastMonth,name:"\u043f\u0440\u043e\u0448\u043b\u044b\u0439 \u043c\u0435\u0441\u044f\u0446"},{id:Operation.ThisMonth,name:"\u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043c\u0435\u0441\u044f\u0446"},{id:Operation.NextMonth,name:"\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u043c\u0435\u0441\u044f\u0446"},
{id:Operation.LastYear,name:"\u043f\u0440\u043e\u0448\u043b\u044b\u0439 \u0433\u043e\u0434"},{id:Operation.ThisYear,name:"\u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434"},{id:Operation.NextYear,name:"\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0433\u043e\u0434"},{id:Operation.LastDays,name:"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 X \u0434\u043d\u0435\u0439",type:Type.Integer},{id:Operation.NextDays,name:"\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 X \u0434\u043d\u0435\u0439",
type:Type.Integer},{id:Operation.LastHours,name:"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 X \u0447\u0430\u0441\u043e\u0432",type:Type.Integer},{id:Operation.NextHours,name:"\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 X \u0447\u0430\u0441\u043e\u0432",type:Type.Integer}],integer:[{id:Operation.Eq,name:"\u0440\u0430\u0432\u043d\u043e",icon:"fa-math-eq",type:Type.Integer},{id:Operation.NotEq,name:"\u043d\u0435 \u0440\u0430\u0432\u043d\u043e",icon:"fa-math-not-eq",type:Type.Integer},
{id:Operation.GT,name:"\u0431\u043e\u043b\u044c\u0448\u0435",icon:"fa-math-gt",type:Type.Integer},{id:Operation.GE,name:"\u043d\u0435 \u043c\u0435\u043d\u044c\u0448\u0435",icon:"fa-math-ge",type:Type.Integer},{id:Operation.LT,name:"\u043c\u0435\u043d\u044c\u0448\u0435",icon:"fa-math-lt",type:Type.Integer},{id:Operation.LE,name:"\u043d\u0435 \u0431\u043e\u043b\u044c\u0448\u0435",icon:"fa-math-le",type:Type.Integer}],"float":[{id:Operation.Eq,name:"\u0440\u0430\u0432\u043d\u043e",icon:"fa-math-eq",
type:Type.Float},{id:Operation.NotEq,name:"\u043d\u0435 \u0440\u0430\u0432\u043d\u043e",icon:"fa-math-not-eq",type:Type.Float},{id:Operation.GT,name:"\u0431\u043e\u043b\u044c\u0448\u0435",icon:"fa-math-gt",type:Type.Float},{id:Operation.GE,name:"\u043d\u0435 \u043c\u0435\u043d\u044c\u0448\u0435",icon:"fa-math-ge",type:Type.Float},{id:Operation.LT,name:"\u043c\u0435\u043d\u044c\u0448\u0435",icon:"fa-math-lt",type:Type.Float},{id:Operation.LE,name:"\u043d\u0435 \u0431\u043e\u043b\u044c\u0448\u0435",
icon:"fa-math-le",type:Type.Float}],string:[{id:Operation.Contains,name:"\u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442",icon:"fa-superset-of",type:Type.String,filter:Z8.filter.String.contains},{id:Operation.NotContains,name:"\u043d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442",icon:"fa-not-superset-of",type:Type.String,filter:Z8.filter.String.notContains},{id:Operation.Eq,name:"\u0440\u0430\u0432\u043d\u043e",icon:"fa-math-eq",type:Type.String,filter:Z8.filter.String.eq},{id:Operation.NotEq,
name:"\u043d\u0435 \u0440\u0430\u0432\u043d\u043e",icon:"fa-math-not-eq",type:Type.String,filter:Z8.filter.String.notEq},{id:Operation.GT,name:"\u0431\u043e\u043b\u044c\u0448\u0435",icon:"fa-math-gt",type:Type.String},{id:Operation.GE,name:"\u0431\u043e\u043b\u044c\u0448\u0435 \u0438\u043b\u0438 \u0440\u0430\u0432\u043d\u043e",icon:"fa-math-ge",type:Type.String},{id:Operation.LT,name:"\u043c\u0435\u043d\u044c\u0448\u0435",icon:"fa-math-lt",type:Type.String},{id:Operation.LE,name:"\u043c\u0435\u043d\u044c\u0448\u0435 \u0438\u043b\u0438 \u0440\u0430\u0432\u043d\u043e",
icon:"fa-math-le",type:Type.String},{id:Operation.BeginsWith,name:"\u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u0441",type:Type.String},{id:Operation.NotBeginsWith,name:"\u043d\u0435 \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u0441",type:Type.String},{id:Operation.EndsWith,name:"\u043e\u043a\u0430\u043d\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430",type:Type.String},{id:Operation.NotEndsWith,name:"\u043d\u0435 \u043e\u043a\u0430\u043d\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430",
type:Type.String},{id:Operation.IsEmpty,name:"\u043f\u0443\u0441\u0442\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430"},{id:Operation.IsNotEmpty,name:"\u043d\u0435\u043f\u0443\u0441\u0442\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430"}]},filters:null,fields:["id","name","icon","type"],getOperators:function(a){switch(a){case Type.String:case Type.Text:case Type.Guid:return null==this.string&&(this.string=new Z8.data.Store({model:"Z8.filter.operator.Model",data:this.data.string}),this.string.use()),
this.string;case Type.Boolean:return null==this["boolean"]&&(this["boolean"]=new Z8.data.Store({model:"Z8.filter.operator.Model",data:this.data["boolean"]}),this["boolean"].use()),this["boolean"];case Type.Date:return null==this.date&&(this.date=new Z8.data.Store({model:"Z8.filter.operator.Model",data:this.data.date}),this.date.use()),this.date;case Type.Datetime:return null==this.datetime&&(this.datetime=new Z8.data.Store({model:"Z8.filter.operator.Model",data:this.data.datetime}),this.datetime.use()),
this.datetime;case Type.Integer:return null==this.integer&&(this.integer=new Z8.data.Store({model:"Z8.filter.operator.Model",data:this.data.integer}),this.integer.use()),this.integer;case Type.Float:return null==this["float"]&&(this["float"]=new Z8.data.Store({model:"Z8.filter.operator.Model",data:this.data["float"]}),this["float"].use()),this["float"];default:throw"Unknown type: "+a;}},getFilters:function(){if(null!=this.filters)return this.filters;var a=this.filters={};a.string=this.getStringFilters();
a.integer=this.getNumberFilters();a["float"]=this.getNumberFilters();return a},getStringFilters:function(){var a={};a[Operation.Contains]=Z8.filter.String.contains;a[Operation.NotContains]=Z8.filter.String.notContains;a[Operation.Eq]=Z8.filter.String.eq;a[Operation.NotEq]=Z8.filter.String.notEq;a[Operation.GT]=Z8.filter.String.gt;a[Operation.GE]=Z8.filter.String.ge;a[Operation.LT]=Z8.filter.String.lt;a[Operation.LE]=Z8.filter.String.le;a[Operation.Eq]=Z8.filter.String.eq;a[Operation.BeginsWith]=Z8.filter.String.beginsWidth;
a[Operation.NotBeginsWith]=Z8.filter.String.notBeginsWidth;a[Operation.EndsWith]=Z8.filter.String.endsWidth;a[Operation.NotEndsWith]=Z8.filter.String.notEndsWidth;a[Operation.IsEmpty]=Z8.filter.String.isEmpty;a[Operation.IsNotEmpty]=Z8.filter.String.isNotEmpty;return a},getNumberFilters:function(){var a={};a[Operation.Eq]=Z8.filter.Number.eq;a[Operation.NotEq]=Z8.filter.Number.notEq;a[Operation.GT]=Z8.filter.Number.gt;a[Operation.GE]=Z8.filter.Number.ge;a[Operation.LT]=Z8.filter.Number.lt;a[Operation.LE]=
Z8.filter.Number.le;a[Operation.Eq]=Z8.filter.Number.eq;return a},applyFilter:function(a,b){var c=b.property,d=b.operator,e=b.value;if(Z8.isEmpty(c)||Z8.isEmpty(d))return!0;var f=a.getField(c);if(null==f)return!0;var g=f.getType(),g=this.getFilters()[g];if(null==g)return!0;d=g[d];return null!=d?d(a.get(c),f.convert(e)):!0}}});
Z8.define("Z8.filter.Element",{extend:"Z8.Container",toggle:function(a){DOM.swapCls(this,a,"active");if(!this.blockChildToggle)this.onChildToggle(a,this)},onChildChange:function(a){this.container.onChildChange(a)},onChildToggle:function(a,b){this.container.onChildToggle(a,b)},onContainerToggle:function(a,b){if(this.container!=b||this==b)this.blockChildToggle=!0,this.toggle(!1),delete this.blockChildToggle},isSelected:function(){return!1},getSelection:function(){return[]},getFields:function(){return this.fields||
(this.fields=this.container.getFields())}});
Z8.define("Z8.filter.Line",{extend:"Z8.filter.Element",cls:"line",htmlMarkup:function(){var a=this.checkbox=new Z8.form.field.Checkbox;a.on("change",this.onChecked,this);var b=this.expression||{},c=this.getFields(),d=c.getById(b.property),e=this.property=new Z8.form.field.Combobox({store:c,value:b.property,emptyValue:"",fields:[{name:"name",header:"\u041f\u043e\u043b\u0435",icon:"fa-tag",sortable:!1,width:200},{name:"type",header:"\u0422\u0438\u043f",icon:"fa-code",sortable:!1,width:100},{name:"description",
header:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",icon:"fa-file-text-o",sortable:!1,width:400}],required:!0,filters:!1,cls:"property",placeholder:"\u041f\u043e\u043b\u0435",icons:!0});e.on("change",this.propertyChanged,this);d=null!=d?d.get("type"):null;c=null!=d?Operator.getOperators(d):null;d=null!=c?c.getById(b.operator):null;c=this.operator=new Z8.form.field.Combobox({store:c,value:b.operator,emptyValue:"",cls:"operator",required:!0,filters:!1,placeholder:"\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u044f"});
c.on("change",this.operatorChanged,this);d=null!=d?d.get("type"):null;b=this.value=this.getValueEditor(d,b.value);this.items=[a,e,c,b];return this.callParent()},focus:function(){return this.isEnabled()?this.property.focus():!1},isSelected:function(){return this.checkbox.getValue()},onChecked:function(a,b,c){this.toggle(b)},toggle:function(a){this.checkbox.initValue(a);this.callParent(a)},getValueEditor:function(a,b){var c=this.value;if(null!=c&&c.type==a)return c;c=this.createValueEditor(a||null,
b);c.on("change",this.valueChanged,this);c.type=a;return c},createValueEditor:function(a,b){switch(a){case null:return new Z8.Component({cls:"value hidden"});case Type.String:case Type.Text:return new Z8.form.field.Text({value:b,cls:"value",placeholder:"\u0442\u0435\u043a\u0441\u0442",required:!0});case Type.Date:return new Z8.form.field.Date({value:b,cls:"value",placeholder:"\u0434\u0430\u0442\u0430",required:!0});case Type.Datetime:return new Z8.form.field.Datetime({value:b,cls:"value",placeholder:"\u0432\u0440\u0435\u043c\u044f",
required:!0});case Type.Integer:return new Z8.form.field.Integer({value:b,cls:"value",placeholder:"0 000",required:!0});case Type.Float:return new Z8.form.field.Float({value:b,cls:"value",placeholder:"0 000,00",required:!0});default:throw"Unsupported type: "+a;}},propertyChanged:function(a,b,c){a=a.store.getById(b);a=null!=a?a.get("type"):null;a=null!=a?Operator.getOperators(a):null;this.operator.setStore(a);this.operator.setValue(this.emptyValue,"");this.onChildChange(this)},operatorChanged:function(a,
b,c){a=a.store;b=null!=a?a.getById(b):null;b=null!=b?b.get("type"):null;b=this.getValueEditor(b);b!=this.value&&(this.remove(this.value),this.value=b,this.add(this.value));this.onChildChange(this)},valueChanged:function(a,b,c){this.onChildChange(this)},getExpression:function(){var a=this.property.getValue();if(Z8.isEmpty(a))return{};var b=this.operator.getValue();if(Z8.isEmpty(b))return{property:a};var c=this.value instanceof Z8.form.field.Control?this.value.getValue():null;return{property:a,operator:b,
value:c||void 0}},getExpressionText:function(){var a=this.property.getDisplayValue();if(Z8.isEmpty(a))return null;var b=this.operator.getDisplayValue();if(Z8.isEmpty(b))return null;var c=this.value instanceof Z8.form.field.Control,d=c?this.value.getRawValue()||"":null;return"'"+a+"' "+b+(c?" '"+d+"'":"")}});
Z8.define("Z8.filter.Group",{extend:"Z8.filter.Element",button:!0,isGroup:!0,logical:"or",initComponent:function(){this.cls=DOM.parseCls(this.cls).pushIf("group");this.initExpression(this.expression);this.callParent()},initExpression:function(a){a=this.expression=a||{logical:this.logical,expressions:[]};this.logical=a.logical},getExpression:function(){for(var a={logical:this.logical,expressions:[]},b=this.getLines(),c=0,d=b.length;c<d;c++)expression=b[c].getExpression(),null!=expression&&a.expressions.push(expression);
return 0!=a.expressions.length?a:null},setExpression:function(a){this.removeAll();this.initExpression(a);this.add(this.createItems())},createItems:function(){var a=[],b=this.expression;if(this.button){var c=[new Z8.menu.Item({text:"\u041d\u043e\u0432\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430",icon:"fa-plus",handler:this.onNewLine}),new Z8.menu.Item({text:"\u0420\u0430\u0437\u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c",icon:"fa-unlink",handler:this.onUngroup}),new Z8.menu.Item({text:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0438/\u0438\u043b\u0438",
icon:"fa-exchange",handler:this.onChangeAndOr}),"-"],d=this.deleteItem=new Z8.menu.Item({text:"Delete",icon:"fa-trash",handler:this.onDeleteLine});c.push(d);c=new Z8.menu.Menu({items:c});c.on("itemClick",function(a,b){b.handler.call(this)},this);c=this.button=new Z8.button.Button({icon:"fa-square-o",text:this.getOperatorText(),toggled:!1,menu:c,vertical:!0});c.on("toggle",this.onToggle,this);a.push(c)}for(var c=b.expressions||[],d=0,e=c.length;d<e;d++)b=c[d],b=null!=b.logical?new Z8.filter.Group({expression:b}):
new Z8.filter.Line({expression:b}),a.push(b);return a},htmlMarkup:function(){this.items=this.createItems();return this.callParent()},getLines:function(){return this.button?this.items.slice(1):this.items},getCount:function(){return this.items.length-this.button?1:0},focus:function(){if(!this.isEnabled())return!1;var a=this.getLines();return 0!=a.length?a[0].focus():!1},getSelection:function(){for(var a=[],b=this.getLines(),c=0,d=b.length;c<d;c++){var e=b[c];e.isSelected()&&a.push(e)}return a},isSelected:function(){return this.button?
this.button.toggled:!1},onToggle:function(a,b){this.toggle(b)},toggle:function(a){this.button&&(this.button.setToggled(a,!0),this.button.setIcon(a?"fa-check-square":"fa-square-o"));this.callParent(a)},onContainerToggle:function(a,b){this.callParent(a,b);for(var c=this.getLines(),d=0,e=c.length;d<e;d++)c[d].onContainerToggle(a,b)},onChildToggle:function(a,b){this.callParent(a,b);this.deleteItem.setEnabled(0!=this.getSelection().length)},onNewLine:function(){this.newLine()},onUngroup:function(){this.ungroup()},
onChangeAndOr:function(){this.changeAndOr()},onDeleteLine:function(){this.removeLine(this.getSelection())},newLine:function(){var a=new Z8.filter.Line;this.add(a);a.focus();this.onChildChange(this)},removeLine:function(a){a=Array.isArray(a)?a:[a];for(var b=0,c=a.length;b<c;b++)this.remove(a[b]);a=this.getLines();0==a.length?(a=this.container,a instanceof Z8.filter.Element&&a.removeLine(this)):1==a.length&&this.button&&this.ungroup();this.onChildChange(this)},group:function(a){this.add(new Z8.filter.Group,
this.indexOf(a[0])).add(a);this.onChildChange(this)},ungroup:function(){var a=this.container.indexOf(this),b=this.getLines();this.container.add(b,a);this.container.remove(this);this.onChildChange(this)},changeAndOr:function(){this.logical="or"==this.logical?"and":"or";this.button.setText(this.getOperatorText());this.onChildChange(this)},getOperatorText:function(){return"or"==this.logical?"\u0438\u043b\u0438":"\u0438"},getExpressionText:function(){for(var a=[],b=this.getLines(),c=0,d=b.length;c<d;c++){var e=
b[c],f=e.getExpressionText();null!=f&&a.push({parenthesis:e.isGroup&&"and"==this.logical&&"or"==e.logical,text:f})}if(0==a.length)return null;if(1==a.length)return a[0].text;f="";b=this.getOperatorText();c=0;for(d=a.length;c<d;c++)e=a[c],e=e.parenthesis?"("+e.text+")":e.text,f+=(""!=f?" "+b+" ":"")+e;return f}});
Z8.define("Z8.filter.fields.Model",{extend:"Z8.data.Model",local:!0,idProperty:"id",fields:[new Z8.data.field.String({name:"id"}),new Z8.data.field.String({name:"name"}),new Z8.data.field.String({name:"icon"}),new Z8.data.field.String({name:"type"}),new Z8.data.field.String({name:"description"})]});
Z8.define("Z8.filter.Expression",{extend:"Z8.filter.Group",button:!1,logical:"and",htmlMarkup:function(){this.cls=DOM.parseCls(this.cls).pushIf("expression");this.expression=this.expression||{logical:"and",expressions:[]};return this.callParent()},onDestroy:function(){var a=this.fields;null!=a&&a.isStore&&(a.dispose(),this.fields=null);this.callParent()},getFields:function(){var a=this.fields||[];if(!Array.isArray(a))return this.fields;for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];e.isPrimaryKey||
e.isParentKey||e.isLink||b.push({id:e.name,name:e.header||e.name,icon:e.icon,type:e.type,description:e.descripton})}a=this.fields=new Z8.data.Store({model:"Z8.filter.fields.Model",data:b});a.use();return a},onChildToggle:function(a,b){this.onContainerToggle(a,b.container);this.fireEvent("select",this.getSelection(),this)},onChildChange:function(a){this.fireEvent("change",this.getExpression(),this)},getSelection:function(){var a=this.callParent();return 0!=a.length?a:this.getSelectedLines(this.getLines())},
getSelectedLines:function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];if(e.isSelected())b.push(e);else if(e instanceof Z8.filter.Group&&(e=this.getSelectedLines(e.getLines()),0!=e.length))return e}return b}});
Z8.define("Z8.filter.Button",{extend:"Z8.button.Button",toggle:!0,icon:"fa-filter",tooltip:"\u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f",triggerTooltip:"\u041d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044e",filter:null,fields:null,htmlMarkup:function(){this.filterItems=[];this.on("toggle",this.onToggle,this);var a=[new Z8.menu.Item({text:"\u041d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c",icon:"fa-filter"})];(this.menu=
new Z8.menu.Menu({items:a})).on("itemClick",this.onMenuItemClick,this);this.init();return this.callParent()},init:function(){var a=this.filter,b=a.current;this.setText(a.current);this.setToggled(a.isActive(),!0);var c=this.menu,d=this.filterItems;c.removeItems(d);for(var d=this.filterItems=[],a=a.getNames(),e=0,f=a.length;e<f;e++){var g=a[e],h=g==b,g=new Z8.menu.Item({text:g,filter:g,icon:h?"fa-check-square":""});h&&(this.currentItem=g);d.add(g)}0!=d.length&&d.add(new Z8.list.Divider);c.addItems(d,
0)},setFilter:function(a){this.filter=a;this.init()},onMenuItemClick:function(a,b){var c=b.filter;if(null!=c){var d=this.filter;d.setCurrent(c);d.setActive(!0);null!=this.currentItem&&this.currentItem.setIcon("");b.setIcon("fa-check-square");this.currentItem=b;this.setText(c);this.setToggled(!0,!0);this.fireEvent("filter",this,d,Filter.Apply)}else this.onSettings()},onSettings:function(){(new Z8.filter.Dialog({cls:"air",header:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u0438",
icon:"fa-filter",fields:this.fields,filter:this.filter,handler:function(a,b){if(b){var c=a.getFilter();this.setFilter(c);this.fireEvent("filter",this,c,Filter.Apply)}else this.fireEvent("filter",this,this.filter,Filter.NoAction)},scope:this})).open()},onToggle:function(a,b){var c=this.filter;b&&c.isEmpty()?(this.setToggled(!1,!0),this.onSettings()):(c.setActive(b),this.fireEvent("filter",this,c,b?Filter.Apply:Filter.Clear))}});
Z8.define("Z8.filter.Model",{extend:"Z8.data.Model",local:!0,idProperty:"name",fields:[new Z8.data.field.String({name:"name",header:"\u0424\u0438\u043b\u044c\u0442\u0440",editable:!0}),new Z8.data.field.Json({name:"filter"})]});
Z8.define("Z8.filter.Editor",{extend:"Z8.Container",cls:"filter-editor",htmlMarkup:function(){var a=this.store=new Z8.data.Store({model:"Z8.filter.Model",data:this.filter.toStoreData()});a.use();var b=this.addTool=new Z8.button.Button({cls:"btn-sm",icon:"fa-file-o",tooltip:"\u041d\u043e\u0432\u044b\u0439 \u0444\u0438\u043b\u044c\u0442\u0440",handler:this.onAddFilter,scope:this}),c=this.copyTool=new Z8.button.Tool({icon:"fa-copy",tooltip:"\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c (Shift+Insert)",
handler:this.onCopyFilter,scope:this}),d=this.removeTool=new Z8.button.Button({cls:"btn-sm remove",danger:!0,icon:"fa-trash",tooltip:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440(\u044b)",handler:this.onRemoveFilter,scope:this}),e={text:"\u0424\u0438\u043b\u044c\u0442\u0440\u044b",icon:"fa-filter",tools:new Z8.button.Group({items:[b,c,d]})},a=this.filters=new Z8.form.field.Listbox({store:a,cls:"filters",fields:[a.getField("name")],label:e,editable:!0});a.on("select",
this.onFiltersSelect,this);a.on("itemEditorChange",this.onItemEditorChange,this);a.setAddTool(b);a.setRemoveTool(d);a.setCopyTool(c);b=this.expression=new Z8.form.field.Filter({fields:this.fields,enabled:!1,label:{text:"\u0412\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435",icon:"fa-list-ul"}});b.on("change",this.expressionChanged,this);c=this.expressionText=new Z8.form.field.Html({cls:"text",label:{text:"\u0422\u0435\u043a\u0441\u0442",icon:"fa-code"}});b=new Z8.Container({cls:"filter",items:[b,
c]});this.items=[a,b];return this.callParent()},completeRender:function(){this.callParent();this.updateTools()},onDestroy:function(){null!=this.store&&(this.store.dispose(),this.store=null);this.callParent()},getChecked:function(){return this.filters.getChecked()},getSelection:function(){return this.filters.getSelection()},updateTools:function(){var a=this.getChecked();this.removeTool.setEnabled(0!=a.length);a=this.getSelection();this.copyTool.setEnabled(null!=a)},getFilter:function(){var a=this.filter;
a.clear();for(var b=this.store.getRecords(),c=0,d=b.length;c<d;c++){var e=b[c];a.add(e.id,e.get("filter"))}e=this.getSelection();a.setActive(null!=e);a.setCurrent(null!=e?e.id:null);return a},onFiltersSelect:function(a,b){var c=this.expression,d=this.expressionText;c.setEnabled(null!=b);d.setEnabled(null!=b);var e=null!=b?b.get("filter"):null;e!=c.getValue()&&(c.initValue(e),d.initValue(c.getExpressionText()));this.updateTools()},onItemEditorChange:function(a,b,c,d){a=b.record;d=this.store.getRecords();
for(var e=0,f=d.length;e<f;e++){var g=d[e];if(g!=a&&c==g.get("name")){b.setValid(!1);return}}b.setValid(!0)},expressionChanged:function(a,b,c){this.getSelection().set("filter",this.expression.getExpression());this.expressionText.setValue(this.expression.getExpressionText())},onAddFilter:function(a){a=this.newFilterName();a=new Z8.filter.Model({name:a,filter:null});this.store.add(a);var b=this.filters;b.select(a);b.startEdit(a,0)||b.focus()},onCopyFilter:function(a){a=this.getSelection();var b=this.newFilterName(a.id);
a=JSON.decode(JSON.encode(a.get("filter")));a=new Z8.filter.Model({name:b,filter:a});this.store.add(a);b=this.filters;b.select(a);b.startEdit(a,0)||b.focus()},onRemoveFilter:function(a){var b=this.filters.getChecked();if(0==b.length)throw"records.length == 0";var c=this.store;a=c.indexOf(b[0]);c.remove(b);b=this.filters;b.select(a);b.focus()},newFilterName:function(a){a=(a||"\u0424\u0438\u043b\u044c\u0442\u0440")+" ";for(var b=this.store.getOrdinals(),c=1;;){var d=a+c;if(null==b[d])return d;c++}}});
Z8.define("Z8.filter.Dialog",{extend:"Z8.window.Window",htmlMarkup:function(){this.body=[this.editor=new Z8.filter.Editor({filter:this.filter,fields:this.fields})];return this.callParent()},getFilter:function(){return this.editor.getFilter()}});
Z8.define("Z8.application.sidebar.Item",{extend:"Z8.Component",subcomponents:function(){return[this.menu]},htmlMarkup:function(){var a=this.data,b=[{tag:"i",cls:DOM.parseCls(a.icon).pushIf("fa","icon").join(" "),html:String.htmlText()},{tag:"span",cls:"text",html:a.text}],a=a.items;Z8.isEmpty(a)||(b.push({tag:"i",cls:"fa fa-chevron-right chevron"}),a=this.menu=new Z8.application.sidebar.Menu({data:a,parent:this}),b.push(a.htmlMarkup()));return{id:this.getId(),cls:"item",tabIndex:this.getTabIndex(),
cn:b}},completeRender:function(){DOM.on(this,"mouseOver",this.onMouseOver,this);this.callParent()},onDestroy:function(){DOM.un(this,"mouseOver",this.onMouseOver,this);this.callParent()},activate:function(){this.showMenu();DOM.addCls(this,"active");DOM.setTabIndex(this,0);this.focus()},deactivate:function(){DOM.removeCls(this,"active");DOM.setTabIndex(this,-1);null!=this.menu&&this.menu.deactivate()},showMenu:function(){null!=this.menu&&this.menu.show()},hideMenu:function(){null!=this.menu&&this.menu.hide()},
onMouseOver:function(a,b){var c=this.parent;c.onBeforeActivateItem(this);this.activate(!0);c.onAfterActivateItem(this);a.stopEvent()}});
Z8.define("Z8.application.sidebar.Menu",{extend:"Z8.Container",cls:"submenu",closeOnMouseOut:!0,closeOnBlur:!0,htmlMarkup:function(){for(var a=this.items,b=this.menuItems=[],c=this.data,d=0,e=c.length;d<e;d++){var f=new Z8.application.sidebar.Item({data:c[d],parent:this});a.push(f);b.push(f)}return this.callParent()},completeRender:function(){this.callParent();DOM.on(this,"keyDown",this.onKeyDown,this);DOM.on(this,"click",this.onClick,this)},onDestroy:function(){DOM.un(this,"keyDown",this.onKeyDown,
this);DOM.un(this,"click",this.onClick,this);this.callParent()},getTopLevelParent:function(){for(var a=this;null!=a;){var b=a.parent;if(null==b)return a;a=b}},onBeforeActivateItem:function(a){this.activate(a)},onAfterActivateItem:function(a){},deactivate:function(){var a=this.active;null!=a&&(a.deactivate(),delete this.active)},activate:function(a){a=a||this.menuItems[0];this.active!=a&&(this.deactivate(),this.active=a,null!=a&&a.activate())},hide:function(){this.deactivate();this.callParent()},onClick:function(a,
b){var c=this.active,d=DOM.get(c);if((d==b||DOM.isParentOf(d,b))&&null!=c.data.id)this.getTopLevelParent().onSelectItem(c)},onKeyDown:function(a,b){var c=this.menuItems,d=this.active,e=this.parent,f=a.getKey();if(f==Event.DOWN||f==Event.UP)d=c.indexOf(d),d=f==Event.DOWN?-1!=d&&d<c.length-1?d+1:0:-1!=d&&0<d?d-1:c.length-1,this.activate(c[d]),a.stopEvent();else if(f==Event.LEFT&&null!=e)this.getTopLevelParent().closeOnMouseOut=!1,e.activate(),e.hideMenu(),a.stopEvent();else if(f==Event.RIGHT&&null!=
d&&null!=d.menu)d.showMenu(),d.menu.activate(),a.stopEvent();else if(f==Event.ENTER&&null!=d&&null!=d.data.id)this.getTopLevelParent().onSelectItem(d)},onSelectItem:function(a){}});
Z8.define("Z8.application.sidebar.Sidebar",{extend:"Z8.application.sidebar.Menu",cls:"menu",tabIndex:0,isOpen:!1,htmlMarkup:function(){this.itemIndex={};this.data=JSON.decode(JSON.encode(User.data));this.items=[{tag:"i",cls:"handle fa fa-angle-right"},{cls:"logo"}];return this.callParent()},completeRender:function(){this.callParent();DOM.on(this,"focus",this.onFocus,this,!0);DOM.on(this,"blur",this.onBlur,this,!0);DOM.on(this,"mouseOver",this.onMouseOver,this);DOM.on(this,"mouseOut",this.onMouseOut,
this)},onDestroy:function(){DOM.un(this,"focus",this.onFocus,this,!0);DOM.un(this,"blur",this.onBlur,this,!0);DOM.un(this,"mouseOver",this.onMouseOver,this);DOM.un(this,"mouseOut",this.onMouseOut,this);DOM.un(document.body,"mouseDown",this.monitorOuterClick,this);this.callParent()},setEnabled:function(a){DOM.swapCls(this,!a,"disabled");this.callParent(a)},open:function(){this.isOpen||(DOM.addCls(this,"open",10),this.isOpen=!0,this.focus(),DOM.on(document.body,"mouseDown",this.monitorOuterClick,this),
this.fireEvent("open",this))},close:function(){this.isOpen&&(this.deactivate(),DOM.un(document.body,"mouseDown",this.monitorOuterClick,this),DOM.removeCls(this,"open"),DOM.setCssText(this,"",100),this.isOpen=!1,this.fireEvent("close",this))},toggle:function(){this.isOpen?this.close():this.open()},monitorOuterClick:function(a){this.isInnerElement(a.target)||this.close()},onSelectItem:function(a){this.close();Z8.callback(this.handler,this.scope,a.data)},onFocus:function(a,b){this.open()},isInnerElement:function(a){return DOM.isParentOf(this,
a)||DOM.isParentOf(this.owner,a)},onBlur:function(a,b){this.closeOnBlur&&!DOM.isParentOf(this,a.relatedTarget)&&this.close()},onMouseOver:function(a,b){this.isOpen||this.open()},onMouseOut:function(a,b){b=a.relatedTarget;this.closeOnMouseOut&&null!=b&&!this.isInnerElement(b)&&this.close();this.closeOnMouseOut=!0},onKeyDown:function(a,b){a.getKey()==Event.ESC?(this.close(),a.stopEvent()):this.callParent(a,b)}});
Z8.define("Z8.application.viewport.Login",{extend:"Z8.form.Fieldset",plain:!0,initComponent:function(){this.cls=DOM.parseCls(this.cls).pushIf("login","air","display-none");var a=this.loginField=new Z8.form.field.Text({label:{text:"\u041b\u043e\u0433\u0438\u043d",icon:"fa-user",width:80,align:"left"},placeholder:"\u041b\u043e\u0433\u0438\u043d",value:"Admin"}),b=this.passwordField=new Z8.form.field.Text({label:{text:"\u041f\u0430\u0440\u043e\u043b\u044c",icon:"fa-key",align:"left",width:80},placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",
password:!0}),c=this.loginButton=new Z8.button.Button({cls:"btn-tool",icon:"fa-check",handler:this.login,scope:this});this.controls=[{cls:"header",html:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f"},a,b,c];this.callParent()},completeRender:function(){this.callParent();DOM.on(this,"keydown",this.onKeyDown,this)},onDestroy:function(){DOM.un(this,"keydown",this.onKeyDown,this);this.callParent()},focus:function(){this.loginField.focus()},show:function(){this.visible?this.focus():
(this.visible=!0,this.mask=DOM.append(Viewport.getBody(),{cls:"window-mask login"}),DOM.removeCls(this,"display-none"),DOM.addCls(this,"open",100),this.focus(),this.fireEvent("show",this))},hide:function(){this.visible&&(this.visible=!1,DOM.remove(this.mask),this.mask=null,DOM.removeCls(this,"open"),DOM.addCls(this,"display-none",200),this.passwordField.setValue(""),this.fireEvent("hide",this))},login:function(a){a.setBusy(!0);var b={login:this.loginField.getValue(),password:MD5.hex(this.passwordField.getValue()||
""),experimental:!0};HttpRequest.send(b,{fn:function(b,d){a.setBusy(!1);d?(Z8.callback(this.handler,this.scope,b),this.hide()):this.loginField.focus()},scope:this})},onKeyDown:function(a,b){a.getKey()==Event.ENTER&&this.login(this.loginButton)}});
Z8.define("Z8.viewport.PopupMessages",{extend:"Z8.Container",cls:"messages popup",show:function(a){a=Array.isArray(a)?a:[a];var b=this.items,c=b.length,d=a.length;if(5<c+d)for(--c;c>=Math.max(5-d,0);c--)b[c].remove();b=[];for(c=Math.max(0,d-5);c<d;c++)b.insert(new Z8.viewport.PopupMessage(a[c]),0);this.add(b,0)}});
Z8.define("Z8.viewport.PopupMessage",{extend:"Z8.Component",cls:"message",htmlMarkup:function(){var a={cls:"icon fa fa-fw fa-"+this.type+" "+this.type,html:String.htmlText()},b={cls:"text",cn:[{tag:"b",html:this.source||Application.title},{tag:"br"},Format.nl2br(this.text)]},a={cls:"body",cn:[a,b]};return{cls:"message "+this.type,id:this.getId(),cn:[a]}},completeRender:function(){this.callParent();DOM.on(this,"click",this.hide,this);(new Z8.util.DelayedTask).delay(4E3,this.hide,this)},onDestroy:function(){DOM.un(this,
"click",this.hide,this);this.callParent()},hide:function(){this.isHiding||(this.isHiding=!0,DOM.addCls(this,"hiding"),(new Z8.util.DelayedTask).delay(1E3,this.remove,this))},remove:function(){this.container.remove(this)}});Z8.define("Z8.application.viewport.Form",{extend:"Z8.Container",shortClassName:"viewport.Form",setTitle:function(a){this.callParent(a);this.fireEvent("title",this,a)},getIcon:function(){return this.icon},setIcon:function(a){this.icon=a}});
Z8.define("Z8.application.viewport.SourceCode",{extend:"Z8.Container",tabIndex:0,cls:"air source-code display-none",history:null,htmlMarkup:function(){this.history=[];this.historyPosition=-1;var a=this.backward=new Z8.button.Button({cls:"btn-sm",icon:"fa-play fa-flip-horizontal",enabled:!1,handler:this.onBackward,scope:this}),b=this.forward=new Z8.button.Button({cls:"btn-sm",icon:"fa-play",enabled:!1,handler:this.onForward,scope:this}),a=new Z8.button.Group({items:[a,b]}),b=this.title=new Z8.Component({cls:"text"}),
a=new Z8.toolbar.Toolbar({items:[a,b]}),b=this.frame=new Z8.Component({cls:"code"});this.items=[a,b];return this.callParent()},completeRender:function(){this.callParent();DOM.on(this,"click",this.onClick,this);DOM.on(this,"keyDown",this.onKeyDown,this)},onDestroy:function(){DOM.un(this,"click",this.onClick,this);DOM.un(this,"keyDown",this.onKeyDown,this);DOM.un(document.body,"mouseDown",this.monitorOuterClick,this);this.callParent()},setEnabled:function(a){DOM.swapCls(this,!a,"disabled");this.callParent(a)},
load:function(a,b){if(null!=a&&!this.loadLock){var c=this.frame,d=a.indexOf("#"),e=-1!=d?a.substring(d):null,f=-1!=d?a.substring(0,d):a;f==this.current?(this.select(e),this.addToHistory(a),Z8.callback(b,!0)):(this.backward.setEnabled(!1),this.forward.setEnabled(!1),this.loadLock=!0,HttpRequest.get("src/"+a,{fn:function(g,h){DOM.setInnerHTML(c,h?g.text:"");d=f.lastIndexOf(".");var k=-1!=d?f.substring(d+1)+" - "+f.substring(0,d):f;this.title.setText(k);this.select(e);this.addToHistory(a);this.currentUrl=
f;null==e&&DOM.scroll(this.frame,0,0);Z8.callback(b,h);this.isOpen&&this.focus();this.loadLock=!1},scope:this}))}},focus:function(){this.frame.focus()},open:function(){this.isOpen||(this.isOpen=!0,DOM.removeCls(this,"display-none"),DOM.addCls(this,"open",10),DOM.on(document.body,"mouseDown",this.monitorOuterClick,this),(new Z8.util.DelayedTask).delay(500,this.focus,this),this.fireEvent("show",this))},close:function(){this.isOpen&&(DOM.un(document.body,"mouseDown",this.monitorOuterClick,this),DOM.removeCls(this,
"open"),DOM.addCls(this,"display-none"),this.fireEvent("hide",this),this.isOpen=!1)},toggle:function(){this.isOpen?this.close():this.open()},select:function(a){DOM.removeCls(this.selected,"selected");if(null!=a){a=this.selected=DOM.selectNode(this,a);var b=a.offsetParent,c=a.offsetLeft,d=a.offsetTop,e=a.offsetWidth,f=a.offsetHeight,g=b.scrollTop,h=b.scrollLeft,k=b.clientWidth,m=h+k,n=g+b.clientHeight;d<g?g=a.offsetTop-10:d+f>=n&&(g=g+(f+d-n)+10);c<h?h=a.offsetLeft-10<k?0:a.offsetLeft-10:c+e>=m&&(h=
h+(e+c-m)+10);DOM.scroll(b,h,g);DOM.addCls(this.selected,"selected")}},addToHistory:function(a){if(!this.historyLock&&this.history[this.historyPosition]!=a){var b=++this.historyPosition;(this.history=this.history.splice(0,b)).push(a);this.updateButtons()}},updateButtons:function(){var a=this.historyPosition;this.backward.setEnabled(0<a);this.forward.setEnabled(a!=this.history.length-1)},onBackward:function(a){this.historyLock=!0;var b=this.history[this.historyPosition-1];a.setBusy(!0);this.load(b,
{fn:function(b){a.setBusy(!1);this.historyPosition--;this.historyLock=!1;this.updateButtons()},scope:this})},onForward:function(a){this.historyLock=!0;var b=this.history[this.historyPosition+1];a.setBusy(!0);this.load(b,{fn:function(b){a.setBusy(!1);this.historyPosition++;this.historyLock=!1;this.updateButtons()},scope:this})},monitorOuterClick:function(a){a=a.target;DOM.isParentOf(this,a)||DOM.isParentOf(this.owner,a)||this.close()},onClick:function(a,b){"SPAN"==b.tagName&&(b=b.parentNode);if("A"!=
b.tagName)this.select(null);else{a.stopEvent();var c=b.outerHTML.match(/href="([^"]*)"/)[1];this.load(c)}},onKeyDown:function(a,b){a.getKey()==Event.ESC&&this.isOpen&&(a.stopEvent(),this.close())}});var Viewport=null;
Z8.define("Z8.application.viewport.Viewport",{extend:"Z8.Container",cls:"viewport",handlers:[],forms:[null],initComponent:function(){this.callParent();this.setTitle(Application.name)},htmlMarkup:function(){var a=this.createBreadcrumb(),a=this.breadcrumbs=new Z8.button.Group({cls:"breadcrumbs flex",items:[a]}),b=this.logout=new Z8.button.Button({tooltip:"\u0412\u044b\u0445\u043e\u0434",cls:"btn-tool",icon:"fa-power-off",handler:this.logout,scope:this}),a=this.header=new Z8.Container({cls:"header flex-row flex-center",
items:[a,b]}),b=this.body=new Z8.Container({cls:"body"}),c=this.popupMessages=new Z8.viewport.PopupMessages,d=this.loginForm=new Z8.application.viewport.Login({handler:this.loginCallback,scope:this});d.on("show",this.onLoginFormShow,this);d.on("hide",this.onLoginFormHide,this);this.items=[a,b,d,c];return this.callParent()},completeRender:function(){this.callParent()},login:function(a){this.handlers.push(a);a=this.loginForm;this.isLoggingIn?a.focus():a.show()},logout:function(){this.isLoggingIn?this.loginForm.focus():
(this.onLogout(),Application.login())},createHeaderButtons:function(){var a=this.settingsButton=new Z8.button.Button({tooltip:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438",cls:"btn-tool",icon:"fa-cog",enabled:!1,handler:this.onSettings,scope:this}),b=this.jobMonitorButton=new Z8.button.Button({tooltip:"\u041c\u043e\u043d\u0438\u0442\u043e\u0440 \u0437\u0430\u0434\u0430\u0447",cls:"btn-tool",icon:"fa-tv",handler:this.openJobMonitor,scope:this}),c=this.loggerButton=new Z8.button.Button({tooltip:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f",
cls:"btn-tool",icon:"fa-comment-o",enabled:!1,handler:this.openLogger,scope:this});return[b,c,a]},onLogin:function(){if(this.isLoggedIn)this.focus();else{this.isLoggedIn=!0;var a=this.header,b=this.menuToggle=new Z8.button.Button({tooltip:"\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c/\u0441\u043a\u0440\u044b\u0442\u044c \u043c\u0435\u043d\u044e",cls:"btn-tool",icon:"fa-bars",handler:this.toggleMenu,scope:this});a.add(b,0);var c=this.buttons=this.createHeaderButtons();a.add(c,a.getCount()-
1);a=this.menu=new Z8.application.sidebar.Sidebar({owner:b,handler:this.onMenuItem,scope:this});a.on("open",this.onMenuOpen,this);a.on("close",this.onMenuClose,this);this.add(a);a=this.sourceCode=new Z8.application.viewport.SourceCode;this.add(a);this.openMenu();DOM.on(b,"mouseDown",this.onMenuToggleMouseDown,this);DOM.on(document.body,"keyDown",this.onKeyDown,this)}},onLogout:function(){if(this.isLoggedIn){this.isLoggedIn=!1;DOM.un(this.menuToggle,"mouseDown",this.onMenuToggleMouseDown,this);DOM.un(document.body,
"keyDown",this.onKeyDown,this);this.openForm(null);var a=this.header;a.remove(this.menuToggle);a.remove(this.buttons);null!=this.jobMonitor&&this.jobMonitor.destroy();a=this.menu;a.un("open",this.onMenuOpen,this);a.un("close",this.onMenuClose,this);this.remove(a);this.remove(this.sourceCode);this.body.removeAll();this.menuToggle=this.buttons=this.menu=this.jobMonitor=this.sourceCode=null}},loginCallback:function(a){for(var b=this.handlers,c=0,d=b.length;c<d;c++)Z8.callback(b[c],a);this.handlers=[];
this.onLogin()},message:function(a){this.popupMessages.show(a)},getBody:function(){return this.body},focus:function(){var a=this.forms,b=a.length;return 1<b?a[b-1].focus():DOM.focus(this)},openMenu:function(a){this.menu.open()},showSourceCode:function(a){a?this.sourceCode.open():this.sourceCode.close()},initSourceCode:function(a){this.sourceCode.load(a)},onMenuToggleMouseDown:function(a,b){this.menuToggle.isEnabled()&&(this.menu.closeOnBlur=!1)},toggleMenu:function(a){this.menu.closeOnBlur=!0;this.menu.toggle()},
enableMenu:function(a){null!=this.menu&&(this.menuToggle.setEnabled(a),this.menu.setEnabled(a))},onMenuOpen:function(a){this.menuToggle.rotateIcon(90)},onMenuClose:function(a){this.menuToggle.rotateIcon(0);this.focus()},onLoginFormShow:function(a){this.enableMenu(!1);this.isLoggingIn=!0},onLoginFormHide:function(a){this.enableMenu(!0);this.isLoggingIn=!1},onMenuItem:function(a){this.open(a.id,!0)},setTitle:function(a){this.callParent(a);DOM.setInnerHTML(this.text,a)},onBreadcrumbClick:function(a){this.openForm(a.form)},
createBreadcrumb:function(a,b){var c=null!=a?a.getTitle():Application.name,d=null!=a?a.getIcon():null;return new Z8.button.Button({cls:"n"+(b||1),text:c,tooltip:c,icon:d,form:a,handler:this.onBreadcrumbClick,scope:this})},closeForm:function(a){var b=this.forms;a=b.indexOf(a);-1!=a&&(a--,a=0!=a?b[a]:null,this.openForm(a))},openForm:function(a,b,c){this.showSourceCode(!1);this.initSourceCode(null!=a&&null!=a.store?a.store.getSourceCodeLocation():null);var d=this.forms,e=d.indexOf(a||null);-1==e&&b&&
(e=0);b=this.breadcrumbs;var f=this.breadcrumbs.items,g=this.body;if(-1!=e){for(var h=f.length-1;h>e;h--){var k=f[h];g.remove(k.form);b.remove(k);d.removeAt(h)}k=f[h];null!=k.originalText&&(k.setText(k.originalText),k.originalText=null);DOM.removeCls(d[h],"display-none")}null!=a&&-1==d.indexOf(a)&&(null!=c&&(k=f[f.length-1],k.originalText=k.getText(),k.setText(c)),k=this.createBreadcrumb(a,d.length+1),DOM.addCls(d[d.length-1],"display-none"),b.add(k),g.add(a),d.push(a));this.focus();Application.setTitle(null!=
a?a.getTitle():null)},getJobMonitor:function(){null==this.jobMonitor&&(this.jobMonitor=new Z8.application.job.JobMonitor({autoDestroy:!1}));return this.jobMonitor},startJob:function(a){this.getJobMonitor().addJob(a)},open:function(a,b,c){if(!this.isOpeningForm){this.isOpeningForm=!0;if(String.isString(a)){var d=User.getFilter(a),e=User.getPeriod(a);a={request:a,filter:d.getActive(),period:e}}this.menuToggle.setBusy(!0);HttpRequest.send(a,{fn:function(d,e){this.menuToggle.setBusy(!1);this.isOpeningForm=
!1;if(e)if(d.isJob){var f=new Z8.application.job.Job(d);this.startJob(f)}else{d.where=a.where;d.filter=a.filter;d.period=a.period;var f={cls:"air",store:d},g=Application.getSubclass(d.ui),g=null!=g?Z8.create(g,f):new Z8.application.form.Navigator(f);this.openForm(g,b,c)}},scope:this})}},openJobMonitor:function(){this.getJobMonitor().open()},onSettings:function(){},onKeyDown:function(a,b){a.getKey()==Event.ESC&&(this.openMenu(),a.stopEvent())}});var User=null;
Z8.define("Z8.application.User",{extend:"Z8.Object",constructor:function(a){this.callParent(a);try{var b=this.settings;this.settings=Z8.isEmpty(b)?{}:JSON.decode(b)}catch(c){this.settings={}}},getProperty:function(a,b){var c=this.settings[Application.id],c=c?c[a]:null;return null!=c?null!=b?c[b]:c:null},setProperty:function(a,b,c){var d=this.settings,e=Application.id,f=d[e];null==f&&(d[e]=f={});void 0!=c?(d=f[a],null==d&&(f[a]=d={}),d[b]=c):f[a]=b},getFilter:function(a){return new Z8.data.Filter(this.getProperty(a,
"filter"))},setFilter:function(a,b){this.setProperty(a,"filter",null!=b?b.toJson():void 0)},getPeriod:function(a){return new Z8.data.Period(this.getProperty(a,"period"))},setPeriod:function(a,b){this.setProperty(a,"period",null!=b?b.toJson():void 0)},saveSettings:function(){HttpRequest.send({request:"settings",data:this.settings})}});
Z8.define("Z8.application.Application",{extend:"Z8.Object",id:"Z8\u2122 Application",name:"Revolt",title:"Revolt software",viewportCls:null,userCls:null,subclasses:{},getSubclass:function(a){return this.subclasses[a]},login:function(a){if(null==Viewport){this.setTitle();var b=this.viewportCls;Viewport=null==b?new Z8.application.viewport.Viewport:Z8.create(b);Viewport.render()}Viewport.login({fn:function(b){this.session=b.session;this.maxUploadSize=b.maxUploadSize;var c=this.userCls;User=null==c?new Z8.application.User(b.user):
Z8.create(c,b.user);null!=a&&Z8.callback(a,b)},scope:this})},setTitle:function(a){document.title=(null!=a?a+" - ":"")+Application.title},message:function(a){Viewport.message(a)},checkFileSize:function(a){var b=a.size,c=1048576*Application.maxUploadSize;return 0!=c&&b>c?(Application.message({text:"\u0420\u0430\u0437\u043c\u0435\u0440 \u0444\u0430\u0439\u043b\u0430 '"+a.name+"' "+Z8.util.Format.fileSize(b)+" \u043f\u0440\u0435\u0432\u044b\u0448\u0430\u0435\u0442 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u044b\u0435 "+
Format.fileSize(c),type:"error",time:new Date}),!1):!0}});var Application=new Z8.application.Application;DOM.onReady(Application.login,Application);Z8.define("Z8.application.job.Job",{poll:function(a){null==this.task&&(this.options=a,this.task=new Z8.util.DelayedTask);HttpRequest.send({request:this.request,server:this.server,job:this.id},{fn:this.pollCallback,scope:this})},pollCallback:function(a,b){Z8.callback(this.options,this,a,b);b&&!a.done&&this.task.delay(250,this.poll,this)}});
Z8.define("Z8.application.job.Model",{extend:"Z8.data.Model",local:!0,idProperty:"id",fields:[new Z8.data.field.String({name:"name"}),new Z8.data.field.Datetime({name:"start",type:Type.Datetime}),new Z8.data.field.String({name:"duration"}),new Z8.data.field.Integer({name:"percent"})]});
Z8.define("Z8.application.job.JobMonitor",{extend:"Z8.window.Window",header:"\u041c\u043e\u043d\u0438\u0442\u043e\u0440 \u0437\u0430\u0434\u0430\u0447",icon:"fa-tv",fields:[{name:"name",header:"\u0417\u0430\u0434\u0430\u0447\u0430",width:250},{name:"start",header:"\u041d\u0430\u0447\u0430\u043b\u043e",width:150,type:Type.Datetime},{name:"duration",header:"\u0414\u043b\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c",width:100},{name:"percent",header:"%",width:70,renderer:Format.percent}],
initComponent:function(){this.callParent();this.store=new Z8.data.Store({model:"Z8.application.job.Model"})},htmlMarkup:function(){this.cls=DOM.parseCls(this.cls).pushIf("job-monitor","air");var a=this.taskList=new Z8.form.field.Listbox({cls:"tasks",store:this.store,fields:this.fields,icons:!0,checks:!1,editable:!1});a.on("select",this.onSelect,this);var b=this.textArea=new Z8.form.field.Html({cls:"messages",readOnly:!0});this.body=[a,b];return this.callParent()},focus:function(){this.taskList.focus()},
addJob:function(a){var b={id:a.id,name:a.text,start:new Date(a.start)},c=Z8.create(this.store.getModel(),b);c.job=a;this.store.add(c);a.record=c;a.poll({fn:function(a,b,f){f?(c.beginEdit(),c.set("percent",b.worked),c.set("duration",b.duration),c.endEdit(),b.done&&this.setIcon(a,"fa-check")):this.setIcon(a,"fa-exclamation");this.addMessages(c,b.info.messages)},scope:this});this.open();this.taskList.select(c);this.setIcon(a,["fa-circle-o-notch","fa-spin"])},setIcon:function(a,b){this.taskList.getItem(a.record).setIcon(b)},
onSelect:function(a,b){var c=null!=b?b.job.info.messages.join(""):"";this.textArea.setValue(c)},addMessages:function(a,b){for(var c=a.job.info.messages,d=0,e=b.length;d<e;d++){var f=b[d],g={tag:"i",cls:"fa fa-fw fa-"+f.type+" "+f.type,html:String.htmlText()},h=Format.datetime(new Date(f.time)),g=DOM.markup({tag:"p",cls:"header",cn:[g,h]}),f=DOM.markup({tag:"p",cls:"text",cn:[f.text]});c.push(g,f)}this.taskList.getSelection()==a&&(this.onSelect(this.taskList,a),this.textArea.setScrollTop(1E7))}});
Z8.define("Z8.query.Store",{extend:"Z8.data.Store",statics:{definedModels:{},config:function(a){var b={},c=a.isListbox;if(!a.isCombobox&&!c)throw"Z8.query.Store.config() accepts only listbox or combobox config";var d=a.query,e=c?d.primaryKey:a.link.primaryKey,f=c?a.query.parentKey:null,g=c?a.query.periodKey:null,h=a.query.lockKey,k=c?d.link:a.link,m=d.fields||d.columns||[a];c&&null!=k&&(m=m.concat([k]));b.request=d.id;b.fields=m;b.requestFields=m;b.primaryKey=e;b.parentKey=f;b.lockKey=h;b.periodKey=
g;b.link=c?null:k.name;b.query=d.name;b.totals=c?d.totals:!1;b.sort=c?d.sort:null;b.values=a.values;b.access=d.access;return b}},constructor:function(a){var b=this.getFieldsInfo(a),c={colCount:a.colCount,controls:a.controls,text:a.text,presentation:a.presentation,icon:a.icon,actions:a.actions,reports:a.reports,readOnly:a.readOnly,dependencies:a.dependencies};this.readOnly=a.readOnly||!1;var d=a.request;a={model:Z8.define(d+"/"+b.hash,{extend:"Z8.data.Model",single:!0,name:d,link:a.link,query:a.query,
totalCount:!1!==a.total,totals:!0===a.totals,idProperty:a.primaryKey,access:a.access,parentIdProperty:a.parentKey,lockProperty:a.lockKey,periodProperty:a.periodKey,filesProperty:a.attachmentsKey,sourceCode:a.sourceCode,fields:b.data,names:b.names,columns:b.columns,quickFilters:b.quickFilters,requestFields:b.request,links:b.links,valueFor:b.valueFor,valueFrom:b.valueFrom}),data:a.data,totalCount:a.total,summaryData:a.summaryData,totalsData:a.totalsData,limit:a.limit||200,filters:a.filter,where:a.where,
period:a.period,sorter:a.sort,values:a.values,params:a.params,form:c};this.callParent(a)},getFieldsInfo:function(a){a=a||{};var b={},c={};b.data=this.createFields(a.fields,c);b.names=this.createFields(a.nameFields,c);b.columns=this.createFields(a.columns,c);b.quickFilters=this.createFields(a.quickFilters,c);b.request=this.createFields(a.requestFields,c);b.links=this.getFieldsBy(b.data,"isLink");b.valueFor=this.getFieldsBy(b.data,"valueFor");b.valueFrom=this.getFieldsBy(b.data,"valueFrom");b.hash=
MD5.hex(Object.keys(c).sort().join(";")+a.link+a.primaryKey);return b},createFields:function(a,b){var c=[];if(null==a||0==a.length)return c;for(var d=0,e=a.length;d<e;d++){var f=a[d],g=f.name,h=b[g];null==h&&(h=this.getFieldType(f),h=Z8.create(h,f));c.push(h);b[g]=h}return c},getFieldsBy:function(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var f=a[d];null!=f[b]&&c.push(f)}return c},getFieldType:function(a){a=a.type;return a==Type.Boolean?"Z8.data.field.Boolean":a==Type.Integer?"Z8.data.field.Integer":
a==Type.Float?"Z8.data.field.Float":a==Type.Date?"Z8.data.field.Date":a==Type.Datetime?"Z8.data.field.Datetime":a==Type.Guid?"Z8.data.field.Guid":a==Type.Files?"Z8.data.field.Files":a==Type.Json?"Z8.data.field.Json":"Z8.data.field.String"}});
Z8.define("Z8.application.form.Navigator",{extend:"viewport.Form",presentation:"form",initComponent:function(){var a=this.store;a.isStore||(a=this.store=new Z8.query.Store(a));this.title=a.form.text;this.icon=a.form.icon;this.presentation=a.form.presentation||"form";this.callParent();this.initFilter(User.getFilter(this.registryEntry()));this.initPeriod(User.getPeriod(this.registryEntry()))},registryEntry:function(){return this.store.getModelName()},initFilter:function(a){this.filter=a;this.store.setFilter(a.getActive())},
setFilter:function(a){this.initFilter(a);User.setFilter(this.registryEntry(),a);User.saveSettings();this.refreshRecords(this.filterButton)},initPeriod:function(a){var b=this.store;if(null==b.getPeriodProperty())return!1;this.period=a;b.setPeriod(a);return!0},setPeriod:function(a){this.initPeriod(a)&&(User.setPeriod(this.registryEntry(),a),User.saveSettings(),this.refreshRecords(this.periodButton))},isReadOnly:function(){return this.store.form.readOnly},htmlMarkup:function(){this.cls=DOM.parseCls(this.cls).pushIf("navigator");
var a=this.createForm().add(this.createTable()),a=this.body=new Z8.Container({cls:"body",items:a}),b=this.createToolbar(),c=this.isFormPresentation();this.setListboxTools(this.listbox,c);this.setListboxTools(this.table,!c);this.items=[b,a];this.updateSortState();return this.callParent()},completeRender:function(){this.callParent();DOM.on(this,"keyDown",this.onKeyDown,this);Viewport.sourceCode.owner=this.sourceCodeButton;Viewport.sourceCode.on("show",this.onSourceCodeShow,this);Viewport.sourceCode.on("hide",
this.onSourceCodeHide,this)},onDestroy:function(){Viewport.sourceCode.un("show",this.onSourceCodeShow,this);Viewport.sourceCode.un("hide",this.onSourceCodeHide,this);Viewport.sourceCode.owner=null;DOM.un(this,"keyDown",this.onKeyDown,this);this.callParent()},isFormPresentation:function(){return"form"==this.presentation},isTablePresentation:function(){return"table"==this.presentation},createForm:function(){var a=this.store,b=a.form,c=this.isFormPresentation()?"":"display-none",a=this.form=new Z8.form.Form({cls:c,
model:a.getModelName(),autoSave:!0,controls:b.controls,colCount:b.colCount,readOnly:this.isReadOnly()});return[this.createListbox(),a]},createListbox:function(){var a=this.listbox=new Z8.form.field.Listbox(this.getListboxConfig());a.on("select",this.onSelect,this);a.on("contentChange",this.updateToolbar,this);return a},createTable:function(){var a=this.isTablePresentation(),b=this.getColumns(),c=this.store;return this.table=new Z8.form.field.Listbox({cls:"table"+(a?"":" display-none"),store:c,fields:b,
locks:!this.isReadOnly(),editable:!0,readOnly:this.isReadOnly(),totals:c.hasTotals(),pagingMode:"always"})},setListboxTools:function(a,b){a.setAddTool(b?this.addButton:null);a.setCopyTool(b?this.copyButton:null);a.setRefreshTool(b?this.refreshButton:null);a.setRemoveTool(b?this.removeButton:null)},createToolbar:function(){var a=this.store,b=[],c=[];if(a.hasCreateAccess()){var d=this.addButton=new Z8.button.Button({cls:"btn-sm",icon:"fa-file-o",tooltip:"\u041d\u043e\u0432\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c",
handler:this.addRecord,scope:this});c.push(d)}a.hasCopyAccess()&&(d=this.copyButton=new Z8.button.Button({cls:"btn-sm",icon:"fa-copy",tooltip:"\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c",handler:this.copyRecord,scope:this}),c.push(d));a.hasReadAccess()&&(d=this.refreshButton=new Z8.button.Button({cls:"btn-sm",icon:"fa-refresh",tooltip:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c",handler:this.refreshRecords,scope:this}),c.push(d));0!=c.length&&
(c=new Z8.button.Group({items:c}),b.push(c));c=this.filesButton=this.createFilesButton();null!=c&&b.push(c);a.hasDestroyAccess()&&(a=this.removeButton=new Z8.button.Button({cls:"btn-sm",danger:!0,icon:"fa-trash",tooltip:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c",handler:this.removeRecord,scope:this}),b.push(a));a=this.quickFilters=this.createQuickFilters();b.add(a);a=this.periodButton=this.createPeriodButton();null!=a&&b.push(a);a=this.filterButton=this.createFilterButton();
c=this.sortButton=new Z8.button.Button({enabled:!1,cls:"btn-sm",icon:"fa-sort",tooltip:"\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438",triggerTooltip:"\u041d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438",split:!0,handler:this.toggleSortOrder,scope:this});b.push(a,c);a=this.createFormTableGroup();null!=a&&b.push(a);a=this.printButton=this.createPrintButton();
b.push(a);a=this.actionsButton=this.createActionsButton();null!=a&&b.push(a);a=this.reportsButton=this.createReportsButton();null!=a&&b.push(a);a=this.sourceCodeButton=this.createSourceCodeButton();null!=a&&b.push(a);return new Z8.toolbar.Toolbar({items:b})},createFilesButton:function(){var a=this.store,b=a.getFilesProperty();if(null==b||!a.hasWriteAccess())return null;var b=this.form.getControl(b),a=null==b?new Z8.data.Store({model:"Z8.data.file.Model"}):b.store,c=new Z8.menu.Menu({store:a});c.on("itemClick",
this.downloadFiles,this);a=new Z8.button.File({store:a,control:b,cls:"btn-sm",icon:"fa-paperclip",tooltip:"\u0424\u0430\u0439\u043b\u044b",menu:c});a.on("select",this.uploadFiles,this);return a},createQuickFilters:function(){for(var a=[],b=this.getQuickFilterFields(),c=0,d=b.length;c<d;c++){var e=b[c],e=new Z8.form.field.Search({field:e,width:10,label:!1,placeholder:e.header,tooltip:e.header});e.on("search",this.onSearch,this);a.push(e)}return a},createFilterButton:function(){var a=new Z8.filter.Button({cls:"btn-sm",
filter:this.filter,fields:this.store.getFields()});a.on("filter",this.onFilter,this);return a},createFormTableGroup:function(){if(Z8.isEmpty(this.getColumns()))return null;var a=this.isFormPresentation(),b=this.formButton=new Z8.button.Button({cls:"btn-sm",icon:"fa-wpforms",tooltip:"\u0412 \u0432\u0438\u0434\u0435 \u0444\u043e\u0440\u043c\u044b",toggled:a});b.on("toggle",this.toggleForm,this);a=this.tableButton=new Z8.button.Button({cls:"btn-sm",icon:"fa-table",tooltip:"\u0412 \u0432\u0438\u0434\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b",
toggled:!a});a.on("toggle",this.toggleTable,this);return new Z8.button.Group({items:[b,a],radio:!0})},createPrintButton:function(){var a=[new Z8.menu.Item({text:"Acrobat Reader (*.pdf)",icon:"fa-file-pdf-o",format:"pdf"}),new Z8.menu.Item({text:"Microsoft Excel (*.xls)",icon:"fa-file-excel-o",format:"xls"}),new Z8.menu.Item({text:"Microsoft Word (*.doc)",icon:"fa-file-word-o",format:"doc"}),"-",new Z8.menu.Item({text:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438",icon:"fa-print",enabled:!1})],
a=new Z8.menu.Menu({items:a});a.on("itemClick",this.onMenuPrint,this);return new Z8.button.Button({cls:"btn-sm",icon:"fa-file-pdf-o",tooltip:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a PDF",menu:a,handler:this.print,scope:this,format:"pdf"})},createPeriodButton:function(){if(null==this.period)return null;var a=new Z8.calendar.Button({cls:"btn-sm",icon:"fa-calendar",period:this.period});a.on("period",this.onPeriod,this);return a},createActionsButton:function(){var a=
this.store.form.actions;if(Z8.isEmpty(a))return null;for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];b.push(new Z8.menu.Item({text:e.text,icon:e.icon,action:e}))}a=new Z8.menu.Menu({items:b});a.on("itemClick",this.onMenuAction,this);return new Z8.button.Button({cls:"btn-sm",icon:"fa-play",text:"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f",tooltip:"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f",menu:a,handler:this.onMenuButtonClick,scope:this})},createReportsButton:function(){var a=this.store.form.reports;
if(Z8.isEmpty(a))return null;for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];b.push(new Z8.menu.Item({text:e.text,icon:e.icon,report:e}))}a=new Z8.menu.Menu({items:b});a.on("itemClick",this.onMenuReport,this);return new Z8.button.Button({cls:"btn-sm",icon:"fa-print",tooltip:"\u041f\u0435\u0447\u0430\u0442\u044c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432",menu:a,handler:this.onMenuButtonClick,scope:this})},createSourceCodeButton:function(){var a=new Z8.button.Button({cls:"btn-sm float-right",
text:"\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043a\u043e\u0434",success:!0,icon:"fa-code",tooltip:"\u041a\u0430\u043a \u044d\u0442\u043e \u0441\u0434\u0435\u043b\u0430\u043d\u043e",toggled:!1});a.on("toggle",this.toggleSourceCode,this);return a},onSourceCodeShow:function(){this.sourceCodeButton.setToggled(!0,!0)},onSourceCodeHide:function(){this.sourceCodeButton.setToggled(!1,!0);this.focus()},getListboxConfig:function(){var a=this.getNames(),b=this.getQuickFilterFields(),c=this.getListboxLabel(a);
return{cls:this.isFormPresentation()?"":"display-none",store:this.store,fields:a,names:a,label:c,quickFilters:b,filters:0==b.length,editable:!0,locks:!this.isReadOnly()}},getListboxLabel:function(a){return 0!=a.length?(a=a[0],{text:a.header||a.name,icon:a.icon}):""},getNames:function(){var a=this.store.getNames();if(!Z8.isEmpty(a))return a;a=this.form.getFields();return 0==a.length?[]:[a[0].field]},getColumns:function(){var a=this.store.getColumns();if(Z8.isEmpty(a))for(var b=this.form.getFields(),
c=0,d=b.length;c<d;c++){var e=b[c].field;null==e||e.isListbox||e.isContainer||e.isFieldset||a.push(e)}c=0;for(d=a.length;c<d;c++)b=a[c],b.editable=!1!==b.editable&&!b.readOnly;return a},getQuickFilterFields:function(){return this.store.getQuickFilters()},getActiveListbox:function(){return this.isFormPresentation()?this.listbox:this.table},getSelection:function(){return this.getActiveListbox().getSelection()},addRecord:function(a){this.getActiveListbox().onAddRecord(a)},copyRecord:function(a){this.getActiveListbox().onCopyRecord(a)},
removeRecord:function(a){this.getActiveListbox().onRemoveRecord(a)},refreshRecords:function(a){this.getActiveListbox().onRefresh(a)},updateToolbar:function(){var a=this.isReadOnly(),b=this.getSelection();null!=this.addButton&&this.addButton.setEnabled(!a);null!=this.copyButton&&this.copyButton.setEnabled(!a&&null!=b);null!=this.removeButton&&this.removeButton.setEnabled(!a&&null!=b&&b.isDestroyable());null!=this.reportsButton&&this.reportsButton.setEnabled(null!=b);var c=this.filesButton;null!=c&&
(a=!a&&null!=b,c.setEnabled(a),a&&null==c.control&&c.store.loadData(b.getFiles()))},toggleForm:function(a){this.table.hide();this.listbox.show();this.form.show();this.setListboxTools(this.listbox,!0);this.setListboxTools(this.table,!1);this.presentation="form";this.focus()},toggleTable:function(a){this.listbox.hide();this.form.hide();this.table.show();this.setListboxTools(this.table,!0);this.setListboxTools(this.listbox,!1);this.presentation="table";this.focus()},toggleSourceCode:function(a,b){Viewport.showSourceCode(b)},
onSearch:function(a,b){for(var c=[],d=this.quickFilters,e=0,f=d.length;e<f;e++){var g=d[e];g!=a&&null!=g.expression&&c.push(g.expression)}a.expression=""!=b?{property:a.field.name,operator:Operation.Contains,value:b}:null;null!=a.expression&&c.push(a.expression);a.setBusy(!0);this.store.quickFilter(c,{fn:function(b,c){a.setBusy(!1)},scope:this})},updateSortState:function(){},toggleSortOrder:function(a){a=this.store.getSorter();0!=a.length&&(a=a[0],a.direction="asc"==a.direction?"desc":"asc",this.updateSortState())},
onFilter:function(a,b,c){c!=Filter.NoAction&&this.setFilter(b);this.focus()},onPeriod:function(a,b,c){c!=Period.NoAction&&this.setPeriod(b);this.focus()},focus:function(){return this.getActiveListbox().focus()},select:function(a,b){this.disposed||(this.form.loadRecord(b),this.updateToolbar())},onSelect:function(a,b){null==this.selectTask&&(this.selectTask=new Z8.util.DelayedTask);this.selectTask.delay(50,this.select,this,a,b)},onKeyDown:function(a,b){var c=a.getKey();c==Event.F&&a.ctrlKey&&0!=this.quickFilters.length?
(this.quickFilters[0].focus(),a.stopEvent()):c==Event.ESC&&(this.focus(),Viewport.closeForm(this),a.stopEvent())},onMenuPrint:function(a,b){var c=b.format;"pdf"==c?this.printPDF():"xls"==c?this.printXLS():"doc"==c&&this.printDOC()},printPDF:function(){var a=this.printButton;a.setIcon("fa-file-pdf-o");a.setTooltip("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a PDF");a.format="pdf";this.print()},printXLS:function(){var a=this.printButton;a.setIcon("fa-file-excel-o");a.setTooltip("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a XLS");
a.format="xls";this.print()},printDOC:function(){var a=this.printButton;a.setIcon("fa-file-word-o");a.setTooltip("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a DOC");a.format="doc";this.print()},print:function(){for(var a=this.printButton,b=a.format,c=[],d=this.table.getHeaders(),e=0,f=d.length;e<f;e++){var g=d[e],h=g.field;null!=h&&h.type!=Type.Text&&c.push({id:h.name,width:Ems.emsToPixels(g.getWidth())})}d=this.store;b={request:d.getModelName(),action:"export",format:b,
columns:c,filter:this.filter.getActive()||[],quickFilter:d.getQuickFilter(),where:d.getWhere(),sort:d.getSorter(),period:d.getPeriod()};a.setBusy(!0);HttpRequest.send(b,{fn:function(b,c){a.setBusy(!1)},scope:this});this.focus()},onMenuButtonClick:function(a){a.toggleMenu()},onMenuAction:function(a,b){this.actionsButton.setBusy(!0);var c=b.action,d=this.getSelection(),d={request:this.store.getModelName(),action:"action",id:c.id,records:null==d||d.phantom?null:[d.id]};HttpRequest.send(d,{fn:function(a,
b){this.onAction(c,a,b);this.actionsButton.setBusy(!1);this.refreshRecords(this.refreshButton)},scope:this})},onAction:function(a,b,c){},onMenuReport:function(a,b){var c=b.report,d=this.getSelection(),c={request:this.store.getModelName(),action:"report",format:"pdf",id:c.id,recordId:d.id};this.reportsButton.setBusy(!0);HttpRequest.send(c,{fn:function(a,b){this.reportsButton.setBusy(!1)},scope:this});this.focus()},downloadFiles:function(a,b){this.filesButton.setBusy(!0);DOM.download(b.record.get("path"),
null,{fn:function(a){this.filesButton.setBusy(!1)},scope:this})},uploadFiles:function(a,b){a.setBusy(!0);var c=this.getSelection();c.attach(c.getFilesProperty(),b,{fn:function(b,c,f){a.setBusy(!1);f&&this.getSelection()==b&&a.store.loadData(c)},scope:this})}});
