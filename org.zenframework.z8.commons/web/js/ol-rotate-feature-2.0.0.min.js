/*!
Rotate vector features interaction for OpenLayers

@package ol-rotate-feature
@author Vladimir Vershinin <ghettovoice@gmail.com>
@version 2.0.0
@licence MIT
@copyright (c) 2016-2018, Vladimir Vershinin <ghettovoice@gmail.com>
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("openlayers")):"function"==typeof define&&define.amd?define("ol-rotate-feature",["openlayers"],t):e.RotateFeatureInteraction=t(e.ol)}(this,function(e){"use strict";function t(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(t=["Assertion failed",t].join(": "),!e)throw new Error(t)}function i(e){return e}function s(e,t){return-1!==e.indexOf(t)}function u(e){return"[object Array]"===Object.prototype.toString.call(e)}e=e&&e.hasOwnProperty("default")?e.default:e;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}}(),l=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},o=function e(t,r,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,o)}if("value"in n)return n.value;var i=n.get;return void 0!==i?i.call(o):void 0},n="rotatestart",a="rotating",f="rotateend",g=function(){function n(e,t,r,o){c(this,n),this.propagationStopped_=!1,this.type_=e,this.features_=t,this.angle_=r,this.anchor_=o}return r(n,[{key:"preventDefault",value:function(){this.propagationStopped_=!0}},{key:"stopPropagation",value:function(){this.propagationStopped_=!0}},{key:"propagationStopped",get:function(){return this.propagationStopped_}},{key:"type",get:function(){return this.type_}},{key:"features",get:function(){return this.features_}},{key:"angle",get:function(){return this.angle_}},{key:"anchor",get:function(){return this.anchor_}}]),n}(),_=e.interaction.Pointer,p=e.interaction.Pointer.handleEvent,y=e.Collection,d=e.layer.Vector,v=e.source.Vector,w=e.Feature,A=e.geom.Point,F=e.geom.Polygon,m=e.geom.GeometryCollection,b=e.style.Style,k=e.style.RegularShape,C=e.style.Stroke,E=e.style.Fill,O=e.style.Text,x=e.extent.getCenter,S="rotate-anchor",P="rotate-arrow",M="angle",j="anchor",G=function(e){function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,s);var t,r,o,n,i,a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,{handleEvent:R,handleDownEvent:U,handleUpEvent:I,handleDragEvent:T,handleMoveEvent:z}));if(a.previousCursor_=void 0,a.anchorFeature_=void 0,a.arrowFeature_=void 0,a.lastCoordinate_=void 0,a.anchorMoving_=!1,a.overlay_=new d({style:e.style||(r=[255,255,255,.8],o=[0,153,255,.8],n=[255,255,255,.01],l(t={},S,[new b({image:new k({fill:new E({color:[0,153,255,.8]}),stroke:new C({color:o,width:1}),radius:4,points:6}),zIndex:1/0})]),l(t,P,[new b({fill:new E({color:n}),stroke:new C({color:r,width:4}),text:new O({font:"12px sans-serif",offsetX:20,offsetY:-20,fill:new E({color:"blue"}),stroke:new C({color:r,width:3})}),zIndex:1/0}),new b({fill:new E({color:n}),stroke:new C({color:o,width:2}),zIndex:1/0})]),i=t,function(e,t){var r=void 0,o=e.get(M)||0;switch(!0){case e.get(S):return(r=i[S])[0].getImage().setRotation(-o),r;case e.get(P):r=i[P];var n=e.getGeometry().getCoordinates(),a=new F([[[n[0],n[1]-6*t],[n[0]+8*t,n[1]-12*t],[n[0],n[1]+30*t],[n[0]-8*t,n[1]-12*t],[n[0],n[1]-6*t]]]);return a.rotate(o,n),r[0].setGeometry(a),r[1].setGeometry(a),r[0].getText().setText(Math.round(180*-o/Math.PI)+"Â°"),r}}),source:new v({features:new y})}),a.features_=void 0,e.features)if(u(e.features))a.features_=new y(e.features);else{if(!(e.features instanceof y))throw new Error("Features option should be an array or collection of features, got "+h(e.features));a.features_=e.features}else a.features_=new y;return a.setAnchor(e.anchor||D(a.features_)),a.setAngle(e.angle||0),a.features_.on("add",a.onFeatureAdd_.bind(a)),a.features_.on("remove",a.onFeatureRemove_.bind(a)),a.on("change:"+M,a.onAngleChange_.bind(a)),a.on("change:"+j,a.onAnchorChange_.bind(a)),a.createOrUpdateAnchorFeature_(),a.createOrUpdateArrowFeature_(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,_),r(s,[{key:"setMap",value:function(e){this.overlay_.setMap(e),o(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"setMap",this).call(this,e)}},{key:"setActive",value:function(e){this.overlay_&&this.overlay_.setMap(e?this.map:void 0),o(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"setActive",this).call(this,e)}},{key:"setAngle",value:function(e){t(!isNaN(parseFloat(e)),"Numeric value passed"),this.set(M,parseFloat(e))}},{key:"getAngle",value:function(){return this.get(M)}},{key:"setAnchor",value:function(e){t(null==e||u(e)&&2===e.length,"Array of two elements passed"),this.set(j,null!=e?e.map(parseFloat):D(this.features_))}},{key:"getAnchor",value:function(){return this.get(j)}},{key:"createOrUpdateAnchorFeature_",value:function(){var e,t=this.getAngle(),r=this.getAnchor();r&&(this.anchorFeature_?(this.anchorFeature_.getGeometry().setCoordinates(r),this.anchorFeature_.set(M,t)):(this.anchorFeature_=new w((e={geometry:new A(r)},l(e,M,t),l(e,S,!0),e)),this.overlay_.getSource().addFeature(this.anchorFeature_)))}},{key:"createOrUpdateArrowFeature_",value:function(){var e,t=this.getAngle(),r=this.getAnchor();r&&(this.arrowFeature_?(this.arrowFeature_.getGeometry().setCoordinates(r),this.arrowFeature_.set(M,t)):(this.arrowFeature_=new w((e={geometry:new A(r)},l(e,M,t),l(e,P,!0),e)),this.overlay_.getSource().addFeature(this.arrowFeature_)))}},{key:"resetAngleAndAnchor_",value:function(){this.resetAngle_(),this.resetAnchor_()}},{key:"resetAngle_",value:function(){this.set(M,0,!0),this.arrowFeature_&&this.arrowFeature_.set(M,this.getAngle()),this.anchorFeature_&&this.anchorFeature_.set(M,this.getAngle())}},{key:"resetAnchor_",value:function(){this.set(j,D(this.features_),!0),this.getAnchor()&&(this.arrowFeature_&&this.arrowFeature_.getGeometry().setCoordinates(this.getAnchor()),this.anchorFeature_&&this.anchorFeature_.getGeometry().setCoordinates(this.getAnchor()))}},{key:"onFeatureAdd_",value:function(){this.resetAngleAndAnchor_(),this.createOrUpdateAnchorFeature_(),this.createOrUpdateArrowFeature_()}},{key:"onFeatureRemove_",value:function(){this.resetAngleAndAnchor_(),this.features_.getLength()?(this.createOrUpdateAnchorFeature_(),this.createOrUpdateArrowFeature_()):(this.overlay_.getSource().clear(),this.anchorFeature_=this.arrowFeature_=void 0)}},{key:"onAngleChange_",value:function(e){var t=this,r=e.oldValue;this.features_.forEach(function(e){return e.getGeometry().rotate(t.getAngle()-r,t.getAnchor())}),this.arrowFeature_&&this.arrowFeature_.set(M,this.getAngle()),this.anchorFeature_&&this.anchorFeature_.set(M,this.getAngle())}},{key:"onAnchorChange_",value:function(){var e=this.getAnchor();e&&(this.anchorFeature_&&this.anchorFeature_.getGeometry().setCoordinates(e),this.arrowFeature_&&this.arrowFeature_.getGeometry().setCoordinates(e))}},{key:"dispatchRotateStartEvent_",value:function(e){this.dispatchEvent(new g(n,e,this.getAngle(),this.getAnchor()))}},{key:"dispatchRotatingEvent_",value:function(e){this.dispatchEvent(new g(a,e,this.getAngle(),this.getAnchor()))}},{key:"dispatchRotateEndEvent_",value:function(e){this.dispatchEvent(new g(f,e,this.getAngle(),this.getAnchor()))}},{key:"features",get:function(){return this.features_}},{key:"angle",get:function(){return this.getAngle()},set:function(e){this.setAngle(e)}},{key:"anchor",get:function(){return this.getAnchor()},set:function(e){this.setAnchor(e)}},{key:"map",set:function(e){this.setMap(e)},get:function(){return this.getMap()}},{key:"active",set:function(e){this.setActive(e)},get:function(){return this.getActive()}}]),s}();function R(e){var t=e.map.forEachFeatureAtPixel(e.pixel,i);return(!s(["click","singleclick","dblclick"],e.type)||!s([this.anchorFeature_,this.arrowFeature_],t))&&p.call(this,e)}function U(e){var t=e.map.forEachFeatureAtPixel(e.pixel,i);return!t||this.lastCoordinate_||!s(this.features_.getArray(),t)&&t!==this.arrowFeature_?!(!t||t!==this.anchorFeature_)&&(this.anchorMoving_=!0,z.call(this,e),!0):(this.lastCoordinate_=e.coordinate,z.call(this,e),this.dispatchRotateStartEvent_(this.features_),!0)}function I(e){return this.lastCoordinate_?(this.lastCoordinate_=void 0,z.call(this,e),this.dispatchRotateEndEvent_(this.features_),!0):!!this.anchorMoving_&&(this.anchorMoving_=!1,z.call(this,e),!0)}function T(e){var t=e.coordinate,r=this.anchorFeature_.getGeometry().getCoordinates();if(this.lastCoordinate_){var o=[this.lastCoordinate_[0]-r[0],this.lastCoordinate_[1]-r[1]],n=[t[0]-r[0],t[1]-r[1]],a=Math.atan2(o[0]*n[1]-n[0]*o[1],o[0]*n[0]+o[1]*n[1]);this.setAngle(this.getAngle()+a),this.dispatchRotatingEvent_(this.features_),this.lastCoordinate_=t}else this.anchorMoving_&&this.setAnchor(t)}function z(e){var t=e.map,r=e.pixel,o=t.getTargetElement(),n=t.forEachFeatureAtPixel(r,i),a=function(e){1<arguments.length&&void 0!==arguments[1]&&arguments[1]&&(o.style.cursor="-webkit-"+e,o.style.cursor="-moz-"+e),o.style.cursor=e};this.lastCoordinate_?(this.previousCursor_=o.style.cursor,a("grabbing",!0)):n&&(s(this.features_.getArray(),n)||n===this.arrowFeature_)?(this.previousCursor_=o.style.cursor,a("grab",!0)):n&&n===this.anchorFeature_||this.anchorMoving_?(this.previousCursor_=o.style.cursor,a("crosshair")):(a(this.previousCursor_||""),this.previousCursor_=void 0)}function D(e){if((e=e instanceof y?e.getArray():e).length)return x(function(e){if((e=e instanceof y?e.getArray():e).length)return new m(e.map(function(e){return e.getGeometry()})).getExtent()}(e))}return"undefined"!=typeof window&&window.ol&&(window.ol.interaction.RotateFeature=G),G});
ol.interaction.Rotate = RotateFeatureInteraction;
//# sourceMappingURL=bundle.min.js.map
